
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>The Auth System &#8212; Swift 0.1.0.dev10162 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/basic.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="canonical" href="/openstack-swift/overview_auth.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Access Control Lists (ACLs)" href="overview_acl.html" />
    <link rel="prev" title="The Account Reaper" href="overview_reaper.html" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Bootstrap CSS -->
<link href="_static/css/bootstrap.min.css" rel="stylesheet">

<!-- Fonts -->
<link href="_static/css/font-awesome.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="_static/css/combined.css" rel="stylesheet">

<!-- Search CSS -->
<link href="_static/css/search.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="_static/pygments.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->


  </head><body>

<!-- SOURCE_FILE: https://opendev.org/openstack/swift/src/doc/source/overview_auth.rst -->

<script>
    (function (window, document) {
        var loader = function () {
            var script = document.createElement("script"), tag = document.getElementsByTagName("script")[0];
            script.src = "https://search.openstack.org/widget/embed.min.js?t="+Date.now();
            tag.parentNode.insertBefore(script, tag);
        };
        window.addEventListener ? window.addEventListener("load", loader, false) : window.attachEvent("onload", loader);
    })(window, document);
</script>

<nav class="navbar navbar-default" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="https://www.openstack.org/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
    <div class="openstack-search-bar" data-baseUrl="search.openstack.org" data-context="docs-openstack"></div>
</div>
      <ul class="nav navbar-nav navbar-main show">
        <li class="search-container-mobile">
    <div class="openstack-search-bar" data-baseUrl="search.openstack.org" data-context="docs-openstack"></div>
</li>
        <li> <!--Software -->
          <a href="https://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/openstack-components">OpenStack Components</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/sdks">SDKs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/deployment-tools">Deployment Tools</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/assets/software/projectmap/openstack-map.pdf" target="_blank">OpenStack Map</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
          </ul>
        </li>
        <li> <!-- Use Cases -->
          <a href="https://www.openstack.org/use-cases/" class="drop" id="dropdownMenuUsers">Use Cases <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/">Users in Production</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/bare-metal/">Ironic Bare Metal</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/edge-computing/">Edge Computing</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/telecoms-and-nfv/">Telecom & NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/science/">Science and HPC</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/containers/">Containers</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/enterprise/">Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li> <!-- Events -->
          <a href="https://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">Open Infrastructure Summits</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/ptg/">Project Teams Gathering</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/opendev-2020/">OpenDev</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/community-events/">Community Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/openstackdays">OpenStack & OpenInfra Days</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
          </ul>
        </li>
        <li><!-- Community -->
          <a href="https://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/tech-committee">OpenStack Technical Committee</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/coa/">Get Certified (COA)</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketing/">Marketing Resources</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/news/">Community News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/supporting-organizations/">OpenInfra Foundation Supporting Organizations</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev">Open Infrastructure Foundation (OpenInfra Foundation)</a></li>
          </ul>
        </li>
        <li><!-- Marketplace -->
          <a href="https://www.openstack.orgmarketplace/" class="drop" id="dropdownMenuLearn">Marketplace <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/distros/">Distros & Appliances</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/public-clouds/">Public Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/hosted-private-clouds/">Hosted Private Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/remotely-managed-private-clouds/">Remotely Managed Private Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/consulting/">Consulting & Integrators</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/drivers/">Drivers</a></li>
          </ul>
        </li>
        <li><!-- Blog -->
          <a href="https://www.openstack.org/blog/">Blog</a>
        </li>
        <li><!-- Docs -->
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
        <li> <!-- Join -->
            <li class="join-nav-section">
              <a href="https://openinfra.dev/join/" id="dropdownMenuJoin">Join <i class="fa fa-caret-down"></i></a>
              <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuJoin" style="display: none;">
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev/join/">Sign up for Foundation Membership</a></li>
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev/join/">Sponsor the Foundation</a></li>
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev">More about the Foundation</a></li>
              </ul>
            </li>
            <li>
              <a href="https://www.openstack.org/Security/login/?BackURL=/home/" class="sign-in-btn">Log In</a>
            </li>
        </li>
      </ul>
    </div>
  </div>
  <!-- /.container -->
</nav>

    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row docs-title">
  <div class="col-lg-8">
      <h1>The Auth System</h1>
    
  </div>
  <div class="docs-actions">
    
    <a href="overview_reaper.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: The Account Reaper"></i></a>
    
    
    <a href="overview_acl.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Access Control Lists (ACLs)"></i></a>
    
    <a id="pdfLink1" href="" target="_blank" title="Download the manuals as PDF"><i class="fa fa-file-pdf-o" data-toggle="tooltip" data-placement="top" title="Download PDF"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
    
  </div>
</div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-body" role="main">

  <section id="the-auth-system">
<h1>The Auth System<a class="headerlink" href="#the-auth-system" title="Permalink to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>Swift supports a number of auth systems that share the following common
characteristics:</p>
<ul class="simple">
<li><p>The authentication/authorization part can be an external system or a
subsystem run within Swift as WSGI middleware</p></li>
<li><p>The user of Swift passes in an auth token with each request</p></li>
<li><p>Swift validates each token with the external auth system or auth subsystem
and caches the result</p></li>
<li><p>The token does not change from request to request, but does expire</p></li>
</ul>
<p>The token can be passed into Swift using the X-Auth-Token or the
X-Storage-Token header. Both have the same format: just a simple string
representing the token. Some auth systems use UUID tokens, some an MD5 hash of
something unique, some use “something else” but the salient point is that the
token is a string which can be sent as-is back to the auth system for
validation.</p>
<p>Swift will make calls to the auth system, giving the auth token to be
validated. For a valid token, the auth system responds with an overall
expiration time in seconds from now. To avoid the overhead in validating the same
token over and over again, Swift will cache the
token for a configurable time, but no longer than the expiration
time.</p>
<p>The Swift project includes two auth systems:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#temp-auth"><span class="std std-ref">TempAuth</span></a></p></li>
<li><p><a class="reference internal" href="#keystone-auth"><span class="std std-ref">Keystone Auth</span></a></p></li>
</ul>
<p>It is also possible to write your own auth system as described in
<a class="reference internal" href="#extending-auth"><span class="std std-ref">Extending Auth</span></a>.</p>
</section>
<section id="tempauth">
<span id="temp-auth"></span><h2>TempAuth<a class="headerlink" href="#tempauth" title="Permalink to this heading">¶</a></h2>
<p>TempAuth is used primarily in Swift’s functional test environment and can be
used in other test environments (such as <a class="reference internal" href="development_saio.html"><span class="doc">SAIO (Swift All In One)</span></a>). It is not
recommended to use TempAuth in a production system. However, TempAuth is fully
functional and can be used as a model to develop your own auth system.</p>
<p>TempAuth has the concept of admin and non-admin users
within an account.  Admin users can do anything within the account.
Non-admin users can only perform read operations. However, some
privileged metadata such as X-Container-Sync-Key is not accessible to
non-admin users.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>As a good starting point,
<a class="reference external" href="https://github.com/QubitPi/docker-swift-onlyone">a single-node docker image</a>
will make it easy for developers to get used to using object storage instead
of a file system, and when they need the eventual consistency and multiple
replicas provided by a larger OpenStack Swift cluster they can work on
implementing that by following this section. One replica is not an issue in
small systems or for a proof-of-concept because it can just be backed up.</p>
<p>Its Dockerfile uses <a class="reference external" href="http://supervisord.org/">supervisord</a> to manage the
processes. The most idiomatic way to use docker is one container one service,
but in this particular Dockerfile we will be starting several services in the
container, such as rsyslog, memcached, and all the required OpenStack Swift
daemons (of which there are quite a few). So in this case we’re using Docker
more as a role-based system, and the roles are both a Swift proxy and Swift
storage, ie. a Swift “onlyone.”” All of the required Swift services are
running in this one container.</p>
<p>To use this container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">volume</span> <span class="n">create</span> <span class="n">swift</span><span class="o">-</span><span class="n">data</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">swift</span> <span class="o">-</span><span class="n">p</span> <span class="mi">12345</span><span class="p">:</span><span class="mi">8080</span> <span class="o">-</span><span class="n">v</span> <span class="n">swift</span><span class="o">-</span><span class="n">data</span><span class="p">:</span><span class="o">/</span><span class="n">srv</span> <span class="o">-</span><span class="n">t</span> <span class="n">fnndsc</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">swift</span><span class="o">-</span><span class="n">onlyone</span>
</pre></div>
</div>
</div>
<section id="swift-api-through-tempauth">
<h3>Swift API through TempAuth<a class="headerlink" href="#swift-api-through-tempauth" title="Permalink to this heading">¶</a></h3>
<p>In this process two components are involved</p>
<ol class="arabic simple">
<li><p>the Swift proxy server, and</p></li>
<li><p>the Swift client</p></li>
</ol>
<p>The client should contain the following information:</p>
<ul class="simple">
<li><p>storage URL, and</p></li>
<li><p>authentication information, including the HTTP methods and other metadata
information</p></li>
</ul>
<p>To begin with the client will send its auth details in the HTTP header using
<strong>X-AUTH-USER</strong> and <strong>X-AUTH-KEY</strong>. The Swift server then responds with the
<strong>X-AUTH-TOKEN</strong> and <strong>X-Storage-Url</strong> to the client. The client will, then, use
X-AUTH-TOKEN and X-Storage-Url to perform the HTTP operations such as uploading
and downloading files from Swift.</p>
<p>This auth system is default and known as the <strong>TempAuth</strong>.</p>
<p>To put it into action, let’s say we have a <strong>username of “system:jack”</strong>, and
<strong>password of “testpass”</strong>. Our Swift instance is running locally at port
<a class="reference external" href="https://docs.openstack.org/install-guide/firewalls-default-ports.html">6000</a>.
Execute the following command and make a note of <em>X-Auth-Token</em>. We will need
this token to use in all subsequent request.</p>
<p>The response looks like the following:</p>
<p>In this case, <em>X-Auth-Token</em> is <strong>AUTH_tk65840af9f6f74d1aaefac978cb8f0899</strong> and
storage URL which we will be using from now one is
“<a class="reference external" href="http://localhost:6000/v1/AUTH_system">http://localhost:6000/v1/AUTH_system</a>”</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Note that the storage URL does vary based on the username. For example, if
username is not “system:jack”, but others like “<strong>foo</strong>:bar”, the storage URL
becomes “<a class="reference external" href="http://localhost:6000/v1/AUTH_foo">http://localhost:6000/v1/AUTH_foo</a>” instead</p>
</div>
<ul>
<li><p>To get metadata associated with a Swift account “system”:</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>We can request the data from Swift in XML or JSON format by specifying the
“<strong>format</strong>” paramater. For example</p>
<p>This parameter can be applied to any of the requests below as well:</p>
</div>
</li>
<li><p>To create a container called “my-container”</p></li>
<li><p>To get metadata associated with a container called “my-container”:</p></li>
<li><p>To list all containers in current account:</p></li>
<li><p>To upload a file called “my-file.pdf” to container “my-container”</p></li>
<li><p>To list all objects in a container:</p></li>
<li><p>To list all objects in a container that starts with a particular prefix “my-“:</p></li>
<li><p>To download a particular file named “my-file.pdf” from the container “my-container”:</p></li>
<li><p>To download named “my-file.pdf” and save it locally as “local-file.pdf”:</p></li>
<li><p>To delete a specific file called “my-file.pdf” from “my-container”</p></li>
<li><p>To delete the container “my-container”</p></li>
</ul>
<p>More information is at
<a class="reference external" href="https://docs.openstack.org/api-ref/object-store/index.html">Swift Object Storage API</a></p>
<p>Users with the special group <code class="docutils literal notranslate"><span class="pre">.reseller_admin</span></code> can operate on any account.
For an example usage please see <a class="reference internal" href="middleware.html#module-swift.common.middleware.tempauth" title="swift.common.middleware.tempauth"><code class="xref py py-mod docutils literal notranslate"><span class="pre">swift.common.middleware.tempauth</span></code></a>.
If a request is coming from a reseller the auth system sets the request environ
reseller_request to True. This can be used by other middlewares.</p>
<p>Other users may be granted the ability to perform operations on
an account or container via ACLs. TempAuth supports two types of ACL:</p>
<ul class="simple">
<li><p>Per container ACLs based on the
container’s <code class="docutils literal notranslate"><span class="pre">X-Container-Read</span></code> and <code class="docutils literal notranslate"><span class="pre">X-Container-Write</span></code> metadata. See
<a class="reference internal" href="overview_acl.html#container-acls"><span class="std std-ref">Container ACLs</span></a> for more information.</p></li>
<li><p>Per account ACLs based on the account’s <code class="docutils literal notranslate"><span class="pre">X-Account-Access-Control</span></code>
metadata. For more information see <a class="reference internal" href="overview_acl.html#account-acls"><span class="std std-ref">Account ACLs</span></a>.</p></li>
</ul>
<p>TempAuth will now allow OPTIONS requests to go through without a token.</p>
<p>The TempAuth middleware is responsible for creating its own tokens. A user
makes a request containing their username and password and TempAuth
responds with a token. This token is then used to perform subsequent
requests on the user’s account, containers and objects.</p>
</section>
</section>
<section id="keystone-auth">
<span id="id1"></span><h2>Keystone Auth<a class="headerlink" href="#keystone-auth" title="Permalink to this heading">¶</a></h2>
<p>Swift is able to authenticate against OpenStack <a class="reference external" href="https://docs.openstack.org/keystone/latest/">Keystone</a>. In this
environment, Keystone is responsible for creating and validating
tokens. The <a class="reference internal" href="middleware.html#keystoneauth"><span class="std std-ref">KeystoneAuth</span></a> middleware is responsible for
implementing the auth system within Swift as described here.</p>
<p>The <a class="reference internal" href="middleware.html#keystoneauth"><span class="std std-ref">KeystoneAuth</span></a> middleware supports per container based ACLs on the
container’s <code class="docutils literal notranslate"><span class="pre">X-Container-Read</span></code> and <code class="docutils literal notranslate"><span class="pre">X-Container-Write</span></code> metadata.
For more information see <a class="reference internal" href="overview_acl.html#container-acls"><span class="std std-ref">Container ACLs</span></a>.</p>
<p>The account-level ACL is not supported by Keystone auth.</p>
<p>In order to use the <code class="docutils literal notranslate"><span class="pre">keystoneauth</span></code> middleware the <code class="docutils literal notranslate"><span class="pre">auth_token</span></code>
middleware from <a class="reference external" href="https://docs.openstack.org/keystonemiddleware/latest/">KeystoneMiddleware</a> will need to be configured.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">authtoken</span></code> middleware performs the authentication token
validation and retrieves actual user authentication information. It
can be found in the <a class="reference external" href="https://docs.openstack.org/keystonemiddleware/latest/">KeystoneMiddleware</a> distribution.</p>
<p>The <a class="reference internal" href="middleware.html#keystoneauth"><span class="std std-ref">KeystoneAuth</span></a> middleware performs authorization and mapping the
Keystone roles to Swift’s ACLs.</p>
<section id="configuring-swift-to-use-keystone">
<span id="configuring-keystone-auth"></span><h3>Configuring Swift to use Keystone<a class="headerlink" href="#configuring-swift-to-use-keystone" title="Permalink to this heading">¶</a></h3>
<p>Configuring Swift to use <a class="reference external" href="https://docs.openstack.org/keystone/latest/">Keystone</a>
is relatively straightforward.  The first
step is to ensure that you have the <code class="docutils literal notranslate"><span class="pre">auth_token</span></code> middleware installed. It can
either be dropped in your python path or installed via the <a class="reference external" href="https://docs.openstack.org/keystonemiddleware/latest/">KeystoneMiddleware</a>
package.</p>
<p>You need at first make sure you have a service endpoint of type
<code class="docutils literal notranslate"><span class="pre">object-store</span></code> in Keystone pointing to your Swift proxy. For example
having this in your <code class="docutils literal notranslate"><span class="pre">/etc/keystone/default_catalog.templates</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>catalog.RegionOne.object_store.name = Swift Service
catalog.RegionOne.object_store.publicURL = http://swiftproxy:8080/v1/AUTH_$(tenant_id)s
catalog.RegionOne.object_store.adminURL = http://swiftproxy:8080/
catalog.RegionOne.object_store.internalURL = http://swiftproxy:8080/v1/AUTH_$(tenant_id)s
</pre></div>
</div>
<p>On your Swift proxy server you will want to adjust your main pipeline
and add auth_token and keystoneauth in your
<code class="docutils literal notranslate"><span class="pre">/etc/swift/proxy-server.conf</span></code> like this</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">pipeline</span><span class="p">:</span><span class="n">main</span><span class="p">]</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span><span class="o">....</span><span class="p">]</span> <span class="n">authtoken</span> <span class="n">keystoneauth</span> <span class="n">proxy</span><span class="o">-</span><span class="n">logging</span> <span class="n">proxy</span><span class="o">-</span><span class="n">server</span>
</pre></div>
</div>
<p>add the configuration for the authtoken middleware:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nb">filter</span><span class="p">:</span><span class="n">authtoken</span><span class="p">]</span>
<span class="n">paste</span><span class="o">.</span><span class="n">filter_factory</span> <span class="o">=</span> <span class="n">keystonemiddleware</span><span class="o">.</span><span class="n">auth_token</span><span class="p">:</span><span class="n">filter_factory</span>
<span class="n">www_authenticate_uri</span> <span class="o">=</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">keystonehost</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span>
<span class="n">auth_url</span> <span class="o">=</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">keystonehost</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span>
<span class="n">auth_plugin</span> <span class="o">=</span> <span class="n">password</span>
<span class="n">project_domain_id</span> <span class="o">=</span> <span class="n">default</span>
<span class="n">user_domain_id</span> <span class="o">=</span> <span class="n">default</span>
<span class="n">project_name</span> <span class="o">=</span> <span class="n">service</span>
<span class="n">username</span> <span class="o">=</span> <span class="n">swift</span>
<span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
<span class="n">cache</span> <span class="o">=</span> <span class="n">swift</span><span class="o">.</span><span class="n">cache</span>
<span class="n">include_service_catalog</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">delay_auth_decision</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>The actual values for these variables will need to be set depending on
your situation, but in short:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">www_authenticate_uri</span></code> should point to a Keystone service from which users may
retrieve tokens. This value is used in the <cite>WWW-Authenticate</cite> header that
auth_token sends with any denial response.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">auth_url</span></code> points to the Keystone Admin service. This information is
used by the middleware to actually query Keystone about the validity of the
authentication tokens. It is not necessary to append any Keystone API version
number to this URI.</p></li>
<li><p>The auth credentials (<code class="docutils literal notranslate"><span class="pre">project_domain_id</span></code>, <code class="docutils literal notranslate"><span class="pre">user_domain_id</span></code>,
<code class="docutils literal notranslate"><span class="pre">username</span></code>, <code class="docutils literal notranslate"><span class="pre">project_name</span></code>, <code class="docutils literal notranslate"><span class="pre">password</span></code>) will be used to retrieve an
admin token. That token will be used to authorize user tokens behind the
scenes. These credentials must match the Keystone credentials for the Swift
service. The example values shown here assume a user named ‘swift’ with admin
role on a project named ‘service’, both being in the Keystone domain with id
‘default’. Refer to the <a class="reference external" href="https://docs.openstack.org/keystonemiddleware/latest/middlewarearchitecture.html#configuration">KeystoneMiddleware documentation</a>
for other examples.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cache</span></code> is set to <code class="docutils literal notranslate"><span class="pre">swift.cache</span></code>. This means that the middleware
will get the Swift memcache from the request environment.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">include_service_catalog</span></code> defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code> if not set. This means
that when validating a token, the service catalog is retrieved
and stored in the <code class="docutils literal notranslate"><span class="pre">X-Service-Catalog</span></code> header. Since Swift does not
use the <code class="docutils literal notranslate"><span class="pre">X-Service-Catalog</span></code> header, there is no point in getting
the service catalog. We recommend you set <code class="docutils literal notranslate"><span class="pre">include_service_catalog</span></code>
to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The authtoken config variable <code class="docutils literal notranslate"><span class="pre">delay_auth_decision</span></code> must be set to
<code class="docutils literal notranslate"><span class="pre">True</span></code>. The default is <code class="docutils literal notranslate"><span class="pre">False</span></code>, but that breaks public access,
<a class="reference internal" href="middleware.html#staticweb"><span class="std std-ref">StaticWeb</span></a>, <a class="reference internal" href="middleware.html#formpost"><span class="std std-ref">FormPost</span></a>, <a class="reference internal" href="middleware.html#tempurl"><span class="std std-ref">TempURL</span></a>, and authenticated
capabilities requests (using <a class="reference internal" href="middleware.html#discoverability"><span class="std std-ref">Discoverability</span></a>).</p>
</div>
<p>and you can finally add the keystoneauth configuration. Here is a simple
configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nb">filter</span><span class="p">:</span><span class="n">keystoneauth</span><span class="p">]</span>
<span class="n">use</span> <span class="o">=</span> <span class="n">egg</span><span class="p">:</span><span class="n">swift</span><span class="c1">#keystoneauth</span>
<span class="n">operator_roles</span> <span class="o">=</span> <span class="n">admin</span><span class="p">,</span> <span class="n">swiftoperator</span>
</pre></div>
</div>
<p>Use an appropriate list of roles in operator_roles. For example, in
some systems, the role <code class="docutils literal notranslate"><span class="pre">_member_</span></code> or <code class="docutils literal notranslate"><span class="pre">Member</span></code> is used to indicate
that the user is allowed to operate on project resources.</p>
<section id="openstack-service-using-composite-tokens">
<h4>OpenStack Service Using Composite Tokens<a class="headerlink" href="#openstack-service-using-composite-tokens" title="Permalink to this heading">¶</a></h4>
<p>Some OpenStack services such as Cinder and Glance may use
a “service account”. In this mode, you configure a separate account where
the service stores project data that it manages. This account is not used
directly by the end-user. Instead, all access is done through the service.</p>
<p>To access the “service” account, the service must present two tokens: one from
the end-user and another from its own service user. Only when both tokens are
present can the account be accessed. This section describes how to set the
configuration options to correctly control access to both the “normal” and
“service” accounts.</p>
<p>In this example, end users use the <code class="docutils literal notranslate"><span class="pre">AUTH_</span></code> prefix in account names,
whereas services use the <code class="docutils literal notranslate"><span class="pre">SERVICE_</span></code> prefix:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nb">filter</span><span class="p">:</span><span class="n">keystoneauth</span><span class="p">]</span>
<span class="n">use</span> <span class="o">=</span> <span class="n">egg</span><span class="p">:</span><span class="n">swift</span><span class="c1">#keystoneauth</span>
<span class="n">reseller_prefix</span> <span class="o">=</span> <span class="n">AUTH</span><span class="p">,</span> <span class="n">SERVICE</span>
<span class="n">operator_roles</span> <span class="o">=</span> <span class="n">admin</span><span class="p">,</span> <span class="n">swiftoperator</span>
<span class="n">SERVICE_service_roles</span> <span class="o">=</span> <span class="n">service</span>
</pre></div>
</div>
<p>The actual values for these variable will need to be set depending on your
situation as follows:</p>
<ul class="simple">
<li><p>The first item in the reseller_prefix list must match Keystone’s endpoint
(see <code class="docutils literal notranslate"><span class="pre">/etc/keystone/default_catalog.templates</span></code> above). Normally
this is <code class="docutils literal notranslate"><span class="pre">AUTH</span></code>.</p></li>
<li><p>The second item in the reseller_prefix list is the prefix used by the
OpenStack services(s). You must configure this value (<code class="docutils literal notranslate"><span class="pre">SERVICE</span></code> in the
example) with whatever the other OpenStack service(s) use.</p></li>
<li><p>Set the operator_roles option to contain a role or roles that end-user’s
have on project’s they use.</p></li>
<li><p>Set the SERVICE_service_roles value to a role or roles that only the
OpenStack service user has. Do not use a role that is assigned to
“normal” end users. In this example, the role <code class="docutils literal notranslate"><span class="pre">service</span></code> is used.
The service user is granted this role to a <em>single</em> project only. You do
not need to make the service user a member of every project.</p></li>
</ul>
<p>This configuration works as follows:</p>
<ul class="simple">
<li><p>The end-user presents a user token to an OpenStack service. The service
then makes a Swift request to the account with the <code class="docutils literal notranslate"><span class="pre">SERVICE</span></code> prefix.</p></li>
<li><p>The service forwards the original user token with the request. It also
adds it’s own service token.</p></li>
<li><p>Swift validates both tokens. When validated, the user token gives the
<code class="docutils literal notranslate"><span class="pre">admin</span></code> or <code class="docutils literal notranslate"><span class="pre">swiftoperator</span></code> role(s). When validated, the service token
gives the <code class="docutils literal notranslate"><span class="pre">service</span></code> role.</p></li>
<li><p>Swift interprets the above configuration as follows:</p>
<ul>
<li><p>Did the user token provide one of the roles listed in operator_roles?</p></li>
<li><p>Did the service token have the <code class="docutils literal notranslate"><span class="pre">service</span></code> role as described by the
<code class="docutils literal notranslate"><span class="pre">SERVICE_service_roles</span></code> options.</p></li>
</ul>
</li>
<li><p>If both conditions are met, the request is granted. Otherwise, Swift
rejects the request.</p></li>
</ul>
<p>In the above example, all services share the same account. You can separate
each service into its own account. For example, the following provides a
dedicated account for each of the Glance and Cinder services. In addition,
you must assign the <code class="docutils literal notranslate"><span class="pre">glance_service</span></code> and <code class="docutils literal notranslate"><span class="pre">cinder_service</span></code> to the
appropriate service users:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nb">filter</span><span class="p">:</span><span class="n">keystoneauth</span><span class="p">]</span>
<span class="n">use</span> <span class="o">=</span> <span class="n">egg</span><span class="p">:</span><span class="n">swift</span><span class="c1">#keystoneauth</span>
<span class="n">reseller_prefix</span> <span class="o">=</span> <span class="n">AUTH</span><span class="p">,</span> <span class="n">IMAGE</span><span class="p">,</span> <span class="n">VOLUME</span>
<span class="n">operator_roles</span> <span class="o">=</span> <span class="n">admin</span><span class="p">,</span> <span class="n">swiftoperator</span>
<span class="n">IMAGE_service_roles</span> <span class="o">=</span> <span class="n">glance_service</span>
<span class="n">VOLUME_service_roles</span> <span class="o">=</span> <span class="n">cinder_service</span>
</pre></div>
</div>
</section>
</section>
<section id="access-control-using-keystoneauth">
<h3>Access control using keystoneauth<a class="headerlink" href="#access-control-using-keystoneauth" title="Permalink to this heading">¶</a></h3>
<p>By default the only users able to perform operations (e.g. create a container)
on an account are those having a Keystone role for the corresponding Keystone
project that matches one of the roles specified in the <code class="docutils literal notranslate"><span class="pre">operator_roles</span></code>
option.</p>
<p>Users who have one of the <code class="docutils literal notranslate"><span class="pre">operator_roles</span></code> will be able to set container ACLs
to grant other users permission to read and/or write objects in specific
containers, using <code class="docutils literal notranslate"><span class="pre">X-Container-Read</span></code> and <code class="docutils literal notranslate"><span class="pre">X-Container-Write</span></code> headers
respectively. In addition to the ACL formats described
<a class="reference internal" href="misc.html#module-swift.common.middleware.acl" title="swift.common.middleware.acl"><code class="xref py py-mod docutils literal notranslate"><span class="pre">here</span></code></a>, keystoneauth supports ACLs using the
format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">other_project_id</span><span class="p">:</span><span class="n">other_user_id</span><span class="o">.</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">other_project_id</span></code> is the UUID of a Keystone project and
<code class="docutils literal notranslate"><span class="pre">other_user_id</span></code> is the UUID of a Keystone user. This will allow the other
user to access a container provided their token is scoped on the other
project. Both <code class="docutils literal notranslate"><span class="pre">other_project_id</span></code> and <code class="docutils literal notranslate"><span class="pre">other_user_id</span></code> may be replaced with
the wildcard character <code class="docutils literal notranslate"><span class="pre">*</span></code> which will match any project or user respectively.</p>
<p>Be sure to use Keystone UUIDs rather than names in container ACLs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For backwards compatibility, keystoneauth will by default grant container
ACLs expressed as <code class="docutils literal notranslate"><span class="pre">other_project_name:other_user_name</span></code> (i.e. using
Keystone names rather than UUIDs) in the special case when both the other
project and the other user are in Keystone’s default domain and the project
being accessed is also in the default domain.</p>
<p>For further information see <a class="reference internal" href="middleware.html#keystoneauth"><span class="std std-ref">KeystoneAuth</span></a></p>
</div>
<p>Users with the Keystone role defined in <code class="docutils literal notranslate"><span class="pre">reseller_admin_role</span></code>
(<code class="docutils literal notranslate"><span class="pre">ResellerAdmin</span></code> by default) can operate on any account. The auth system
sets the request environ reseller_request to True if a request is coming
from a user with this role. This can be used by other middlewares.</p>
</section>
<section id="troubleshooting-tips-for-keystoneauth-deployment">
<h3>Troubleshooting tips for keystoneauth deployment<a class="headerlink" href="#troubleshooting-tips-for-keystoneauth-deployment" title="Permalink to this heading">¶</a></h3>
<p>Some common mistakes can result in API requests failing when first deploying
keystone with Swift:</p>
<ul>
<li><p>Incorrect configuration of the Swift endpoint in the Keystone service.</p>
<p>By default, keystoneauth expects the account part of a URL to have the form
<code class="docutils literal notranslate"><span class="pre">AUTH_&lt;keystone_project_id&gt;</span></code>. Sometimes the <code class="docutils literal notranslate"><span class="pre">AUTH_</span></code> prefix is missed when
configuring Swift endpoints in Keystone, as described in the <a class="reference external" href="http://docs.openstack.org/">Install  Guide</a>. This is easily diagnosed by inspecting the
proxy-server log file for a failed request URL and checking that the URL
includes the <code class="docutils literal notranslate"><span class="pre">AUTH_</span></code> prefix (or whatever reseller prefix may have been
configured for keystoneauth):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GOOD</span><span class="p">:</span>
<span class="n">proxy</span><span class="o">-</span><span class="n">server</span><span class="p">:</span> <span class="mf">127.0.0.1</span> <span class="mf">127.0.0.1</span> <span class="mi">07</span><span class="o">/</span><span class="n">Sep</span><span class="o">/</span><span class="mi">2016</span><span class="o">/</span><span class="mi">16</span><span class="o">/</span><span class="mi">06</span><span class="o">/</span><span class="mi">58</span> <span class="n">HEAD</span> <span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">AUTH_cfb8d9d45212408b90bc0776117aec9e</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">204</span> <span class="o">...</span>

<span class="n">BAD</span><span class="p">:</span>
<span class="n">proxy</span><span class="o">-</span><span class="n">server</span><span class="p">:</span> <span class="mf">127.0.0.1</span> <span class="mf">127.0.0.1</span> <span class="mi">07</span><span class="o">/</span><span class="n">Sep</span><span class="o">/</span><span class="mi">2016</span><span class="o">/</span><span class="mi">16</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="mi">35</span> <span class="n">HEAD</span> <span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">cfb8d9d45212408b90bc0776117aec9e</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">403</span> <span class="o">...</span>
</pre></div>
</div>
</li>
<li><p>Incorrect configuration of the <code class="docutils literal notranslate"><span class="pre">authtoken</span></code> middleware options in the Swift
proxy server.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">authtoken</span></code> middleware communicates with the Keystone service to
validate tokens that are presented with client requests. To do this
<code class="docutils literal notranslate"><span class="pre">authtoken</span></code> must authenticate itself with Keystone using the credentials
configured in the <code class="docutils literal notranslate"><span class="pre">[filter:authtoken]</span></code> section of
<code class="docutils literal notranslate"><span class="pre">/etc/swift/proxy-server.conf</span></code>. Errors in these credentials can result in
<code class="docutils literal notranslate"><span class="pre">authtoken</span></code> failing to validate tokens and may be revealed in the proxy
server logs by a message such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">proxy</span><span class="o">-</span><span class="n">server</span><span class="p">:</span> <span class="n">Identity</span> <span class="n">server</span> <span class="n">rejected</span> <span class="n">authorization</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>More detailed log messaging may be seen by setting the <code class="docutils literal notranslate"><span class="pre">authtoken</span></code>
option <code class="docutils literal notranslate"><span class="pre">log_level</span> <span class="pre">=</span> <span class="pre">debug</span></code>.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">authtoken</span></code> configuration options may be checked by attempting to use
them to communicate directly with Keystone using an <code class="docutils literal notranslate"><span class="pre">openstack</span></code> command
line. For example, given the <code class="docutils literal notranslate"><span class="pre">authtoken</span></code> configuration sample shown in
<a class="reference internal" href="#configuring-keystone-auth"><span class="std std-ref">Configuring Swift to use Keystone</span></a>, the following command should return a
service catalog:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openstack</span> <span class="o">--</span><span class="n">os</span><span class="o">-</span><span class="n">identity</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">version</span><span class="o">=</span><span class="mi">3</span> <span class="o">--</span><span class="n">os</span><span class="o">-</span><span class="n">auth</span><span class="o">-</span><span class="n">url</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">keystonehost</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span> \
    <span class="o">--</span><span class="n">os</span><span class="o">-</span><span class="n">username</span><span class="o">=</span><span class="n">swift</span> <span class="o">--</span><span class="n">os</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="nb">id</span><span class="o">=</span><span class="n">default</span> \
    <span class="o">--</span><span class="n">os</span><span class="o">-</span><span class="n">project</span><span class="o">-</span><span class="n">name</span><span class="o">=</span><span class="n">service</span> <span class="o">--</span><span class="n">os</span><span class="o">-</span><span class="n">project</span><span class="o">-</span><span class="n">domain</span><span class="o">-</span><span class="nb">id</span><span class="o">=</span><span class="n">default</span> \
    <span class="o">--</span><span class="n">os</span><span class="o">-</span><span class="n">password</span><span class="o">=</span><span class="n">password</span> <span class="n">catalog</span> <span class="n">show</span> <span class="nb">object</span><span class="o">-</span><span class="n">store</span>
</pre></div>
</div>
<p>If this <code class="docutils literal notranslate"><span class="pre">openstack</span></code> command fails then it is likely that there is a problem
with the <code class="docutils literal notranslate"><span class="pre">authtoken</span></code> configuration.</p>
</li>
</ul>
</section>
</section>
<section id="extending-auth">
<span id="id2"></span><h2>Extending Auth<a class="headerlink" href="#extending-auth" title="Permalink to this heading">¶</a></h2>
<p>TempAuth is written as wsgi middleware, so implementing your own auth is as
easy as writing new wsgi middleware, and plugging it in to the proxy server.</p>
<p>See <a class="reference internal" href="development_auth.html"><span class="doc">Auth Server and Middleware</span></a> for detailed information on extending the
auth system.</p>
</section>
</section>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="overview_reaper.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: The Account Reaper"></i></a>
          
          
            <a href="overview_acl.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Access Control Lists (ACLs)"></i></a>
          
          <a id="pdfLink2" href="" target="_blank" title="Download the manuals as PDF"><i class="fa fa-file-pdf-o" data-toggle="tooltip" data-placement="top" title="Download PDF"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">this page last updated: 2023-05-18 18:31:41</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="https://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the
                 document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="OpenStack Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/id/">Bahasa Indonesia (Indonesian)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/it/">Italiano (Italian)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/tr_TR/">Türkçe (Türkiye)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="index.html" class="docs-sidebar-section-title"><h4>Swift 0.1.0.dev10162</h4></a>
      <ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api/object_api_v1_overview.html">Object Storage API overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_architecture.html">Swift Architectural Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_ring.html">The Rings</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_policies.html">Storage Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_reaper.html">The Account Reaper</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The Auth System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tempauth">TempAuth</a></li>
<li class="toctree-l2"><a class="reference internal" href="#keystone-auth">Keystone Auth</a></li>
<li class="toctree-l2"><a class="reference internal" href="#extending-auth">Extending Auth</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="overview_acl.html">Access Control Lists (ACLs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_replication.html">Replication</a></li>
<li class="toctree-l1"><a class="reference internal" href="ratelimit.html">Rate Limiting</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_large_objects.html">Large Object Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_global_cluster.html">Global Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_container_sync.html">Container to Container Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_expiring_objects.html">Expiring Object Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="cors.html">CORS</a></li>
<li class="toctree-l1"><a class="reference internal" href="crossdomain.html">Cross-domain Policy File</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_erasure_code.html">Erasure Code Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_encryption.html">Object Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_backing_store.html">Using Swift as Backing Store for Service Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_container_sharding.html">Container Sharding</a></li>
<li class="toctree-l1"><a class="reference internal" href="ring_background.html">Building a Consistent Hashing Ring</a></li>
<li class="toctree-l1"><a class="reference internal" href="ring_partpower.html">Modifying Ring Partition Power</a></li>
<li class="toctree-l1"><a class="reference internal" href="associated_projects.html">Associated Projects</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html">Contributing to OpenStack Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#swift-design-principles">Swift Design Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#recommended-workflow">Recommended workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#notes-on-testing">Notes on Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#ideas">Ideas</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#community">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/review_guidelines.html">Review Guidelines</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="development_guidelines.html">Development Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_saio.html">SAIO (Swift All In One)</a></li>
<li class="toctree-l1"><a class="reference internal" href="first_contribution_swift.html">First Contribution to Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="policies_saio.html">Adding Storage Policies to an Existing SAIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_auth.html">Auth Server and Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_middleware.html">Middleware and Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_ondisk_backends.html">Pluggable On-Disk Back-end APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_watchers.html">Auditor Watchers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="deployment_guide.html">Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_deployment_guide.html">Apache Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin_guide.html">Administrator’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="replication_network.html">Dedicated replication network</a></li>
<li class="toctree-l1"><a class="reference internal" href="logs.html">Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ops_runbook/index.html">Swift Ops Runbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin/index.html">OpenStack Swift Administrator Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="install/index.html">Object Storage Install Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="config/index.html">Configuration Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/object_api_v1_overview.html">Object Storage API overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/discoverability.html">Discoverability</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/container_quotas.html">Container quotas</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/object_versioning.html">Object versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/large_objects.html">Large objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/temporary_url_middleware.html">Temporary URL middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/form_post_middleware.html">Form POST middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/use_content-encoding_metadata.html">Use Content-Encoding metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/use_the_content-disposition_metadata.html">Use the Content-Disposition metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/pseudo-hierarchical-folders-directories.html">Pseudo-hierarchical folders and directories</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/pagination.html">Page through large lists of containers or objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/serialized-response-formats.html">Serialized response formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/static-website.html">Create static website</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/object-expiration.html">Object expiration</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/bulk-delete.html">Bulk delete</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="s3_compat.html">S3/Swift REST API Comparison Matrix</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ring.html">Partitioned Consistent Hash Ring</a></li>
<li class="toctree-l1"><a class="reference internal" href="proxy.html">Proxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="account.html">Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="container.html">Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="db.html">Account DB and Container DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="object.html">Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">Misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="middleware.html">Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="audit_watchers.html">Object Audit Watchers</a></li>
</ul>

    </div>

  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="local-table-of-contents">
      <h4 class="docs-sidebar-section-title">Page Contents</h4>
      <ul>
<li><a class="reference internal" href="#">The Auth System</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#tempauth">TempAuth</a><ul>
<li><a class="reference internal" href="#swift-api-through-tempauth">Swift API through TempAuth</a></li>
</ul>
</li>
<li><a class="reference internal" href="#keystone-auth">Keystone Auth</a><ul>
<li><a class="reference internal" href="#configuring-swift-to-use-keystone">Configuring Swift to use Keystone</a><ul>
<li><a class="reference internal" href="#openstack-service-using-composite-tokens">OpenStack Service Using Composite Tokens</a></li>
</ul>
</li>
<li><a class="reference internal" href="#access-control-using-keystoneauth">Access control using keystoneauth</a></li>
<li><a class="reference internal" href="#troubleshooting-tips-for-keystoneauth-deployment">Troubleshooting tips for keystoneauth deployment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extending-auth">Extending Auth</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="https://openstack.org/projects/">Projects</a></li>
          <li><a href="https://www.openstack.org/software/security/">OpenStack Security</a></li>
          <li><a href="https://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="https://openstack.org/blog/">Blog</a></li>g
          <li><a href="https://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="https://openstack.org/community/">User Groups</a></li>
          <li><a href="https://openstack.org/community/events/">Events</a></li>
          <li><a href="https://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="https://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="https://docs.openstack.org/contributors">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="https://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="https://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="https://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="https://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="https://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="https://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="https://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="_static/js/jquery-3.2.1.min.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="_static/js/bootstrap.min.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="_static/js/docs.js"></script>

<!-- standard sphinx include libraries, which allow search highlighting -->
<script type="text/javascript" src="_static/underscore.js"></script>
<script type="text/javascript" src="_static/doctools.js"></script>
<script type="text/javascript" src="_static/searchtools.js"></script>
<script type="text/javascript" src="_static/language_data.js"></script>

<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:    './',
      VERSION:     '0.1.0.dev10162',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      LINK_SUFFIX: '.html',
      SOURCELINK_SUFFIX: '.txt',
      HAS_SOURCE:  true
    };
</script>

<!-- Javascript for page -->
<script language="JavaScript">
  /* Build a description of this page including SHA, source location on git
   * repo, build time and the project's launchpad bug tag. Set the HREF of the
   * bug buttons
   */
    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
    /* "giturl" is the URL of the source file on Git and is auto-generated by
     * openstackdocstheme.
     *
     * "pagename" is a standard sphinx parameter containing the name of
     * the source file, without extension.
     */

    var sourceFile = "overview_auth" + ".rst";
    gitURL = "Source: https://opendev.org/openstack/swift/src/doc/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: c25d961319e59efe02c05374924ba82b873992e1";
    var repositoryName = "openstack/swift";
    var bugProject = "swift";
    var bugTitle = "The Auth System in Swift";
    var fieldTags = "";
    var useStoryboard = "";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 0.1.0.dev10162 on 2023-05-18 18:31:41";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags, repositoryName, useStoryboard);
    var currentSourceFile = "overview_auth";
    var pdfFileName = "doc-swift.pdf";
    pdfLink(currentSourceFile, pdfFileName);
</script>


  </body>
</html>