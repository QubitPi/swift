
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Container to Container Synchronization &#8212; Swift 0.1.0.dev10164 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/basic.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="canonical" href="/openstack-swift/overview_container_sync.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Expiring Object Support" href="overview_expiring_objects.html" />
    <link rel="prev" title="Global Clusters" href="overview_global_cluster.html" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Bootstrap CSS -->
<link href="_static/css/bootstrap.min.css" rel="stylesheet">

<!-- Fonts -->
<link href="_static/css/font-awesome.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="_static/css/combined.css" rel="stylesheet">

<!-- Search CSS -->
<link href="_static/css/search.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="_static/pygments.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->


  </head><body>

<!-- SOURCE_FILE: https://opendev.org/openstack/swift/src/doc/source/overview_container_sync.rst -->

<script>
    (function (window, document) {
        var loader = function () {
            var script = document.createElement("script"), tag = document.getElementsByTagName("script")[0];
            script.src = "https://search.openstack.org/widget/embed.min.js?t="+Date.now();
            tag.parentNode.insertBefore(script, tag);
        };
        window.addEventListener ? window.addEventListener("load", loader, false) : window.attachEvent("onload", loader);
    })(window, document);
</script>

<nav class="navbar navbar-default" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="https://www.openstack.org/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
    <div class="openstack-search-bar" data-baseUrl="search.openstack.org" data-context="docs-openstack"></div>
</div>
      <ul class="nav navbar-nav navbar-main show">
        <li class="search-container-mobile">
    <div class="openstack-search-bar" data-baseUrl="search.openstack.org" data-context="docs-openstack"></div>
</li>
        <li> <!--Software -->
          <a href="https://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/openstack-components">OpenStack Components</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/sdks">SDKs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/deployment-tools">Deployment Tools</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/assets/software/projectmap/openstack-map.pdf" target="_blank">OpenStack Map</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
          </ul>
        </li>
        <li> <!-- Use Cases -->
          <a href="https://www.openstack.org/use-cases/" class="drop" id="dropdownMenuUsers">Use Cases <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/">Users in Production</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/bare-metal/">Ironic Bare Metal</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/edge-computing/">Edge Computing</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/telecoms-and-nfv/">Telecom & NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/science/">Science and HPC</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/containers/">Containers</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/enterprise/">Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li> <!-- Events -->
          <a href="https://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">Open Infrastructure Summits</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/ptg/">Project Teams Gathering</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/opendev-2020/">OpenDev</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/community-events/">Community Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/openstackdays">OpenStack & OpenInfra Days</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
          </ul>
        </li>
        <li><!-- Community -->
          <a href="https://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/tech-committee">OpenStack Technical Committee</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/coa/">Get Certified (COA)</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketing/">Marketing Resources</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/news/">Community News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/supporting-organizations/">OpenInfra Foundation Supporting Organizations</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev">Open Infrastructure Foundation (OpenInfra Foundation)</a></li>
          </ul>
        </li>
        <li><!-- Marketplace -->
          <a href="https://www.openstack.orgmarketplace/" class="drop" id="dropdownMenuLearn">Marketplace <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/distros/">Distros & Appliances</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/public-clouds/">Public Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/hosted-private-clouds/">Hosted Private Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/remotely-managed-private-clouds/">Remotely Managed Private Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/consulting/">Consulting & Integrators</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/drivers/">Drivers</a></li>
          </ul>
        </li>
        <li><!-- Blog -->
          <a href="https://www.openstack.org/blog/">Blog</a>
        </li>
        <li><!-- Docs -->
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
        <li> <!-- Join -->
            <li class="join-nav-section">
              <a href="https://openinfra.dev/join/" id="dropdownMenuJoin">Join <i class="fa fa-caret-down"></i></a>
              <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuJoin" style="display: none;">
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev/join/">Sign up for Foundation Membership</a></li>
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev/join/">Sponsor the Foundation</a></li>
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev">More about the Foundation</a></li>
              </ul>
            </li>
            <li>
              <a href="https://www.openstack.org/Security/login/?BackURL=/home/" class="sign-in-btn">Log In</a>
            </li>
        </li>
      </ul>
    </div>
  </div>
  <!-- /.container -->
</nav>

    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row docs-title">
  <div class="col-lg-8">
      <h1>Container to Container Synchronization</h1>
    
  </div>
  <div class="docs-actions">
    
    <a href="overview_global_cluster.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Global Clusters"></i></a>
    
    
    <a href="overview_expiring_objects.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Expiring Object Support"></i></a>
    
    <a id="pdfLink1" href="" target="_blank" title="Download the manuals as PDF"><i class="fa fa-file-pdf-o" data-toggle="tooltip" data-placement="top" title="Download PDF"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
    
  </div>
</div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-body" role="main">

  <section id="container-to-container-synchronization">
<h1>Container to Container Synchronization<a class="headerlink" href="#container-to-container-synchronization" title="Permalink to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>Swift has a feature where all the contents of a container can be mirrored to
another container through background synchronization. Swift cluster operators
configure their cluster to allow/accept sync requests to/from other clusters,
and the user specifies where to sync their container to along with a secret
synchronization key.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are using the <a class="reference internal" href="overview_large_objects.html#large-objects"><span class="std std-ref">Large Objects</span></a> feature and
syncing to another cluster then you will need to ensure that manifest files
and segment files are synced. If segment files are in a different container
than their manifest then both the manifest’s container and the segments’
container must be synced. The target container for synced segment files
must always have the same name as their source container in order for them
to be resolved by synced manifests.</p>
<p>Be aware that manifest files may be synced before segment files even if
they are in the same container and were created after the segment files.</p>
<p>In the case of <a class="reference internal" href="overview_large_objects.html#static-large-objects"><span class="std std-ref">Static Large Objects</span></a>, a GET
request for a manifest whose segments have yet to be completely synced will
fail with none or only part of the large object content being returned.</p>
<p>In the case of <a class="reference internal" href="overview_large_objects.html#dynamic-large-objects"><span class="std std-ref">Dynamic Large Objects</span></a>, a GET
request for a manifest whose segments have yet to be completely synced will
either fail or return unexpected (and most likely incorrect) content.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are using encryption middleware in the cluster from which objects
are being synced, then you should follow the instructions for
<a class="reference internal" href="overview_encryption.html#container-sync-client-config"><span class="std std-ref">Container sync configuration</span></a> to be compatible with encryption.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are using symlink middleware in the cluster from which objects
are being synced, then you should follow the instructions for
<a class="reference internal" href="middleware.html#symlink-container-sync-client-config"><span class="std std-ref">Container sync configuration</span></a> to be compatible with symlinks.</p>
<p>Be aware that symlinks may be synced before their targets even if they are
in the same container and were created after the target objects. In such
cases, a GET for the symlink will fail with a <code class="docutils literal notranslate"><span class="pre">404</span> <span class="pre">Not</span> <span class="pre">Found</span></code> error.  If
the target has been overwritten, a GET may produce an older version (for
dynamic links) or a <code class="docutils literal notranslate"><span class="pre">409</span> <span class="pre">Conflict</span></code> error (for static links).</p>
</div>
</section>
<section id="configuring-container-sync">
<h2>Configuring Container Sync<a class="headerlink" href="#configuring-container-sync" title="Permalink to this heading">¶</a></h2>
<p>Create a <code class="docutils literal notranslate"><span class="pre">container-sync-realms.conf</span></code> file specifying the allowable clusters
and their information:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">realm1</span><span class="p">]</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">realm1key</span>
<span class="n">key2</span> <span class="o">=</span> <span class="n">realm1key2</span>
<span class="n">cluster_clustername1</span> <span class="o">=</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">host1</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span>
<span class="n">cluster_clustername2</span> <span class="o">=</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">host2</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span>

<span class="p">[</span><span class="n">realm2</span><span class="p">]</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">realm2key</span>
<span class="n">key2</span> <span class="o">=</span> <span class="n">realm2key2</span>
<span class="n">cluster_clustername3</span> <span class="o">=</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">host3</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span>
<span class="n">cluster_clustername4</span> <span class="o">=</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">host4</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span>
</pre></div>
</div>
<p>Each section name is the name of a sync realm. A sync realm is a set of
clusters that have agreed to allow container syncing with each other. Realm
names will be considered case insensitive.</p>
<p><code class="docutils literal notranslate"><span class="pre">key</span></code> is the overall cluster-to-cluster key used in combination with the
external users’ key that they set on their containers’
<code class="docutils literal notranslate"><span class="pre">X-Container-Sync-Key</span></code> metadata header values. These keys will be used to
sign each request the container sync daemon makes and used to validate each
incoming container sync request.</p>
<p><code class="docutils literal notranslate"><span class="pre">key2</span></code> is optional and is an additional key incoming requests will be checked
against. This is so you can rotate keys if you wish; you move the existing <code class="docutils literal notranslate"><span class="pre">key</span></code>
to <code class="docutils literal notranslate"><span class="pre">key2</span></code> and make a new <code class="docutils literal notranslate"><span class="pre">key</span></code> value.</p>
<p>Any values in the realm section whose names begin with <code class="docutils literal notranslate"><span class="pre">cluster_</span></code> will
indicate the name and endpoint of a cluster and will be used by external users in
their containers’ <code class="docutils literal notranslate"><span class="pre">X-Container-Sync-To</span></code> metadata header values with the format
<code class="docutils literal notranslate"><span class="pre">//realm_name/cluster_name/account_name/container_name</span></code>. Realm and cluster
names are considered case insensitive.</p>
<p>The endpoint is what the container sync daemon will use when sending out
requests to that cluster. Keep in mind this endpoint must be reachable by all
container servers, since that is where the container sync daemon runs. Note
that the endpoint ends with <code class="docutils literal notranslate"><span class="pre">/v1/</span></code> and that the container sync daemon will then
add the <code class="docutils literal notranslate"><span class="pre">account/container/obj</span></code> name after that.</p>
<p>Distribute this <code class="docutils literal notranslate"><span class="pre">container-sync-realms.conf</span></code> file to all your proxy servers
and container servers.</p>
<p>You also need to add the container_sync middleware to your proxy pipeline. It
needs to be after any memcache middleware and before any auth middleware. The
<code class="docutils literal notranslate"><span class="pre">[filter:container_sync]</span></code> section only needs the <code class="docutils literal notranslate"><span class="pre">use</span></code> item. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">pipeline</span><span class="p">:</span><span class="n">main</span><span class="p">]</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">healthcheck</span> <span class="n">proxy</span><span class="o">-</span><span class="n">logging</span> <span class="n">cache</span> <span class="n">container_sync</span> <span class="n">tempauth</span> <span class="n">proxy</span><span class="o">-</span><span class="n">logging</span> <span class="n">proxy</span><span class="o">-</span><span class="n">server</span>

<span class="p">[</span><span class="nb">filter</span><span class="p">:</span><span class="n">container_sync</span><span class="p">]</span>
<span class="n">use</span> <span class="o">=</span> <span class="n">egg</span><span class="p">:</span><span class="n">swift</span><span class="c1">#container_sync</span>
</pre></div>
</div>
<p>The container sync daemon will use an internal client to sync objects. Even if
you don’t configure the internal client, the container sync daemon will work
with default configuration. The default configuration is the same as
<code class="docutils literal notranslate"><span class="pre">internal-client.conf-sample</span></code>. If you want to configure the internal client,
please update <code class="docutils literal notranslate"><span class="pre">internal_client_conf_path</span></code> in <code class="docutils literal notranslate"><span class="pre">container-server.conf</span></code>. The
configuration file at the path will be used for the internal client.</p>
</section>
<section id="old-style-configuring-a-cluster-s-allowable-sync-hosts">
<h2>Old-Style: Configuring a Cluster’s Allowable Sync Hosts<a class="headerlink" href="#old-style-configuring-a-cluster-s-allowable-sync-hosts" title="Permalink to this heading">¶</a></h2>
<p>This section is for the old-style of using container sync. See the previous
section, Configuring Container Sync, for the new-style.</p>
<p>With the old-style, the Swift cluster operator must allow synchronization with
a set of hosts before the user can enable container synchronization. First, the
backend container server needs to be given this list of hosts in the
<code class="docutils literal notranslate"><span class="pre">container-server.conf</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">DEFAULT</span><span class="p">]</span>
<span class="c1"># This is a comma separated list of hosts allowed in the</span>
<span class="c1"># X-Container-Sync-To field for containers.</span>
<span class="c1"># allowed_sync_hosts = 127.0.0.1</span>
<span class="n">allowed_sync_hosts</span> <span class="o">=</span> <span class="n">host1</span><span class="p">,</span><span class="n">host2</span><span class="p">,</span><span class="n">etc</span><span class="o">.</span>
<span class="o">...</span>

<span class="p">[</span><span class="n">container</span><span class="o">-</span><span class="n">sync</span><span class="p">]</span>
<span class="c1"># You can override the default log routing for this app here (don&#39;t</span>
<span class="c1"># use set!):</span>
<span class="c1"># log_name = container-sync</span>
<span class="c1"># log_facility = LOG_LOCAL0</span>
<span class="c1"># log_level = INFO</span>
<span class="c1"># Will sync, at most, each container once per interval</span>
<span class="c1"># interval = 300</span>
<span class="c1"># Maximum amount of time to spend syncing each container</span>
<span class="c1"># container_time = 60</span>
</pre></div>
</div>
</section>
<section id="logging-container-sync">
<h2>Logging Container Sync<a class="headerlink" href="#logging-container-sync" title="Permalink to this heading">¶</a></h2>
<p>Currently, log processing is the only way to track sync progress, problems,
and even just general activity for container synchronization. In that
light, you may wish to set the above <code class="docutils literal notranslate"><span class="pre">log_</span></code> options to direct the
container-sync logs to a different file for easier monitoring. Additionally, it
should be noted there is no way for an end user to monitor sync progress or
detect problems other than HEADing both containers and comparing the overall
information.</p>
</section>
<section id="container-sync-statistics">
<h2>Container Sync Statistics<a class="headerlink" href="#container-sync-statistics" title="Permalink to this heading">¶</a></h2>
<p>Container Sync INFO level logs contain activity metrics and accounting
information for insightful tracking.
Currently two different statistics are collected:</p>
<p>About once an hour or so, accumulated statistics of all operations performed
by Container Sync are reported to the log file with the following format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Since</span> <span class="p">(</span><span class="n">time</span><span class="p">):</span> <span class="p">(</span><span class="n">sync</span><span class="p">)</span> <span class="n">synced</span> <span class="p">[(</span><span class="n">delete</span><span class="p">)</span> <span class="n">deletes</span><span class="p">,</span> <span class="p">(</span><span class="n">put</span><span class="p">)</span> <span class="n">puts</span><span class="p">],</span> <span class="p">(</span><span class="n">skip</span><span class="p">)</span> <span class="n">skipped</span><span class="p">,</span> <span class="p">(</span><span class="n">fail</span><span class="p">)</span> <span class="n">failed</span>
</pre></div>
</div>
<dl class="simple">
<dt>time</dt><dd><p>last report time</p>
</dd>
<dt>sync</dt><dd><p>number of containers with sync turned on that were successfully synced</p>
</dd>
<dt>delete</dt><dd><p>number of successful DELETE object requests to the target cluster</p>
</dd>
<dt>put</dt><dd><p>number of successful PUT object request to the target cluster</p>
</dd>
<dt>skip</dt><dd><p>number of containers whose sync has been turned off, but are not
yet cleared from the sync store</p>
</dd>
<dt>fail</dt><dd><p>number of containers with failure (due to exception, timeout or other
reason)</p>
</dd>
</dl>
<p>For each container synced, per container statistics are reported with the
following format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Container</span> <span class="n">sync</span> <span class="n">report</span><span class="p">:</span> <span class="p">(</span><span class="n">container</span><span class="p">),</span> <span class="n">time</span> <span class="n">window</span> <span class="n">start</span><span class="p">:</span> <span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="n">time</span> <span class="n">window</span> <span class="n">end</span><span class="p">:</span> <span class="o">%</span><span class="p">(</span><span class="n">end</span><span class="p">),</span> <span class="n">puts</span><span class="p">:</span> <span class="p">(</span><span class="n">puts</span><span class="p">),</span> <span class="n">posts</span><span class="p">:</span> <span class="p">(</span><span class="n">posts</span><span class="p">),</span> <span class="n">deletes</span><span class="p">:</span> <span class="p">(</span><span class="n">deletes</span><span class="p">),</span> <span class="nb">bytes</span><span class="p">:</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">),</span> <span class="n">sync_point1</span><span class="p">:</span> <span class="p">(</span><span class="n">point1</span><span class="p">),</span> <span class="n">sync_point2</span><span class="p">:</span> <span class="p">(</span><span class="n">point2</span><span class="p">),</span> <span class="n">total_rows</span><span class="p">:</span> <span class="p">(</span><span class="n">total</span><span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>container</dt><dd><p>account/container statistics are for</p>
</dd>
<dt>start</dt><dd><p>report start time</p>
</dd>
<dt>end</dt><dd><p>report end time</p>
</dd>
<dt>puts</dt><dd><p>number of successful PUT object requests to the target container</p>
</dd>
<dt>posts</dt><dd><p>N/A (0)</p>
</dd>
<dt>deletes</dt><dd><p>number of successful DELETE object requests to the target container</p>
</dd>
<dt>bytes</dt><dd><p>number of bytes sent over the network to the target container</p>
</dd>
<dt>point1</dt><dd><p>progress indication - the container’s <code class="docutils literal notranslate"><span class="pre">x_container_sync_point1</span></code></p>
</dd>
<dt>point2</dt><dd><p>progress indication - the container’s <code class="docutils literal notranslate"><span class="pre">x_container_sync_point2</span></code></p>
</dd>
<dt>total</dt><dd><p>number of objects processed at the container</p>
</dd>
</dl>
<p>It is possible that more than one server syncs a container, therefore log files
from all servers need to be evaluated</p>
</section>
<section id="using-the-swift-tool-to-set-up-synchronized-containers">
<h2>Using the <code class="docutils literal notranslate"><span class="pre">swift</span></code> tool to set up synchronized containers<a class="headerlink" href="#using-the-swift-tool-to-set-up-synchronized-containers" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">swift</span></code> tool is available from the <a class="reference external" href="http://github.com/openstack/python-swiftclient">python-swiftclient</a> library.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You must be the account admin on the account to set synchronization targets
and keys.</p>
</div>
<p>You simply tell each container where to sync to and give it a secret
synchronization key. First, let’s get the account details for our two cluster
accounts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ swift -A http://cluster1/auth/v1.0 -U test:tester -K testing stat -v
StorageURL: http://cluster1/v1/AUTH_208d1854-e475-4500-b315-81de645d060e
Auth Token: AUTH_tkd5359e46ff9e419fa193dbd367f3cd19
   Account: AUTH_208d1854-e475-4500-b315-81de645d060e
Containers: 0
   Objects: 0
     Bytes: 0

$ swift -A http://cluster2/auth/v1.0 -U test2:tester2 -K testing2 stat -v
StorageURL: http://cluster2/v1/AUTH_33cdcad8-09fb-4940-90da-0f00cbf21c7c
Auth Token: AUTH_tk816a1aaf403c49adb92ecfca2f88e430
   Account: AUTH_33cdcad8-09fb-4940-90da-0f00cbf21c7c
Containers: 0
   Objects: 0
     Bytes: 0
</pre></div>
</div>
<p>Now, let’s make our first container and tell it to synchronize to a second
we’ll make next:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ swift -A http://cluster1/auth/v1.0 -U test:tester -K testing post \
  -t &#39;//realm_name/clustername2/AUTH_33cdcad8-09fb-4940-90da-0f00cbf21c7c/container2&#39; \
  -k &#39;secret&#39; container1
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-t</span></code> indicates the cluster to sync to, which is the realm name of the
section from <code class="docutils literal notranslate"><span class="pre">container-sync-realms.conf</span></code>, followed by the cluster name from
that section (without the <code class="docutils literal notranslate"><span class="pre">cluster_</span></code> prefix), followed by the account and container
names we want to sync to. The <code class="docutils literal notranslate"><span class="pre">-k</span></code> specifies the secret key the two containers will share for
synchronization; this is the user key, the cluster key in
<code class="docutils literal notranslate"><span class="pre">container-sync-realms.conf</span></code> will also be used behind the scenes.</p>
<p>Now, we’ll do something similar for the second cluster’s container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ swift -A http://cluster2/auth/v1.0 -U test2:tester2 -K testing2 post \
  -t &#39;//realm_name/clustername1/AUTH_208d1854-e475-4500-b315-81de645d060e/container1&#39; \
  -k &#39;secret&#39; container2
</pre></div>
</div>
<p>That’s it. Now we can upload a bunch of stuff to the first container and watch
as it gets synchronized over to the second:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ swift -A http://cluster1/auth/v1.0 -U test:tester -K testing \
  upload container1 .
photo002.png
photo004.png
photo001.png
photo003.png

$ swift -A http://cluster2/auth/v1.0 -U test2:tester2 -K testing2 \
  list container2

[Nothing there yet, so we wait a bit...]
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you’re an operator running <a class="reference internal" href="development_saio.html#saio"><span class="std std-ref">SAIO (Swift All In One)</span></a> and just testing, each time you
configure a container for synchronization and place objects in the
source container you will need to ensure that container-sync runs
before attempting to retrieve objects from the target container.
That is, you need to run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">swift</span><span class="o">-</span><span class="n">init</span> <span class="n">container</span><span class="o">-</span><span class="n">sync</span> <span class="n">once</span>
</pre></div>
</div>
</div>
<p>Now expect to see objects copied from the first container to the second:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ swift -A http://cluster2/auth/v1.0 -U test2:tester2 -K testing2 \
  list container2
photo001.png
photo002.png
photo003.png
photo004.png
</pre></div>
</div>
<p>You can also set up a chain of synced containers if you want more than two.
You’d point 1 -&gt; 2, then 2 -&gt; 3, and finally 3 -&gt; 1 for three containers.
They’d all need to share the same secret synchronization key.</p>
</section>
<section id="using-curl-or-other-tools-instead">
<h2>Using curl (or other tools) instead<a class="headerlink" href="#using-curl-or-other-tools-instead" title="Permalink to this heading">¶</a></h2>
<p>So what’s <code class="docutils literal notranslate"><span class="pre">swift</span></code> doing behind the scenes? Nothing overly complicated. It
translates the <code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">&lt;value&gt;</span></code> option into an <code class="docutils literal notranslate"><span class="pre">X-Container-Sync-To:</span> <span class="pre">&lt;value&gt;</span></code>
header and the <code class="docutils literal notranslate"><span class="pre">-k</span> <span class="pre">&lt;value&gt;</span></code> option into an <code class="docutils literal notranslate"><span class="pre">X-Container-Sync-Key:</span> <span class="pre">&lt;value&gt;</span></code>
header.</p>
<p>For instance, when we created the first container above and told it to
synchronize to the second, we could have used this curl command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -i -X POST -H &#39;X-Auth-Token: AUTH_tkd5359e46ff9e419fa193dbd367f3cd19&#39; \
  -H &#39;X-Container-Sync-To: //realm_name/clustername2/AUTH_33cdcad8-09fb-4940-90da-0f00cbf21c7c/container2&#39; \
  -H &#39;X-Container-Sync-Key: secret&#39; \
  &#39;http://cluster1/v1/AUTH_208d1854-e475-4500-b315-81de645d060e/container1&#39;
HTTP/1.1 204 No Content
Content-Length: 0
Content-Type: text/plain; charset=UTF-8
Date: Thu, 24 Feb 2011 22:39:14 GMT
</pre></div>
</div>
</section>
<section id="old-style-using-the-swift-tool-to-set-up-synchronized-containers">
<h2>Old-Style: Using the <code class="docutils literal notranslate"><span class="pre">swift</span></code> tool to set up synchronized containers<a class="headerlink" href="#old-style-using-the-swift-tool-to-set-up-synchronized-containers" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">swift</span></code> tool is available from the <a class="reference external" href="http://github.com/openstack/python-swiftclient">python-swiftclient</a> library.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You must be the account admin on the account to set synchronization targets
and keys.</p>
</div>
<p>This is for the old-style of container syncing using <code class="docutils literal notranslate"><span class="pre">allowed_sync_hosts</span></code>.</p>
<p>You simply tell each container where to sync to and give it a secret
synchronization key. First, let’s get the account details for our two cluster
accounts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ swift -A http://cluster1/auth/v1.0 -U test:tester -K testing stat -v
StorageURL: http://cluster1/v1/AUTH_208d1854-e475-4500-b315-81de645d060e
Auth Token: AUTH_tkd5359e46ff9e419fa193dbd367f3cd19
   Account: AUTH_208d1854-e475-4500-b315-81de645d060e
Containers: 0
   Objects: 0
     Bytes: 0

$ swift -A http://cluster2/auth/v1.0 -U test2:tester2 -K testing2 stat -v
StorageURL: http://cluster2/v1/AUTH_33cdcad8-09fb-4940-90da-0f00cbf21c7c
Auth Token: AUTH_tk816a1aaf403c49adb92ecfca2f88e430
   Account: AUTH_33cdcad8-09fb-4940-90da-0f00cbf21c7c
Containers: 0
   Objects: 0
     Bytes: 0
</pre></div>
</div>
<p>Now, let’s make our first container and tell it to synchronize to a second
we’ll make next:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ swift -A http://cluster1/auth/v1.0 -U test:tester -K testing post \
  -t &#39;http://cluster2/v1/AUTH_33cdcad8-09fb-4940-90da-0f00cbf21c7c/container2&#39; \
  -k &#39;secret&#39; container1
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-t</span></code> indicates the URL to sync to, which is the <code class="docutils literal notranslate"><span class="pre">StorageURL</span></code> from
cluster2 we retrieved above plus the container name. The <code class="docutils literal notranslate"><span class="pre">-k</span></code> specifies the
secret key the two containers will share for synchronization. Now, we’ll do
something similar for the second cluster’s container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ swift -A http://cluster2/auth/v1.0 -U test2:tester2 -K testing2 post \
  -t &#39;http://cluster1/v1/AUTH_208d1854-e475-4500-b315-81de645d060e/container1&#39; \
  -k &#39;secret&#39; container2
</pre></div>
</div>
<p>That’s it. Now we can upload a bunch of stuff to the first container and watch
as it gets synchronized over to the second:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ swift -A http://cluster1/auth/v1.0 -U test:tester -K testing \
  upload container1 .
photo002.png
photo004.png
photo001.png
photo003.png

$ swift -A http://cluster2/auth/v1.0 -U test2:tester2 -K testing2 \
  list container2

[Nothing there yet, so we wait a bit...]
[If you&#39;re an operator running SAIO and just testing, you may need to
 run &#39;swift-init container-sync once&#39; to perform a sync scan.]

$ swift -A http://cluster2/auth/v1.0 -U test2:tester2 -K testing2 \
  list container2
photo001.png
photo002.png
photo003.png
photo004.png
</pre></div>
</div>
<p>You can also set up a chain of synced containers if you want more than two.
You’d point 1 -&gt; 2, then 2 -&gt; 3, and finally 3 -&gt; 1 for three containers.
They’d all need to share the same secret synchronization key.</p>
</section>
<section id="old-style-using-curl-or-other-tools-instead">
<h2>Old-Style: Using curl (or other tools) instead<a class="headerlink" href="#old-style-using-curl-or-other-tools-instead" title="Permalink to this heading">¶</a></h2>
<p>This is for the old-style of container syncing using <code class="docutils literal notranslate"><span class="pre">allowed_sync_hosts</span></code>.</p>
<p>So what’s <code class="docutils literal notranslate"><span class="pre">swift</span></code> doing behind the scenes? Nothing overly complicated. It
translates the <code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">&lt;value&gt;</span></code> option into an <code class="docutils literal notranslate"><span class="pre">X-Container-Sync-To:</span> <span class="pre">&lt;value&gt;</span></code>
header and the <code class="docutils literal notranslate"><span class="pre">-k</span> <span class="pre">&lt;value&gt;</span></code> option into an <code class="docutils literal notranslate"><span class="pre">X-Container-Sync-Key:</span> <span class="pre">&lt;value&gt;</span></code>
header.</p>
<p>For instance, when we created the first container above and told it to
synchronize to the second, we could have used this curl command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -i -X POST -H &#39;X-Auth-Token: AUTH_tkd5359e46ff9e419fa193dbd367f3cd19&#39; \
  -H &#39;X-Container-Sync-To: http://cluster2/v1/AUTH_33cdcad8-09fb-4940-90da-0f00cbf21c7c/container2&#39; \
  -H &#39;X-Container-Sync-Key: secret&#39; \
  &#39;http://cluster1/v1/AUTH_208d1854-e475-4500-b315-81de645d060e/container1&#39;
HTTP/1.1 204 No Content
Content-Length: 0
Content-Type: text/plain; charset=UTF-8
Date: Thu, 24 Feb 2011 22:39:14 GMT
</pre></div>
</div>
</section>
<section id="what-s-going-on-behind-the-scenes-in-the-cluster">
<h2>What’s going on behind the scenes, in the cluster?<a class="headerlink" href="#what-s-going-on-behind-the-scenes-in-the-cluster" title="Permalink to this heading">¶</a></h2>
<p>Container ring devices have a directory called <code class="docutils literal notranslate"><span class="pre">containers</span></code>, where container
databases reside. In addition to <code class="docutils literal notranslate"><span class="pre">containers</span></code>, each container ring device
also has a directory called <code class="docutils literal notranslate"><span class="pre">sync-containers</span></code>. <code class="docutils literal notranslate"><span class="pre">sync-containers</span></code> holds
symlinks to container databases that were configured for container sync using
<code class="docutils literal notranslate"><span class="pre">x-container-sync-to</span></code> and <code class="docutils literal notranslate"><span class="pre">x-container-sync-key</span></code> metadata keys.</p>
<p>The swift-container-sync process does the job of sending updates to the remote
container. This is done by scanning <code class="docutils literal notranslate"><span class="pre">sync-containers</span></code> for container
databases. For each container db found, newer rows since the last sync will
trigger PUTs or DELETEs to the other container.</p>
<p><code class="docutils literal notranslate"><span class="pre">sync-containers</span></code> is maintained as follows:
Whenever the container-server processes a PUT or a POST request that carries
<code class="docutils literal notranslate"><span class="pre">x-container-sync-to</span></code> and <code class="docutils literal notranslate"><span class="pre">x-container-sync-key</span></code> metadata keys the server
creates a symlink to the container database in <code class="docutils literal notranslate"><span class="pre">sync-containers</span></code>. Whenever
the container server deletes a synced container, the appropriate symlink
is deleted from <code class="docutils literal notranslate"><span class="pre">sync-containers</span></code>.</p>
<p>In addition to the container-server, the container-replicator process does the
job of identifying containers that should be synchronized. This is done by
scanning the local devices for container databases and checking for
<code class="docutils literal notranslate"><span class="pre">x-container-sync-to</span></code> and <code class="docutils literal notranslate"><span class="pre">x-container-sync-key</span></code> metadata values. If they exist
then a symlink to the container database is created in a <code class="docutils literal notranslate"><span class="pre">sync-containers</span></code>
sub-directory on the same device.</p>
<p>Similarly, when the container sync metadata keys are deleted, the container
server and container-replicator would take care of deleting the symlinks
from <code class="docutils literal notranslate"><span class="pre">sync-containers</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The swift-container-sync process runs on each container server in the
cluster and talks to the proxy servers (or load balancers) in the remote
cluster. Therefore, the container servers must be permitted to initiate
outbound connections to the remote proxy servers (or load balancers).</p>
</div>
<p>The actual syncing is slightly more complicated to make use of the three
(or number-of-replicas) main nodes for a container without each trying to
do the exact same work but also without missing work if one node happens to
be down.</p>
<p>Two sync points are kept in each container database. When syncing a
container, the container-sync process figures out which replica of the
container it has. In a standard 3-replica scenario, the process will
have either replica number 0, 1, or 2. This is used to figure out
which rows belong to this sync process and which ones don’t.</p>
<p>An example may help. Assume a replica count of 3 and database row IDs
are 1..6. Also, assume that container-sync is running on this
container for the first time, hence SP1 = SP2 = -1.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SP1</span>
<span class="n">SP2</span>
 <span class="o">|</span>
 <span class="n">v</span>
<span class="o">-</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span>
</pre></div>
</div>
<p>First, the container-sync process looks for rows with id between SP1
and SP2. Since this is the first run, SP1 = SP2 = -1, and there aren’t
any such rows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SP1</span>
<span class="n">SP2</span>
 <span class="o">|</span>
 <span class="n">v</span>
<span class="o">-</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span>
</pre></div>
</div>
<p>Second, the container-sync process looks for rows with id greater than
SP1, and syncs those rows which it owns. Ownership is based on the
hash of the object name, so it’s not always guaranteed to be exactly
one out of every three rows, but it usually gets close. For the sake
of example, let’s say that this process ends up owning rows 2 and 5.</p>
<p>Once it’s finished trying to sync those rows, it updates SP1 to be the
biggest row-id that it’s seen, which is 6 in this example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SP2</span>           <span class="n">SP1</span>
 <span class="o">|</span>             <span class="o">|</span>
 <span class="n">v</span>             <span class="n">v</span>
<span class="o">-</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span>
</pre></div>
</div>
<p>While all that was going on, clients uploaded new objects into the
container, creating new rows in the database.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SP2</span>           <span class="n">SP1</span>
 <span class="o">|</span>             <span class="o">|</span>
 <span class="n">v</span>             <span class="n">v</span>
<span class="o">-</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span>
</pre></div>
</div>
<p>On the next run, the container-sync starts off looking at rows with
ids between SP1 and SP2. This time, there are a bunch of them. The
sync process try to sync all of them. If it succeeds, it will set
SP2 to equal SP1. If it fails, it will set SP2 to the failed object
and will continue to try all other objects till SP1, setting SP2 to
the first object that failed.</p>
<p>Under normal circumstances, the container-sync processes
will have already taken care of synchronizing all rows, between SP1
and SP2, resulting in a set of quick checks.
However, if one of the sync
processes failed for some reason, then this is a vital fallback to
make sure all the objects in the container get synchronized. Without
this seemingly-redundant work, any container-sync failure results in
unsynchronized objects. Note that the container sync will persistently
retry to sync any faulty object until success, while logging each failure.</p>
<p>Once it’s done with the fallback rows, and assuming no faults occurred,
SP2 is advanced to SP1.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>              <span class="n">SP2</span>
              <span class="n">SP1</span>
               <span class="o">|</span>
               <span class="n">v</span>
<span class="o">-</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span>
</pre></div>
</div>
<p>Then, rows with row ID greater than SP1 are synchronized (provided
this container-sync process is responsible for them), and SP1 is moved
up to the greatest row ID seen.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>              <span class="n">SP2</span>            <span class="n">SP1</span>
               <span class="o">|</span>              <span class="o">|</span>
               <span class="n">v</span>              <span class="n">v</span>
<span class="o">-</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span>
</pre></div>
</div>
</section>
</section>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="overview_global_cluster.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Global Clusters"></i></a>
          
          
            <a href="overview_expiring_objects.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Expiring Object Support"></i></a>
          
          <a id="pdfLink2" href="" target="_blank" title="Download the manuals as PDF"><i class="fa fa-file-pdf-o" data-toggle="tooltip" data-placement="top" title="Download PDF"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">this page last updated: 2019-12-10 16:32:47</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="https://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the
                 document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="OpenStack Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/id/">Bahasa Indonesia (Indonesian)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/it/">Italiano (Italian)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/tr_TR/">Türkçe (Türkiye)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="index.html" class="docs-sidebar-section-title"><h4>Swift 0.1.0.dev10164</h4></a>
      <ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api/object_api_v1_overview.html">Object Storage API overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_architecture.html">Swift Architectural Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_ring.html">The Rings</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_policies.html">Storage Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_reaper.html">The Account Reaper</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_auth.html">The Auth System</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_acl.html">Access Control Lists (ACLs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_replication.html">Replication</a></li>
<li class="toctree-l1"><a class="reference internal" href="ratelimit.html">Rate Limiting</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_large_objects.html">Large Object Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_global_cluster.html">Global Clusters</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Container to Container Synchronization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-container-sync">Configuring Container Sync</a></li>
<li class="toctree-l2"><a class="reference internal" href="#old-style-configuring-a-cluster-s-allowable-sync-hosts">Old-Style: Configuring a Cluster’s Allowable Sync Hosts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#logging-container-sync">Logging Container Sync</a></li>
<li class="toctree-l2"><a class="reference internal" href="#container-sync-statistics">Container Sync Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-swift-tool-to-set-up-synchronized-containers">Using the <code class="docutils literal notranslate"><span class="pre">swift</span></code> tool to set up synchronized containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-curl-or-other-tools-instead">Using curl (or other tools) instead</a></li>
<li class="toctree-l2"><a class="reference internal" href="#old-style-using-the-swift-tool-to-set-up-synchronized-containers">Old-Style: Using the <code class="docutils literal notranslate"><span class="pre">swift</span></code> tool to set up synchronized containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#old-style-using-curl-or-other-tools-instead">Old-Style: Using curl (or other tools) instead</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-going-on-behind-the-scenes-in-the-cluster">What’s going on behind the scenes, in the cluster?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="overview_expiring_objects.html">Expiring Object Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="cors.html">CORS</a></li>
<li class="toctree-l1"><a class="reference internal" href="crossdomain.html">Cross-domain Policy File</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_erasure_code.html">Erasure Code Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_encryption.html">Object Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_backing_store.html">Using Swift as Backing Store for Service Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_container_sharding.html">Container Sharding</a></li>
<li class="toctree-l1"><a class="reference internal" href="ring_background.html">Building a Consistent Hashing Ring</a></li>
<li class="toctree-l1"><a class="reference internal" href="ring_partpower.html">Modifying Ring Partition Power</a></li>
<li class="toctree-l1"><a class="reference internal" href="associated_projects.html">Associated Projects</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html">Contributing to OpenStack Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#swift-design-principles">Swift Design Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#recommended-workflow">Recommended workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#notes-on-testing">Notes on Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#ideas">Ideas</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#community">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/review_guidelines.html">Review Guidelines</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="development_guidelines.html">Development Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_saio.html">SAIO (Swift All In One)</a></li>
<li class="toctree-l1"><a class="reference internal" href="first_contribution_swift.html">First Contribution to Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="policies_saio.html">Adding Storage Policies to an Existing SAIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_auth.html">Auth Server and Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_middleware.html">Middleware and Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_ondisk_backends.html">Pluggable On-Disk Back-end APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_watchers.html">Auditor Watchers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="deployment_guide.html">Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_deployment_guide.html">Apache Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin_guide.html">Administrator’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="replication_network.html">Dedicated replication network</a></li>
<li class="toctree-l1"><a class="reference internal" href="logs.html">Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ops_runbook/index.html">Swift Ops Runbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin/index.html">OpenStack Swift Administrator Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="install/index.html">Object Storage Install Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="config/index.html">Configuration Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/object_api_v1_overview.html">Object Storage API overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/discoverability.html">Discoverability</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/container_quotas.html">Container quotas</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/object_versioning.html">Object versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/large_objects.html">Large objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/temporary_url_middleware.html">Temporary URL middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/form_post_middleware.html">Form POST middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/use_content-encoding_metadata.html">Use Content-Encoding metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/use_the_content-disposition_metadata.html">Use the Content-Disposition metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/pseudo-hierarchical-folders-directories.html">Pseudo-hierarchical folders and directories</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/pagination.html">Page through large lists of containers or objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/serialized-response-formats.html">Serialized response formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/static-website.html">Create static website</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/object-expiration.html">Object expiration</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/bulk-delete.html">Bulk delete</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="s3_compat.html">S3/Swift REST API Comparison Matrix</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ring.html">Partitioned Consistent Hash Ring</a></li>
<li class="toctree-l1"><a class="reference internal" href="proxy.html">Proxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="account.html">Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="container.html">Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="db.html">Account DB and Container DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="object.html">Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">Misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="middleware.html">Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="audit_watchers.html">Object Audit Watchers</a></li>
</ul>

    </div>

  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="local-table-of-contents">
      <h4 class="docs-sidebar-section-title">Page Contents</h4>
      <ul>
<li><a class="reference internal" href="#">Container to Container Synchronization</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#configuring-container-sync">Configuring Container Sync</a></li>
<li><a class="reference internal" href="#old-style-configuring-a-cluster-s-allowable-sync-hosts">Old-Style: Configuring a Cluster’s Allowable Sync Hosts</a></li>
<li><a class="reference internal" href="#logging-container-sync">Logging Container Sync</a></li>
<li><a class="reference internal" href="#container-sync-statistics">Container Sync Statistics</a></li>
<li><a class="reference internal" href="#using-the-swift-tool-to-set-up-synchronized-containers">Using the <code class="docutils literal notranslate"><span class="pre">swift</span></code> tool to set up synchronized containers</a></li>
<li><a class="reference internal" href="#using-curl-or-other-tools-instead">Using curl (or other tools) instead</a></li>
<li><a class="reference internal" href="#old-style-using-the-swift-tool-to-set-up-synchronized-containers">Old-Style: Using the <code class="docutils literal notranslate"><span class="pre">swift</span></code> tool to set up synchronized containers</a></li>
<li><a class="reference internal" href="#old-style-using-curl-or-other-tools-instead">Old-Style: Using curl (or other tools) instead</a></li>
<li><a class="reference internal" href="#what-s-going-on-behind-the-scenes-in-the-cluster">What’s going on behind the scenes, in the cluster?</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="https://openstack.org/projects/">Projects</a></li>
          <li><a href="https://www.openstack.org/software/security/">OpenStack Security</a></li>
          <li><a href="https://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="https://openstack.org/blog/">Blog</a></li>g
          <li><a href="https://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="https://openstack.org/community/">User Groups</a></li>
          <li><a href="https://openstack.org/community/events/">Events</a></li>
          <li><a href="https://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="https://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="https://docs.openstack.org/contributors">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="https://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="https://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="https://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="https://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="https://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="https://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="https://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="_static/js/jquery-3.2.1.min.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="_static/js/bootstrap.min.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="_static/js/docs.js"></script>

<!-- standard sphinx include libraries, which allow search highlighting -->
<script type="text/javascript" src="_static/underscore.js"></script>
<script type="text/javascript" src="_static/doctools.js"></script>
<script type="text/javascript" src="_static/searchtools.js"></script>
<script type="text/javascript" src="_static/language_data.js"></script>

<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:    './',
      VERSION:     '0.1.0.dev10164',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      LINK_SUFFIX: '.html',
      SOURCELINK_SUFFIX: '.txt',
      HAS_SOURCE:  true
    };
</script>

<!-- Javascript for page -->
<script language="JavaScript">
  /* Build a description of this page including SHA, source location on git
   * repo, build time and the project's launchpad bug tag. Set the HREF of the
   * bug buttons
   */
    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
    /* "giturl" is the URL of the source file on Git and is auto-generated by
     * openstackdocstheme.
     *
     * "pagename" is a standard sphinx parameter containing the name of
     * the source file, without extension.
     */

    var sourceFile = "overview_container_sync" + ".rst";
    gitURL = "Source: https://opendev.org/openstack/swift/src/doc/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: c7afe681fd119752e66a8e9032e8782641fec3ff";
    var repositoryName = "openstack/swift";
    var bugProject = "swift";
    var bugTitle = "Container to Container Synchronization in Swift";
    var fieldTags = "";
    var useStoryboard = "";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 0.1.0.dev10164 on 2019-12-10 16:32:47";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags, repositoryName, useStoryboard);
    var currentSourceFile = "overview_container_sync";
    var pdfFileName = "doc-swift.pdf";
    pdfLink(currentSourceFile, pdfFileName);
</script>


  </body>
</html>