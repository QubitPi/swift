
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Pluggable On-Disk Back-end APIs &#8212; Swift 0.1.0.dev10162 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/basic.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="canonical" href="/openstack-swift/development_ondisk_backends.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Auditor Watchers" href="development_watchers.html" />
    <link rel="prev" title="Middleware and Metadata" href="development_middleware.html" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Bootstrap CSS -->
<link href="_static/css/bootstrap.min.css" rel="stylesheet">

<!-- Fonts -->
<link href="_static/css/font-awesome.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="_static/css/combined.css" rel="stylesheet">

<!-- Search CSS -->
<link href="_static/css/search.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="_static/pygments.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->


  </head><body>

<!-- SOURCE_FILE: https://opendev.org/openstack/swift/src/doc/source/development_ondisk_backends.rst -->

<script>
    (function (window, document) {
        var loader = function () {
            var script = document.createElement("script"), tag = document.getElementsByTagName("script")[0];
            script.src = "https://search.openstack.org/widget/embed.min.js?t="+Date.now();
            tag.parentNode.insertBefore(script, tag);
        };
        window.addEventListener ? window.addEventListener("load", loader, false) : window.attachEvent("onload", loader);
    })(window, document);
</script>

<nav class="navbar navbar-default" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="https://www.openstack.org/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
    <div class="openstack-search-bar" data-baseUrl="search.openstack.org" data-context="docs-openstack"></div>
</div>
      <ul class="nav navbar-nav navbar-main show">
        <li class="search-container-mobile">
    <div class="openstack-search-bar" data-baseUrl="search.openstack.org" data-context="docs-openstack"></div>
</li>
        <li> <!--Software -->
          <a href="https://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/openstack-components">OpenStack Components</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/sdks">SDKs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/deployment-tools">Deployment Tools</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/assets/software/projectmap/openstack-map.pdf" target="_blank">OpenStack Map</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
          </ul>
        </li>
        <li> <!-- Use Cases -->
          <a href="https://www.openstack.org/use-cases/" class="drop" id="dropdownMenuUsers">Use Cases <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/">Users in Production</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/bare-metal/">Ironic Bare Metal</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/edge-computing/">Edge Computing</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/telecoms-and-nfv/">Telecom & NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/science/">Science and HPC</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/containers/">Containers</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/enterprise/">Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li> <!-- Events -->
          <a href="https://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">Open Infrastructure Summits</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/ptg/">Project Teams Gathering</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/opendev-2020/">OpenDev</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/community-events/">Community Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/openstackdays">OpenStack & OpenInfra Days</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
          </ul>
        </li>
        <li><!-- Community -->
          <a href="https://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/tech-committee">OpenStack Technical Committee</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/coa/">Get Certified (COA)</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketing/">Marketing Resources</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/news/">Community News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/supporting-organizations/">OpenInfra Foundation Supporting Organizations</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev">Open Infrastructure Foundation (OpenInfra Foundation)</a></li>
          </ul>
        </li>
        <li><!-- Marketplace -->
          <a href="https://www.openstack.orgmarketplace/" class="drop" id="dropdownMenuLearn">Marketplace <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/distros/">Distros & Appliances</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/public-clouds/">Public Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/hosted-private-clouds/">Hosted Private Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/remotely-managed-private-clouds/">Remotely Managed Private Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/consulting/">Consulting & Integrators</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/drivers/">Drivers</a></li>
          </ul>
        </li>
        <li><!-- Blog -->
          <a href="https://www.openstack.org/blog/">Blog</a>
        </li>
        <li><!-- Docs -->
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
        <li> <!-- Join -->
            <li class="join-nav-section">
              <a href="https://openinfra.dev/join/" id="dropdownMenuJoin">Join <i class="fa fa-caret-down"></i></a>
              <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuJoin" style="display: none;">
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev/join/">Sign up for Foundation Membership</a></li>
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev/join/">Sponsor the Foundation</a></li>
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev">More about the Foundation</a></li>
              </ul>
            </li>
            <li>
              <a href="https://www.openstack.org/Security/login/?BackURL=/home/" class="sign-in-btn">Log In</a>
            </li>
        </li>
      </ul>
    </div>
  </div>
  <!-- /.container -->
</nav>

    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row docs-title">
  <div class="col-lg-8">
      <h1>Pluggable On-Disk Back-end APIs</h1>
    
  </div>
  <div class="docs-actions">
    
    <a href="development_middleware.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Middleware and Metadata"></i></a>
    
    
    <a href="development_watchers.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Auditor Watchers"></i></a>
    
    <a id="pdfLink1" href="" target="_blank" title="Download the manuals as PDF"><i class="fa fa-file-pdf-o" data-toggle="tooltip" data-placement="top" title="Download PDF"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
    
  </div>
</div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-body" role="main">

  <section id="pluggable-on-disk-back-end-apis">
<h1>Pluggable On-Disk Back-end APIs<a class="headerlink" href="#pluggable-on-disk-back-end-apis" title="Permalink to this heading">¶</a></h1>
<p>The internal REST API used between the proxy server and the account, container
and object server is almost identical to public Swift REST API, but with a few
internal extensions (for example, update an account with a new container).</p>
<p>The pluggable back-end APIs for the three REST API servers (account,
container, object) abstracts the needs for servicing the various REST APIs
from the details of how data is laid out and stored on-disk.</p>
<p>The APIs are documented in the reference implementations for all three
servers. For historical reasons, the object server backend reference
implementation module is named <code class="docutils literal notranslate"><span class="pre">diskfile</span></code>, while the account and container
server backend reference implementation modules are named appropriately.</p>
<p>This API is still under development and not yet finalized.</p>
<section id="back-end-api-for-account-server-rest-apis">
<h2>Back-end API for Account Server REST APIs<a class="headerlink" href="#back-end-api-for-account-server-rest-apis" title="Permalink to this heading">¶</a></h2>
<p>Pluggable Back-end for Account Server</p>
<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.account.backend.</span></span><span class="sig-name descname"><span class="pre">AccountBroker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">container</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pending_timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stale_reads_ok</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_commits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Encapsulates working with an account database.</p>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">create_account_stat_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">put_timestamp</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Create account_stat table which is specific to the account DB.
Not a part of Pluggable Back-ends, internal to the baseline code.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>conn</strong> – DB connection object</p></li>
<li><p><strong>put_timestamp</strong> – put timestamp</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">create_container_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Create container table which is specific to the account DB.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>conn</strong> – DB connection object</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">create_policy_stat_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Create policy_stat table which is specific to the account DB.
Not a part of Pluggable Back-ends, internal to the baseline code.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>conn</strong> – DB connection object</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">empty</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Check if the account DB is empty.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>True if the database has no active containers.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_info</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Get global data for the account.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict with keys: account, created_at, put_timestamp,
delete_timestamp, status_changed_at, container_count,
object_count, bytes_used, hash, id</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_policy_stats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">do_migrations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Get global policy stats for the account.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>do_migrations</strong> – boolean, if True the policy stat dicts will
always include the ‘container_count’ key;
otherwise it may be omitted on legacy databases
until they are migrated.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>dict of policy stats where the key is the policy index and
the value is a dictionary like {‘object_count’: M,
‘bytes_used’: N, ‘container_count’: L}</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">is_status_deleted</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Only returns true if the status field is set to DELETED.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">list_containers_iter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">limit</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">marker</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_marker</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delimiter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reverse</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_reserved</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Get a list of containers sorted by name starting at marker onward, up
to limit entries. Entries will begin with the prefix and will not have
the delimiter after the prefix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>limit</strong> – maximum number of entries to get</p></li>
<li><p><strong>marker</strong> – marker query</p></li>
<li><p><strong>end_marker</strong> – end marker query</p></li>
<li><p><strong>prefix</strong> – prefix query</p></li>
<li><p><strong>delimiter</strong> – delimiter for query</p></li>
<li><p><strong>reverse</strong> – reverse the result order.</p></li>
<li><p><strong>allow_reserved</strong> – exclude names with reserved-byte by default</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>list of tuples of (name, object_count, bytes_used,
put_timestamp, 0)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">make_tuple_for_pickle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">record</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Turn this db record dict into the format this service uses for
pending pickles.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">merge_items</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">item_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Merge items into the container table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>item_list</strong> – list of dictionaries of {‘name’, ‘put_timestamp’,
‘delete_timestamp’, ‘object_count’, ‘bytes_used’,
‘deleted’, ‘storage_policy_index’}</p></li>
<li><p><strong>source</strong> – if defined, update incoming_sync with the source</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">put_container</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">put_timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delete_timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_count</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bytes_used</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">storage_policy_index</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Create a container with the given attributes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – name of the container to create (a native string)</p></li>
<li><p><strong>put_timestamp</strong> – put_timestamp of the container to create</p></li>
<li><p><strong>delete_timestamp</strong> – delete_timestamp of the container to create</p></li>
<li><p><strong>object_count</strong> – number of objects in the container</p></li>
<li><p><strong>bytes_used</strong> – number of bytes used by the container</p></li>
<li><p><strong>storage_policy_index</strong> – the storage policy for this container</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="back-end-api-for-container-server-rest-apis">
<h2>Back-end API for Container Server REST APIs<a class="headerlink" href="#back-end-api-for-container-server-rest-apis" title="Permalink to this heading">¶</a></h2>
<p>Pluggable Back-ends for Container Server</p>
<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.container.backend.</span></span><span class="sig-name descname"><span class="pre">ContainerBroker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">container</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pending_timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stale_reads_ok</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_commits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_db_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Encapsulates working with a container database.</p>
<p>Note that this may involve multiple on-disk DB files if the container
becomes sharded:</p>
<ul class="simple">
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">_db_file</span></code> is the path to the legacy container DB name, i.e.
<code class="docutils literal notranslate"><span class="pre">&lt;hash&gt;.db</span></code>. This file should exist for an initialised broker that
has never been sharded, but will not exist once a container has been
sharded.</p></li>
<li><p><a class="reference internal" href="container.html#swift.container.backend.ContainerBroker.db_files" title="swift.container.backend.ContainerBroker.db_files"><code class="xref py py-attr docutils literal notranslate"><span class="pre">db_files</span></code></a> is a list of existing db files for the broker. This
list should have at least one entry for an initialised broker, and
should have two entries while a broker is in SHARDING state.</p></li>
<li><p><a class="reference internal" href="container.html#swift.container.backend.ContainerBroker.db_file" title="swift.container.backend.ContainerBroker.db_file"><code class="xref py py-attr docutils literal notranslate"><span class="pre">db_file</span></code></a> is the path to whichever db is currently authoritative
for the container. Depending on the container’s state, this may not be
the same as the <code class="docutils literal notranslate"><span class="pre">db_file</span></code> argument given to <code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code>, unless
<code class="docutils literal notranslate"><span class="pre">force_db_file</span></code> is True in which case <a class="reference internal" href="container.html#swift.container.backend.ContainerBroker.db_file" title="swift.container.backend.ContainerBroker.db_file"><code class="xref py py-attr docutils literal notranslate"><span class="pre">db_file</span></code></a> is always equal
to the <code class="docutils literal notranslate"><span class="pre">db_file</span></code> argument given to <code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code>.</p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">pending_file</span></code> is always equal to <code class="xref py py-attr docutils literal notranslate"><span class="pre">_db_file</span></code> extended with
<code class="docutils literal notranslate"><span class="pre">.pending</span></code>, i.e. <code class="docutils literal notranslate"><span class="pre">&lt;hash&gt;.db.pending</span></code>.</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">create_broker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">part</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">container</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epoch</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">put_timestamp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">storage_policy_index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Create a ContainerBroker instance. If the db doesn’t exist, initialize
the db file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>device_path</strong> – device path</p></li>
<li><p><strong>part</strong> – partition number</p></li>
<li><p><strong>account</strong> – account name string</p></li>
<li><p><strong>container</strong> – container name string</p></li>
<li><p><strong>logger</strong> – a logger instance</p></li>
<li><p><strong>epoch</strong> – a timestamp to include in the db filename</p></li>
<li><p><strong>put_timestamp</strong> – initial timestamp if broker needs to be
initialized</p></li>
<li><p><strong>storage_policy_index</strong> – the storage policy index</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a tuple of (<code class="docutils literal notranslate"><span class="pre">broker</span></code>, <code class="docutils literal notranslate"><span class="pre">initialized</span></code>) where <code class="docutils literal notranslate"><span class="pre">broker</span></code> is
an instance of <a class="reference internal" href="container.html#swift.container.backend.ContainerBroker" title="swift.container.backend.ContainerBroker"><code class="xref py py-class docutils literal notranslate"><span class="pre">swift.container.backend.ContainerBroker</span></code></a> and
<code class="docutils literal notranslate"><span class="pre">initialized</span></code> is True if the db file was initialized, False
otherwise.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">create_container_info_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">put_timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">storage_policy_index</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Create the container_info table which is specific to the container DB.
Not a part of Pluggable Back-ends, internal to the baseline code.
Also creates the container_stat view.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>conn</strong> – DB connection object</p></li>
<li><p><strong>put_timestamp</strong> – put timestamp</p></li>
<li><p><strong>storage_policy_index</strong> – storage policy index</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">create_object_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Create the object table which is specific to the container DB.
Not a part of Pluggable Back-ends, internal to the baseline code.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>conn</strong> – DB connection object</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">create_policy_stat_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">storage_policy_index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Create policy_stat table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>conn</strong> – DB connection object</p></li>
<li><p><strong>storage_policy_index</strong> – the policy_index the container is
being created with</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">create_shard_range_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conn</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Create the shard_range table which is specific to the container DB.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>conn</strong> – DB connection object</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">db_file</span></span></dt>
<dd><p>Get the path to the primary db file for this broker. This is typically
the db file for the most recent sharding epoch. However, if no db files
exist on disk, or if <code class="docutils literal notranslate"><span class="pre">force_db_file</span></code> was True when the broker was
constructed, then the primary db file is the file passed to the broker
constructor.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A path to a db file; the file does not necessarily exist.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">db_files</span></span></dt>
<dd><p>Gets the cached list of valid db files that exist on disk for this
broker.</p>
<dl class="simple">
<dt>The cached list may be refreshed by calling</dt><dd><p><a class="reference internal" href="container.html#swift.container.backend.ContainerBroker.reload_db_files" title="swift.container.backend.ContainerBroker.reload_db_files"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reload_db_files()</span></code></a>.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A list of paths to db files ordered by ascending epoch;
the list may be empty.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">delete_object</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">storage_policy_index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Mark an object deleted.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – object name to be deleted</p></li>
<li><p><strong>timestamp</strong> – timestamp when the object was marked as deleted</p></li>
<li><p><strong>storage_policy_index</strong> – the storage policy index for the object</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">empty</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Check if container DB is empty.</p>
<p>This method uses more stringent checks on object count than
<code class="xref py py-meth docutils literal notranslate"><span class="pre">is_deleted()</span></code>: this method checks that there are no objects in any
policy; if the container is in the process of sharding then both fresh
and retiring databases are checked to be empty; if a root container has
shard ranges then they are checked to be empty.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>True if the database has no active objects, False otherwise</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">enable_sharding</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">epoch</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Updates this broker’s own shard range with the given epoch, sets its
state to SHARDING and persists it in the DB.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>epoch</strong> – a <code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the broker’s updated own shard range.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">find_shard_ranges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shard_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">existing_ranges</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minimum_shard_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Scans the container db for shard ranges. Scanning will start at the
upper bound of the any <code class="docutils literal notranslate"><span class="pre">existing_ranges</span></code> that are given, otherwise
at <code class="docutils literal notranslate"><span class="pre">ShardRange.MIN</span></code>. Scanning will stop when <code class="docutils literal notranslate"><span class="pre">limit</span></code> shard ranges
have been found or when no more shard ranges can be found. In the
latter case, the upper bound of the final shard range will be equal to
the upper bound of the container namespace.</p>
<p>This method does not modify the state of the db; callers are
responsible for persisting any shard range data in the db.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shard_size</strong> – the size of each shard range</p></li>
<li><p><strong>limit</strong> – the maximum number of shard points to be found; a
negative value (default) implies no limit.</p></li>
<li><p><strong>existing_ranges</strong> – an optional list of existing ShardRanges; if
given, this list should be sorted in order of upper bounds; the
scan for new shard ranges will start at the upper bound of the last
existing ShardRange.</p></li>
<li><p><strong>minimum_shard_size</strong> – Minimum size of the final shard range. If
this is greater than one then the final shard range may be extended
to more than shard_size in order to avoid a further shard range
with less minimum_shard_size rows.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a tuple; the first value in the tuple is a list of
dicts each having keys {‘index’, ‘lower’, ‘upper’, ‘object_count’}
in order of ascending ‘upper’; the second value in the tuple is a
boolean which is True if the last shard range has been found, False
otherwise.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_all_shard_range_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Returns a list of all shard range data, including own shard range and
deleted shard ranges.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A list of dict representations of a ShardRange.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_brokers</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Return a list of brokers for component dbs. The list has two entries
while the db state is sharding: the first entry is a broker for the
retiring db with <code class="docutils literal notranslate"><span class="pre">skip_commits</span></code> set to <code class="docutils literal notranslate"><span class="pre">True</span></code>; the second entry is
a broker for the fresh db  with <code class="docutils literal notranslate"><span class="pre">skip_commits</span></code> set to <code class="docutils literal notranslate"><span class="pre">False</span></code>. For
any other db state the list has one entry.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a list of <a class="reference internal" href="container.html#swift.container.backend.ContainerBroker" title="swift.container.backend.ContainerBroker"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContainerBroker</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_db_state</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Returns the current state of on disk db files.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_info</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Get global data for the container.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict with keys: account, container, created_at,
put_timestamp, delete_timestamp, status, status_changed_at,
object_count, bytes_used, reported_put_timestamp,
reported_delete_timestamp, reported_object_count,
reported_bytes_used, hash, id, x_container_sync_point1,
x_container_sync_point2, and storage_policy_index,
db_state.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_info_is_deleted</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Get the is_deleted status and info for the container.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a tuple, in the form (info, is_deleted) info is a dict as
returned by get_info and is_deleted is a boolean.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_misplaced_since</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">count</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Get a list of objects which are in a storage policy different
from the container’s storage policy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start</strong> – last reconciler sync point</p></li>
<li><p><strong>count</strong> – maximum number of entries to get</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>list of dicts with keys: name, created_at, size,
content_type, etag, storage_policy_index</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_objects</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">marker</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_marker</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_deleted</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">since_row</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Returns a list of objects, including deleted objects, in all policies.
Each object in the list is described by a dict with keys {‘name’,
‘created_at’, ‘size’, ‘content_type’, ‘etag’, ‘deleted’,
‘storage_policy_index’}.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>limit</strong> – maximum number of entries to get</p></li>
<li><p><strong>marker</strong> – if set, objects with names less than or equal to this
value will not be included in the list.</p></li>
<li><p><strong>end_marker</strong> – if set, objects with names greater than or equal to
this value will not be included in the list.</p></li>
<li><p><strong>include_deleted</strong> – if True, include only deleted objects; if
False, include only undeleted objects; otherwise (default), include
both deleted and undeleted objects.</p></li>
<li><p><strong>since_row</strong> – include only items whose ROWID is greater than
the given row id; by default all rows are included.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a list of dicts, each describing an object.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_own_shard_range</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">no_default</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Returns a shard range representing this broker’s own shard range. If no
such range has been persisted in the broker’s shard ranges table then a
default shard range representing the entire namespace will be returned.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">object_count</span></code> and <code class="docutils literal notranslate"><span class="pre">bytes_used</span></code> of the returned shard range are
not guaranteed to be up-to-date with the current object stats for this
broker. Callers that require up-to-date stats should use the
<code class="docutils literal notranslate"><span class="pre">get_info</span></code> method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>no_default</strong> – if True and the broker’s own shard range is not
found in the shard ranges table then None is returned, otherwise a
default shard range is returned.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>an instance of <a class="reference internal" href="misc.html#swift.common.utils.ShardRange" title="swift.common.utils.ShardRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShardRange</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_replication_info</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Get information about the DB required for replication.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict containing keys from get_info plus max_row and metadata</p>
</dd>
</dl>
<dl class="simple">
<dt>Note:: get_info’s &lt;db_contains_type&gt;_count is translated to just</dt><dd><p>“count” and metadata is the raw string.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_shard_ranges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">marker</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_marker</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">includes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reverse</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_deleted</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">states</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_own</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_others</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fill_gaps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Returns a list of persisted shard ranges.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>marker</strong> – restricts the returned list to shard ranges whose
namespace includes or is greater than the marker value.</p></li>
<li><p><strong>end_marker</strong> – restricts the returned list to shard ranges whose
namespace includes or is less than the end_marker value.</p></li>
<li><p><strong>includes</strong> – restricts the returned list to the shard range that
includes the given value; if <code class="docutils literal notranslate"><span class="pre">includes</span></code> is specified then
<code class="docutils literal notranslate"><span class="pre">marker</span></code> and <code class="docutils literal notranslate"><span class="pre">end_marker</span></code> are ignored.</p></li>
<li><p><strong>reverse</strong> – reverse the result order.</p></li>
<li><p><strong>include_deleted</strong> – include items that have the delete marker set</p></li>
<li><p><strong>states</strong> – if specified, restricts the returned list to shard
ranges that have the given state(s); can be a list of ints or a
single int.</p></li>
<li><p><strong>include_own</strong> – boolean that governs whether the row whose name
matches the broker’s path is included in the returned list. If
True, that row is included, otherwise it is not included. Default
is False.</p></li>
<li><p><strong>exclude_others</strong> – boolean that governs whether the rows whose
names do not match the broker’s path are included in the returned
list. If True, those rows are not included, otherwise they are
included. Default is False.</p></li>
<li><p><strong>fill_gaps</strong> – if True, insert a modified copy of own shard range to
fill any gap between the end of any found shard ranges and the
upper bound of own shard range. Gaps enclosed within the found
shard ranges are not filled.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a list of instances of <a class="reference internal" href="misc.html#swift.common.utils.ShardRange" title="swift.common.utils.ShardRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">swift.common.utils.ShardRange</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_shard_usage</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Get the aggregate object stats for all shard ranges in states ACTIVE,
SHARDING or SHRINKING.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a dict with keys {bytes_used, object_count}</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_sharding_sysmeta</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Returns sharding specific info from the broker’s metadata.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>key</strong> – if given the value stored under <code class="docutils literal notranslate"><span class="pre">key</span></code> in the sharding
info will be returned.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>either a dict of sharding info or the value stored under
<code class="docutils literal notranslate"><span class="pre">key</span></code> in that dict.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_sharding_sysmeta_with_timestamps</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Returns sharding specific info from the broker’s metadata with
timestamps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>key</strong> – if given the value stored under <code class="docutils literal notranslate"><span class="pre">key</span></code> in the sharding
info will be returned.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a dict of sharding info with their timestamps.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">is_reclaimable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">now</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reclaim_age</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Check if the broker abstraction is empty, and has been marked deleted
for at least a reclaim age.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">is_root_container</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Returns True if this container is a root container, False otherwise.</p>
<p>A root container is a container that is not a shard of another
container.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">list_objects_iter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">limit</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">marker</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_marker</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delimiter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">storage_policy_index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reverse</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_deleted</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">since_row</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_policies</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_reserved</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Get a list of objects sorted by name starting at marker onward, up
to limit entries.  Entries will begin with the prefix and will not
have the delimiter after the prefix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>limit</strong> – maximum number of entries to get</p></li>
<li><p><strong>marker</strong> – marker query</p></li>
<li><p><strong>end_marker</strong> – end marker query</p></li>
<li><p><strong>prefix</strong> – prefix query</p></li>
<li><p><strong>delimiter</strong> – delimiter for query</p></li>
<li><p><strong>path</strong> – if defined, will set the prefix and delimiter based on
the path</p></li>
<li><p><strong>storage_policy_index</strong> – storage policy index for query</p></li>
<li><p><strong>reverse</strong> – reverse the result order.</p></li>
<li><p><strong>include_deleted</strong> – if True, include only deleted objects; if
False (default), include only undeleted objects; otherwise, include
both deleted and undeleted objects.</p></li>
<li><p><strong>since_row</strong> – include only items whose ROWID is greater than
the given row id; by default all rows are included.</p></li>
<li><p><strong>transform_func</strong> – an optional function that if given will be
called for each object to get a transformed version of the object
to include in the listing; should have same signature as
<code class="xref py py-meth docutils literal notranslate"><span class="pre">_transform_record()</span></code>; defaults to <code class="xref py py-meth docutils literal notranslate"><span class="pre">_transform_record()</span></code>.</p></li>
<li><p><strong>all_policies</strong> – if True, include objects for all storage policies
ignoring any value given for <code class="docutils literal notranslate"><span class="pre">storage_policy_index</span></code></p></li>
<li><p><strong>allow_reserved</strong> – exclude names with reserved-byte by default</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>list of tuples of (name, created_at, size, content_type,
etag, deleted)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">make_tuple_for_pickle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">record</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Turn this db record dict into the format this service uses for
pending pickles.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">merge_items</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">item_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Merge items into the object table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>item_list</strong> – list of dictionaries of {‘name’, ‘created_at’,
‘size’, ‘content_type’, ‘etag’, ‘deleted’,
‘storage_policy_index’, ‘ctype_timestamp’,
‘meta_timestamp’}</p></li>
<li><p><strong>source</strong> – if defined, update incoming_sync with the source</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">merge_shard_ranges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shard_ranges</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Merge shard ranges into the shard range table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>shard_ranges</strong> – a shard range or a list of shard ranges; each
shard range should be an instance of
<a class="reference internal" href="misc.html#swift.common.utils.ShardRange" title="swift.common.utils.ShardRange"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShardRange</span></code></a> or a dict representation of
a shard range having <code class="docutils literal notranslate"><span class="pre">SHARD_RANGE_KEYS</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">put_object</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">content_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">etag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deleted</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">storage_policy_index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ctype_timestamp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meta_timestamp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Creates an object in the DB with its metadata.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – object name to be created</p></li>
<li><p><strong>timestamp</strong> – timestamp of when the object was created</p></li>
<li><p><strong>size</strong> – object size</p></li>
<li><p><strong>content_type</strong> – object content-type</p></li>
<li><p><strong>etag</strong> – object etag</p></li>
<li><p><strong>deleted</strong> – if True, marks the object as deleted and sets the
deleted_at timestamp to timestamp</p></li>
<li><p><strong>storage_policy_index</strong> – the storage policy index for the object</p></li>
<li><p><strong>ctype_timestamp</strong> – timestamp of when content_type was last
updated</p></li>
<li><p><strong>meta_timestamp</strong> – timestamp of when metadata was last updated</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">reload_db_files</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Reloads the cached list of valid on disk db files for this broker.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">remove_objects</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lower</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upper</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_row</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Removes object records in the given namespace range from the object
table.</p>
<p>Note that objects are removed regardless of their storage_policy_index.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lower</strong> – defines the lower bound of object names that will be
removed; names greater than this value will be removed; names less
than or equal to this value will not be removed.</p></li>
<li><p><strong>upper</strong> – defines the upper bound of object names that will be
removed; names less than or equal to this value will be removed;
names greater than this value will not be removed. The empty string
is interpreted as there being no upper bound.</p></li>
<li><p><strong>max_row</strong> – if specified only rows less than or equal to max_row
will be removed</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">reported</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">put_timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delete_timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_count</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bytes_used</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Update reported stats, available with container’s <cite>get_info</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>put_timestamp</strong> – put_timestamp to update</p></li>
<li><p><strong>delete_timestamp</strong> – delete_timestamp to update</p></li>
<li><p><strong>object_count</strong> – object_count to update</p></li>
<li><p><strong>bytes_used</strong> – bytes_used to update</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">resolve_shard_range_states</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">states</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Given a list of values each of which may be the name of a state, the
number of a state, or an alias, return the set of state numbers
described by the list.</p>
<p>The following alias values are supported: ‘listing’ maps to all states
that are considered valid when listing objects; ‘updating’ maps to all
states that are considered valid for redirecting an object update;
‘auditing’ maps to all states that are considered valid for a shard
container that is updating its own shard range table from a root (this
currently maps to all states except FOUND).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>states</strong> – a list of values each of which may be the name of a
state, the number of a state, or an alias</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a set of integer state numbers, or None if no states are given</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – if any value in the given list is neither a valid
state nor a valid alias</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">set_sharded_state</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Unlink’s the broker’s retiring DB file.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>True if the retiring DB was successfully unlinked, False
otherwise.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">set_sharding_state</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Creates and initializes a fresh DB file in preparation for sharding a
retiring DB. The broker’s own shard range must have an epoch timestamp
for this method to succeed.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>True if the fresh DB was successfully created, False
otherwise.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">set_sharding_sysmeta</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Updates the broker’s metadata stored under the given key
prefixed with a sharding specific namespace.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> – metadata key in the sharding metadata namespace.</p></li>
<li><p><strong>value</strong> – metadata value</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">set_storage_policy_index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">policy_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Update the container_stat policy_index and status_changed_at.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">sharding_initiated</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Returns True if a broker has shard range state that would be necessary
for sharding to have been initiated, False otherwise.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">sharding_required</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Returns True if a broker has shard range state that would be necessary
for sharding to have been initiated but has not yet completed sharding,
False otherwise.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">swift.container.backend.</span></span><span class="sig-name descname"><span class="pre">merge_shards</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shard_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">existing</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Compares <code class="docutils literal notranslate"><span class="pre">shard_data</span></code> with <code class="docutils literal notranslate"><span class="pre">existing</span></code> and updates <code class="docutils literal notranslate"><span class="pre">shard_data</span></code> with
any items of <code class="docutils literal notranslate"><span class="pre">existing</span></code> that take precedence over the corresponding item
in <code class="docutils literal notranslate"><span class="pre">shard_data</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shard_data</strong> – a dict representation of shard range that may be
modified by this method.</p></li>
<li><p><strong>existing</strong> – a dict representation of shard range.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if <code class="docutils literal notranslate"><span class="pre">shard</span> <span class="pre">data</span></code> has any item(s) that are considered to
take precedence over the corresponding item in <code class="docutils literal notranslate"><span class="pre">existing</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">swift.container.backend.</span></span><span class="sig-name descname"><span class="pre">sift_shard_ranges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_shard_ranges</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">existing_shard_ranges</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Compares new and existing shard ranges, updating the new shard ranges with
any more recent state from the existing, and returns shard ranges sorted
into those that need adding because they contain new or updated state and
those that need deleting because their state has been superseded.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>new_shard_ranges</strong> – a list of dicts, each of which represents a shard
range.</p></li>
<li><p><strong>existing_shard_ranges</strong> – a dict mapping shard range names to dicts
representing a shard range.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a tuple (to_add, to_delete); to_add is a list of dicts, each of
which represents a shard range that is to be added to the existing
shard ranges; to_delete is a set of shard range names that are to be
deleted.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">swift.container.backend.</span></span><span class="sig-name descname"><span class="pre">update_new_item_from_existing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_item</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">existing</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Compare the data and meta related timestamps of a new object item with
the timestamps of an existing object record, and update the new item
with data and/or meta related attributes from the existing record if
their timestamps are newer.</p>
<p>The multiple timestamps are encoded into a single string for storing
in the ‘created_at’ column of the objects db table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>new_item</strong> – A dict of object update attributes</p></li>
<li><p><strong>existing</strong> – A dict of existing object attributes</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if any attributes of the new item dict were found to be
newer than the existing and therefore not updated, otherwise
False implying that the updated item is equal to the existing.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="back-end-api-for-object-server-rest-apis">
<h2>Back-end API for Object Server REST APIs<a class="headerlink" href="#back-end-api-for-object-server-rest-apis" title="Permalink to this heading">¶</a></h2>
<p>Disk File Interface for the Swift Object Server</p>
<p>The <cite>DiskFile</cite>, <cite>DiskFileWriter</cite> and <cite>DiskFileReader</cite> classes combined define
the on-disk abstraction layer for supporting the object server REST API
interfaces (excluding <cite>REPLICATE</cite>). Other implementations wishing to provide
an alternative backend for the object server must implement the three
classes. An example alternative implementation can be found in the
<cite>mem_server.py</cite> and <cite>mem_diskfile.py</cite> modules along size this one.</p>
<p>The <cite>DiskFileManager</cite> is a reference implemenation specific class and is not
part of the backend API.</p>
<p>The remaining methods in this module are considered implementation specific and
are also not considered part of the backend API.</p>
<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">AuditLocation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Represents an object location to be audited.</p>
<p>Other than being a bucket of data, the only useful thing this does is
stringify to a filesystem path so the auditor’s logs look okay.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">BaseDiskFile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mgr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">container</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_datadir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_splice</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pipe_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">open_expired</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">next_part_power</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Manage object files.</p>
<p>This specific implementation manages object files on a disk formatted with
a POSIX-compliant file system that supports extended attributes as
metadata on a file or directory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The arguments to the constructor are considered implementation
specific. The API does not define the constructor arguments.</p>
<p>The following path format is used for data file locations:
&lt;devices_path/&lt;device_dir&gt;/&lt;datadir&gt;/&lt;partdir&gt;/&lt;suffixdir&gt;/&lt;hashdir&gt;/
&lt;datafile&gt;.&lt;ext&gt;</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mgr</strong> – associated DiskFileManager instance</p></li>
<li><p><strong>device_path</strong> – path to the target device or drive</p></li>
<li><p><strong>partition</strong> – partition on the device in which the object lives</p></li>
<li><p><strong>account</strong> – account name for the object</p></li>
<li><p><strong>container</strong> – container name for the object</p></li>
<li><p><strong>obj</strong> – object name for the object</p></li>
<li><p><strong>_datadir</strong> – override the full datadir otherwise constructed here</p></li>
<li><p><strong>policy</strong> – the StoragePolicy instance</p></li>
<li><p><strong>use_splice</strong> – if true, use zero-copy splice() to send data</p></li>
<li><p><strong>pipe_size</strong> – size of pipe buffer used in zero-copy operations</p></li>
<li><p><strong>open_expired</strong> – if True, open() will not raise a DiskFileExpired if
object is expired</p></li>
<li><p><strong>next_part_power</strong> – the next partition power to be used</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Context manager to create a file. We create a temporary file first, and
then return a DiskFileWriter object to encapsulate the state.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An implementation is not required to perform on-disk
preallocations even if the parameter is specified. But if it does
and it fails, it must raise a <cite>DiskFileNoSpace</cite> exception.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>size</strong> – optional initial size of file to explicitly allocate on
disk</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileNoSpace" title="swift.common.exceptions.DiskFileNoSpace"><strong>DiskFileNoSpace</strong></a> – if a size is specified and allocation fails</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">delete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Delete the object.</p>
<p>This implementation creates a tombstone file using the given
timestamp, and removes any older versions of the object file. Any
file that has an older timestamp than timestamp will be deleted.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An implementation is free to use or ignore the timestamp
parameter.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>timestamp</strong> – timestamp to compare with each file</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileError" title="swift.common.exceptions.DiskFileError"><strong>DiskFileError</strong></a> – this implementation will raise the same
errors as the <cite>create()</cite> method.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">durable_timestamp</span></span></dt>
<dd><p>Provides the timestamp of the newest data file found in the object
directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A Timestamp instance, or None if no data file was found.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileNotOpen" title="swift.common.exceptions.DiskFileNotOpen"><strong>DiskFileNotOpen</strong></a> – if the open() method has not been previously
called on this instance.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_datafile_metadata</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Provide the datafile metadata for a previously opened object as a
dictionary. This is metadata that was included when the object was
first PUT, and does not include metadata set by any subsequent POST.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>object’s datafile metadata dictionary</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileNotOpen" title="swift.common.exceptions.DiskFileNotOpen"><strong>DiskFileNotOpen</strong></a> – if the
<code class="xref py py-func docutils literal notranslate"><span class="pre">swift.obj.diskfile.DiskFile.open()</span></code> method was not previously
invoked</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_metadata</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Provide the metadata for a previously opened object as a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>object’s metadata dictionary</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileNotOpen" title="swift.common.exceptions.DiskFileNotOpen"><strong>DiskFileNotOpen</strong></a> – if the
<code class="xref py py-func docutils literal notranslate"><span class="pre">swift.obj.diskfile.DiskFile.open()</span></code> method was not previously
invoked</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_metafile_metadata</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Provide the metafile metadata for a previously opened object as a
dictionary. This is metadata that was written by a POST and does not
include any persistent metadata that was set by the original PUT.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>object’s .meta file metadata dictionary, or None if there is
no .meta file</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileNotOpen" title="swift.common.exceptions.DiskFileNotOpen"><strong>DiskFileNotOpen</strong></a> – if the
<code class="xref py py-func docutils literal notranslate"><span class="pre">swift.obj.diskfile.DiskFile.open()</span></code> method was not previously
invoked</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">open</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">modernize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">current_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Open the object.</p>
<p>This implementation opens the data file representing the object, reads
the associated metadata in the extended attributes, additionally
combining metadata from fast-POST <cite>.meta</cite> files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>modernize</strong> – if set, update this diskfile to the latest format.
Currently, this means adding metadata checksums if none are
present.</p></li>
<li><p><strong>current_time</strong> – Unix time used in checking expiration. If not
present, the current time will be used.</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An implementation is allowed to raise any of the following
exceptions, but is only required to raise <cite>DiskFileNotExist</cite> when
the object representation does not exist.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileCollision" title="swift.common.exceptions.DiskFileCollision"><strong>DiskFileCollision</strong></a> – on name mis-match with metadata</p></li>
<li><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileNotExist" title="swift.common.exceptions.DiskFileNotExist"><strong>DiskFileNotExist</strong></a> – if the object does not exist</p></li>
<li><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileDeleted" title="swift.common.exceptions.DiskFileDeleted"><strong>DiskFileDeleted</strong></a> – if the object was previously deleted</p></li>
<li><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileQuarantined" title="swift.common.exceptions.DiskFileQuarantined"><strong>DiskFileQuarantined</strong></a> – if while reading metadata of the file
some data did pass cross checks</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>itself for use as a context manager</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">read_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">current_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Return the metadata for an object without requiring the caller to open
the object first.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>current_time</strong> – Unix time used in checking expiration. If not
present, the current time will be used.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>metadata dictionary for an object</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileError" title="swift.common.exceptions.DiskFileError"><strong>DiskFileError</strong></a> – this implementation will raise the same
errors as the <cite>open()</cite> method.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">reader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">keep_cache=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_quarantine_hook=&lt;function</span> <span class="pre">BaseDiskFile.&lt;lambda&gt;&gt;</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Return a <a class="reference internal" href="misc.html#swift.common.swob.Response" title="swift.common.swob.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">swift.common.swob.Response</span></code></a> class compatible
“<cite>app_iter</cite>” object as defined by
<a class="reference internal" href="object.html#swift.obj.diskfile.DiskFileReader" title="swift.obj.diskfile.DiskFileReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">swift.obj.diskfile.DiskFileReader</span></code></a>.</p>
<p>For this implementation, the responsibility of closing the open file
is passed to the <a class="reference internal" href="object.html#swift.obj.diskfile.DiskFileReader" title="swift.obj.diskfile.DiskFileReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">swift.obj.diskfile.DiskFileReader</span></code></a> object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>keep_cache</strong> – caller’s preference for keeping data read in the
OS buffer cache</p></li>
<li><p><strong>_quarantine_hook</strong> – 1-arg callable called when obj quarantined;
the arg is the reason for quarantine.
Default is to ignore it.
Not needed by the REST layer.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a <a class="reference internal" href="object.html#swift.obj.diskfile.DiskFileReader" title="swift.obj.diskfile.DiskFileReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">swift.obj.diskfile.DiskFileReader</span></code></a> object</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">write_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metadata</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Write a block of metadata to an object without requiring the caller to
create the object first. Supports fast-POST behavior semantics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>metadata</strong> – dictionary of metadata to be associated with the
object</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileError" title="swift.common.exceptions.DiskFileError"><strong>DiskFileError</strong></a> – this implementation will raise the same
errors as the <cite>create()</cite> method.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">BaseDiskFileManager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Management class for devices, providing common place for shared parameters
and methods not provided by the DiskFile class (which primarily services
the object server REST API layer).</p>
<p>The <cite>get_diskfile()</cite> method is how this implementation creates a <cite>DiskFile</cite>
object.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This class is reference implementation specific and not part of the
pluggable on-disk backend API.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TODO(portante): Not sure what the right name to recommend here, as
“manager” seemed generic enough, though suggestions are welcome.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>conf</strong> – caller provided configuration object</p></li>
<li><p><strong>logger</strong> – caller provided logger</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">cleanup_ondisk_files</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hsh_path</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Clean up on-disk files that are obsolete and gather the set of valid
on-disk files for an object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hsh_path</strong> – object hash path</p></li>
<li><p><strong>frag_index</strong> – if set, search for a specific fragment index .data
file, otherwise accept the first valid .data file</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a dict that may contain: valid on disk files keyed by their
filename extension; a list of obsolete files stored under the
key ‘obsolete’; a list of files remaining in the directory,
reverse sorted, stored under the key ‘files’.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">consolidate_hashes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition_dir</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Take what’s in hashes.pkl and hashes.invalid, combine them, write the
result back to hashes.pkl, and clear out hashes.invalid.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>partition_dir</strong> – absolute path to partition dir containing hashes.pkl
and hashes.invalid</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a dict, the suffix hashes (if any), the key ‘valid’ will be False
if hashes.pkl is corrupt, cannot be read or does not exist</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">construct_dev_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Construct the path to a device without checking if it is mounted.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>device</strong> – name of target device</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>full path to the device</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_dev_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mount_check</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Return the path to a device, first checking to see if either it
is a proper mount point, or at least a directory depending on
the mount_check configuration option.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>device</strong> – name of target device</p></li>
<li><p><strong>mount_check</strong> – whether or not to check mountedness of device.
Defaults to bool(self.mount_check).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>full path to the device, None if the path to the device is
not a proper mount point or directory.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_diskfile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">container</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Returns a BaseDiskFile instance for an object based on the object’s
partition, path parts and policy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>device</strong> – name of target device</p></li>
<li><p><strong>partition</strong> – partition on device in which the object lives</p></li>
<li><p><strong>account</strong> – account name for the object</p></li>
<li><p><strong>container</strong> – container name for the object</p></li>
<li><p><strong>obj</strong> – object name for the object</p></li>
<li><p><strong>policy</strong> – the StoragePolicy instance</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_diskfile_and_filenames_from_hash</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_hash</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Returns a tuple of (a DiskFile instance for an object at the given
object_hash, the basenames of the files in the object’s hash dir).
Just in case someone thinks of refactoring, be sure DiskFileDeleted is
<em>not</em> raised, but the DiskFile instance representing the tombstoned
object is returned instead.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>device</strong> – name of target device</p></li>
<li><p><strong>partition</strong> – partition on the device in which the object lives</p></li>
<li><p><strong>object_hash</strong> – the hash of an object path</p></li>
<li><p><strong>policy</strong> – the StoragePolicy instance</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileNotExist" title="swift.common.exceptions.DiskFileNotExist"><strong>DiskFileNotExist</strong></a> – if the object does not exist</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a tuple comprising (an instance of BaseDiskFile, a list of
file basenames)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_diskfile_from_audit_location</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">audit_location</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Returns a BaseDiskFile instance for an object at the given
AuditLocation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>audit_location</strong> – object location to be audited</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_diskfile_from_hash</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_hash</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Returns a DiskFile instance for an object at the given object_hash.
Just in case someone thinks of refactoring, be sure DiskFileDeleted is
<em>not</em> raised, but the DiskFile instance representing the tombstoned
object is returned instead.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>device</strong> – name of target device</p></li>
<li><p><strong>partition</strong> – partition on the device in which the object lives</p></li>
<li><p><strong>object_hash</strong> – the hash of an object path</p></li>
<li><p><strong>policy</strong> – the StoragePolicy instance</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileNotExist" title="swift.common.exceptions.DiskFileNotExist"><strong>DiskFileNotExist</strong></a> – if the object does not exist</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>an instance of BaseDiskFile</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_hashes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suffixes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_rehash</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>device</strong> – name of target device</p></li>
<li><p><strong>partition</strong> – partition name</p></li>
<li><p><strong>suffixes</strong> – a list of suffix directories to be recalculated</p></li>
<li><p><strong>policy</strong> – the StoragePolicy instance</p></li>
<li><p><strong>skip_rehash</strong> – just mark the suffixes dirty; return None</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a dictionary that maps suffix directories</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_ondisk_files</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datadir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verify</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Given a simple list of files names, determine the files that constitute
a valid fileset i.e. a set of files that defines the state of an
object, and determine the files that are obsolete and could be deleted.
Note that some files may fall into neither category.</p>
<p>If a file is considered part of a valid fileset then its info dict will
be added to the results dict, keyed by &lt;extension&gt;_info. Any files that
are no longer required will have their info dicts added to a list
stored under the key ‘obsolete’.</p>
<p>The results dict will always contain entries with keys ‘ts_file’,
‘data_file’ and ‘meta_file’. Their values will be the fully qualified
path to a file of the corresponding type if there is such a file in the
valid fileset, or None.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files</strong> – a list of file names.</p></li>
<li><p><strong>datadir</strong> – directory name files are from; this is used to
construct file paths in the results, but the datadir is
not modified by this method.</p></li>
<li><p><strong>verify</strong> – if True verify that the ondisk file contract has not
been violated, otherwise do not verify.</p></li>
<li><p><strong>policy</strong> – storage policy used to store the files. Used to
validate fragment indexes for EC policies.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>a dict that will contain keys:</dt><dd><p>ts_file   -&gt; path to a .ts file or None
data_file -&gt; path to a .data file or None
meta_file -&gt; path to a .meta file or None
ctype_file -&gt; path to a .meta file or None</p>
</dd>
<dt>and may contain keys:</dt><dd><p>ts_info   -&gt; a file info dict for a .ts file
data_info -&gt; a file info dict for a .data file
meta_info -&gt; a file info dict for a .meta file
ctype_info -&gt; a file info dict for a .meta file which
contains the content-type value
unexpected -&gt; a list of file paths for unexpected
files
possible_reclaim -&gt; a list of file info dicts for possible
reclaimable files
obsolete  -&gt; a list of file info dicts for obsolete files</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">invalidate_hash</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">suffix_dir</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Invalidates the hash for a suffix_dir in the partition’s hashes file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>suffix_dir</strong> – absolute path to suffix dir whose hash needs
invalidating</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">make_on_disk_filename</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ext</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ctype_timestamp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Returns filename for given timestamp.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>timestamp</strong> – the object timestamp, an instance of
<a class="reference internal" href="misc.html#swift.common.utils.Timestamp" title="swift.common.utils.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a></p></li>
<li><p><strong>ext</strong> – an optional string representing a file extension to be
appended to the returned file name</p></li>
<li><p><strong>ctype_timestamp</strong> – an optional content-type timestamp, an instance
of <a class="reference internal" href="misc.html#swift.common.utils.Timestamp" title="swift.common.utils.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a file name</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">object_audit_location_generator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">policy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device_dirs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">auditor_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ALL'</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Yield an AuditLocation for all objects stored under device_dirs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>policy</strong> – the StoragePolicy instance</p></li>
<li><p><strong>device_dirs</strong> – directory of target device</p></li>
<li><p><strong>auditor_type</strong> – either ALL or ZBF</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">parse_on_disk_filename</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Parse an on disk file name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – the file name including extension</p></li>
<li><p><strong>policy</strong> – storage policy used to store the file</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>a dict, with keys for timestamp, ext and ctype_timestamp:</p>
<ul class="simple">
<li><p>timestamp is a <a class="reference internal" href="misc.html#swift.common.utils.Timestamp" title="swift.common.utils.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a></p></li>
<li><p>ctype_timestamp is a <a class="reference internal" href="misc.html#swift.common.utils.Timestamp" title="swift.common.utils.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a> or
None for .meta files, otherwise None</p></li>
<li><p>ext is a string, the file extension including the leading dot or
the empty string if the filename has no extension.</p></li>
</ul>
<p>Subclasses may override this method to add further keys to the
returned dict.</p>
</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileError" title="swift.common.exceptions.DiskFileError"><strong>DiskFileError</strong></a> – if any part of the filename is not able to be
validated.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">partition_lock</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>A context manager that will lock on the partition given.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>device</strong> – device targeted by the lock request</p></li>
<li><p><strong>policy</strong> – policy targeted by the lock request</p></li>
<li><p><strong>partition</strong> – partition targeted by the lock request</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="misc.html#swift.common.exceptions.PartitionLockTimeout" title="swift.common.exceptions.PartitionLockTimeout"><strong>PartitionLockTimeout</strong></a> – If the lock on the partition
cannot be granted within the configured timeout.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">pickle_async_update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">container</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Write data describing a container update notification to a pickle file
in the async_pending directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>device</strong> – name of target device</p></li>
<li><p><strong>account</strong> – account name for the object</p></li>
<li><p><strong>container</strong> – container name for the object</p></li>
<li><p><strong>obj</strong> – object name for the object</p></li>
<li><p><strong>data</strong> – update data to be written to pickle file</p></li>
<li><p><strong>timestamp</strong> – a Timestamp</p></li>
<li><p><strong>policy</strong> – the StoragePolicy instance</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">quarantine_renamer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corrupted_file_path</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>In the case that a file is corrupted, move it to a quarantined
area to allow replication to fix it.</p>
<dl class="field-list simple">
<dt class="field-odd">Params device_path<span class="colon">:</span></dt>
<dd class="field-odd"><p>The path to the device the corrupted file is on.</p>
</dd>
<dt class="field-even">Params corrupted_file_path<span class="colon">:</span></dt>
<dd class="field-even"><p>The path to the file you want quarantined.</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>path (str) of directory the file was moved to</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>OSError</strong> – re-raises non errno.EEXIST / errno.ENOTEMPTY
exceptions from rename</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">replication_lock</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>A context manager that will lock on the partition and, if configured
to do so, on the device given.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>device</strong> – name of target device</p></li>
<li><p><strong>policy</strong> – policy targeted by the replication request</p></li>
<li><p><strong>partition</strong> – partition targeted by the replication request</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="misc.html#swift.common.exceptions.ReplicationLockTimeout" title="swift.common.exceptions.ReplicationLockTimeout"><strong>ReplicationLockTimeout</strong></a> – If the lock on the device
cannot be granted within the configured timeout.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">yield_hashes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suffixes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Yields tuples of (hash_only, timestamps) for object
information stored for the given device, partition, and
(optionally) suffixes. If suffixes is None, all stored
suffixes will be searched for object hashes. Note that if
suffixes is not None but empty, such as [], then nothing will
be yielded.</p>
<p>timestamps is a dict which may contain items mapping:</p>
<ul class="simple">
<li><p>ts_data -&gt; timestamp of data or tombstone file,</p></li>
<li><p>ts_meta -&gt; timestamp of meta file, if one exists</p></li>
<li><dl class="simple">
<dt>ts_ctype -&gt; timestamp of meta file containing most recent</dt><dd><p>content-type value, if one exists</p>
</dd>
</dl>
</li>
<li><p>durable -&gt; True if data file at ts_data is durable, False otherwise</p></li>
</ul>
<p>where timestamps are instances of
<a class="reference internal" href="misc.html#swift.common.utils.Timestamp" title="swift.common.utils.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>device</strong> – name of target device</p></li>
<li><p><strong>partition</strong> – partition name</p></li>
<li><p><strong>policy</strong> – the StoragePolicy instance</p></li>
<li><p><strong>suffixes</strong> – optional list of suffix directories to be searched</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">yield_suffixes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Yields tuples of (full_path, suffix_only) for suffixes stored
on the given device and partition.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>device</strong> – name of target device</p></li>
<li><p><strong>partition</strong> – partition name</p></li>
<li><p><strong>policy</strong> – the StoragePolicy instance</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">BaseDiskFileReader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">etag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">disk_chunk_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_cache_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quarantine_hook</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_splice</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pipe_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diskfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_cache</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Encapsulation of the WSGI read context for servicing GET REST API
requests. Serves as the context manager object for the
<a class="reference internal" href="object.html#swift.obj.diskfile.DiskFile" title="swift.obj.diskfile.DiskFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">swift.obj.diskfile.DiskFile</span></code></a> class’s
<code class="xref py py-func docutils literal notranslate"><span class="pre">swift.obj.diskfile.DiskFile.reader()</span></code> method.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The quarantining behavior of this method is considered implementation
specific, and is not required of the API.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The arguments to the constructor are considered implementation
specific. The API does not define the constructor arguments.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fp</strong> – open file object pointer reference</p></li>
<li><p><strong>data_file</strong> – on-disk data file name for the object</p></li>
<li><p><strong>obj_size</strong> – verified on-disk size of the object</p></li>
<li><p><strong>etag</strong> – expected metadata etag value for entire file</p></li>
<li><p><strong>disk_chunk_size</strong> – size of reads from disk in bytes</p></li>
<li><p><strong>keep_cache_size</strong> – maximum object size that will be kept in cache</p></li>
<li><p><strong>device_path</strong> – on-disk device path, used when quarantining an obj</p></li>
<li><p><strong>logger</strong> – logger caller wants this object to use</p></li>
<li><p><strong>quarantine_hook</strong> – 1-arg callable called w/reason when quarantined</p></li>
<li><p><strong>use_splice</strong> – if true, use zero-copy splice() to send data</p></li>
<li><p><strong>pipe_size</strong> – size of pipe buffer used in zero-copy operations</p></li>
<li><p><strong>diskfile</strong> – the diskfile creating this DiskFileReader instance</p></li>
<li><p><strong>keep_cache</strong> – should resulting reads be kept in the buffer cache</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">app_iter_range</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stop</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Returns an iterator over the data file for range (start, stop)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">app_iter_ranges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ranges</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">content_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">boundary</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Returns an iterator over the data file for a set of ranges</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Close the open file handle if present.</p>
<p>For this specific implementation, this method will handle quarantining
the file if necessary.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">zero_copy_send</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wsockfd</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Does some magic with splice() and tee() to move stuff from disk to
network without ever touching userspace.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>wsockfd</strong> – file descriptor (integer) of the socket out which to
send data</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">BaseDiskFileWriter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datadir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bytes_per_sync</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diskfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">next_part_power</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Encapsulation of the write context for servicing PUT REST API
requests. Serves as the context manager object for the
<a class="reference internal" href="object.html#swift.obj.diskfile.DiskFile" title="swift.obj.diskfile.DiskFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">swift.obj.diskfile.DiskFile</span></code></a> class’s
<code class="xref py py-func docutils literal notranslate"><span class="pre">swift.obj.diskfile.DiskFile.create()</span></code> method.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is the responsibility of the
<code class="xref py py-func docutils literal notranslate"><span class="pre">swift.obj.diskfile.DiskFile.create()</span></code> method context manager to
close the open file descriptor.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The arguments to the constructor are considered implementation
specific. The API does not define the constructor arguments.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – name of object from REST API</p></li>
<li><p><strong>datadir</strong> – on-disk directory object will end up in on
<a class="reference internal" href="object.html#swift.obj.diskfile.DiskFileWriter.put" title="swift.obj.diskfile.DiskFileWriter.put"><code class="xref py py-func docutils literal notranslate"><span class="pre">swift.obj.diskfile.DiskFileWriter.put()</span></code></a></p></li>
<li><p><strong>fd</strong> – open file descriptor of temporary file to receive data</p></li>
<li><p><strong>tmppath</strong> – full path name of the opened file descriptor</p></li>
<li><p><strong>bytes_per_sync</strong> – number bytes written between sync calls</p></li>
<li><p><strong>diskfile</strong> – the diskfile creating this DiskFileWriter instance</p></li>
<li><p><strong>next_part_power</strong> – the next partition power to be used</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">chunks_finished</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Expose internal stats about written chunks.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a tuple, (upload_size, etag)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">commit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Perform any operations necessary to mark the object as durable. For
replication policy type this is a no-op.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>timestamp</strong> – object put timestamp, an instance of
<a class="reference internal" href="misc.html#swift.common.utils.Timestamp" title="swift.common.utils.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">put</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metadata</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Finalize writing the file on disk.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>metadata</strong> – dictionary of metadata to be associated with the
object</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">chunk</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Write a chunk of data to disk. All invocations of this method must
come before invoking the :func:</p>
<p>For this implementation, the data is written into a temporary file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>chunk</strong> – the chunk of data to write as a string object</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">DiskFile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mgr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">container</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_datadir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_splice</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pipe_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">open_expired</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">next_part_power</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span></dt>
<dd><dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">reader_cls</span></span></dt>
<dd><p>alias of <a class="reference internal" href="object.html#swift.obj.diskfile.DiskFileReader" title="swift.obj.diskfile.DiskFileReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">DiskFileReader</span></code></a></p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">writer_cls</span></span></dt>
<dd><p>alias of <a class="reference internal" href="object.html#swift.obj.diskfile.DiskFileWriter" title="swift.obj.diskfile.DiskFileWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">DiskFileWriter</span></code></a></p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">DiskFileManager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span></dt>
<dd><dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">diskfile_cls</span></span></dt>
<dd><p>alias of <a class="reference internal" href="object.html#swift.obj.diskfile.DiskFile" title="swift.obj.diskfile.DiskFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">DiskFile</span></code></a></p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">DiskFileReader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">etag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">disk_chunk_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_cache_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quarantine_hook</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_splice</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pipe_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diskfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_cache</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">DiskFileWriter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datadir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bytes_per_sync</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diskfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">next_part_power</span></span></em><span class="sig-paren">)</span></dt>
<dd><dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">put</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metadata</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Finalize writing the file on disk.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>metadata</strong> – dictionary of metadata to be associated with the
object</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">ECDiskFile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span></dt>
<dd><dl class="py property">
<dt class="sig sig-object py">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">durable_timestamp</span></span></dt>
<dd><p>Provides the timestamp of the newest durable file found in the object
directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A Timestamp instance, or None if no durable file was found.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileNotOpen" title="swift.common.exceptions.DiskFileNotOpen"><strong>DiskFileNotOpen</strong></a> – if the open() method has not been previously
called on this instance.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fragments</span></span></dt>
<dd><p>Provides information about all fragments that were found in the object
directory, including fragments without a matching durable file, and
including any fragment chosen to construct the opened diskfile.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A dict mapping &lt;Timestamp instance&gt; -&gt; &lt;list of frag indexes&gt;,
or None if the diskfile has not been opened or no fragments
were found.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">purge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frag_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nondurable_purge_delay</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meta_timestamp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Remove a tombstone file matching the specified timestamp or
datafile matching the specified timestamp and fragment index
from the object directory.</p>
<p>This provides the EC reconstructor/ssync process with a way to
remove a tombstone or fragment from a handoff node after
reverting it to its primary node.</p>
<p>The hash will be invalidated, and if empty the hsh_path will
be removed immediately.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>timestamp</strong> – the object timestamp, an instance of
<a class="reference internal" href="misc.html#swift.common.utils.Timestamp" title="swift.common.utils.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a></p></li>
<li><p><strong>frag_index</strong> – fragment archive index, must be
a whole number or None.</p></li>
<li><p><strong>nondurable_purge_delay</strong> – only remove a non-durable data file if
it’s been on disk longer than this many seconds.</p></li>
<li><p><strong>meta_timestamp</strong> – if not None then remove any meta file with this
timestamp</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">reader_cls</span></span></dt>
<dd><p>alias of <a class="reference internal" href="object.html#swift.obj.diskfile.ECDiskFileReader" title="swift.obj.diskfile.ECDiskFileReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">ECDiskFileReader</span></code></a></p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">writer_cls</span></span></dt>
<dd><p>alias of <a class="reference internal" href="object.html#swift.obj.diskfile.ECDiskFileWriter" title="swift.obj.diskfile.ECDiskFileWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">ECDiskFileWriter</span></code></a></p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">ECDiskFileManager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em><span class="sig-paren">)</span></dt>
<dd><dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">diskfile_cls</span></span></dt>
<dd><p>alias of <a class="reference internal" href="object.html#swift.obj.diskfile.ECDiskFile" title="swift.obj.diskfile.ECDiskFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">ECDiskFile</span></code></a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">make_on_disk_filename</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ext</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frag_index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ctype_timestamp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">durable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Returns the EC specific filename for given timestamp.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>timestamp</strong> – the object timestamp, an instance of
<a class="reference internal" href="misc.html#swift.common.utils.Timestamp" title="swift.common.utils.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a></p></li>
<li><p><strong>ext</strong> – an optional string representing a file extension to be
appended to the returned file name</p></li>
<li><p><strong>frag_index</strong> – a fragment archive index, used with .data extension
only, must be a whole number.</p></li>
<li><p><strong>ctype_timestamp</strong> – an optional content-type timestamp, an instance
of <a class="reference internal" href="misc.html#swift.common.utils.Timestamp" title="swift.common.utils.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a></p></li>
<li><p><strong>durable</strong> – if True then include a durable marker in data filename.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a file name</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileError" title="swift.common.exceptions.DiskFileError"><strong>DiskFileError</strong></a> – if ext==’.data’ and the kwarg frag_index is not
a whole number</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">parse_on_disk_filename</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Returns timestamp(s) and other info extracted from a policy specific
file name. For EC policy the data file name includes a fragment index
and possibly a durable marker, both of which must be stripped off
to retrieve the timestamp.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>filename</strong> – the file name including extension</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>a dict, with keys for timestamp, frag_index, durable, ext and</dt><dd><p>ctype_timestamp:</p>
</dd>
</dl>
<ul class="simple">
<li><p>timestamp is a <a class="reference internal" href="misc.html#swift.common.utils.Timestamp" title="swift.common.utils.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a></p></li>
<li><p>frag_index is an int or None</p></li>
<li><p>ctype_timestamp is a <a class="reference internal" href="misc.html#swift.common.utils.Timestamp" title="swift.common.utils.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a> or
None for .meta files, otherwise None</p></li>
<li><p>ext is a string, the file extension including the leading dot or
the empty string if the filename has no extension</p></li>
<li><p>durable is a boolean that is True if the filename is a data file
that includes a durable marker</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileError" title="swift.common.exceptions.DiskFileError"><strong>DiskFileError</strong></a> – if any part of the filename is not able to be
validated.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">validate_fragment_index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frag_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Return int representation of frag_index, or raise a DiskFileError if
frag_index is not a whole number.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>frag_index</strong> – a fragment archive index</p></li>
<li><p><strong>policy</strong> – storage policy used to validate the index against</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">ECDiskFileReader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">etag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">disk_chunk_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_cache_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quarantine_hook</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_splice</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pipe_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diskfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_cache</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">ECDiskFileWriter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datadir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bytes_per_sync</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diskfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">next_part_power</span></span></em><span class="sig-paren">)</span></dt>
<dd><dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">commit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timestamp</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Finalize put by renaming the object data file to include a durable
marker. We do this for EC policy because it requires a 2-phase put
commit confirmation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>timestamp</strong> – object put timestamp, an instance of
<a class="reference internal" href="misc.html#swift.common.utils.Timestamp" title="swift.common.utils.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a></p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="misc.html#swift.common.exceptions.DiskFileError" title="swift.common.exceptions.DiskFileError"><strong>DiskFileError</strong></a> – if the diskfile frag_index has not been set
(either during initialisation or a call to put())</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">put</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metadata</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>The only difference between this method and the replication policy
DiskFileWriter method is adding the frag index to the metadata.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>metadata</strong> – dictionary of metadata to be associated with object</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">consolidate_hashes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition_dir</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Take what’s in hashes.pkl and hashes.invalid, combine them, write the
result back to hashes.pkl, and clear out hashes.invalid.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>partition_dir</strong> – absolute path to partition dir containing hashes.pkl
and hashes.invalid</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a dict, the suffix hashes (if any), the key ‘valid’ will be False
if hashes.pkl is corrupt, cannot be read or does not exist</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">extract_policy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj_path</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Extracts the policy for an object (based on the name of the objects
directory) given the device-relative path to the object. Returns None in
the event that the path is malformed in some way.</p>
<p>The device-relative path is everything after the mount point; for example:</p>
<dl class="simple">
<dt>/srv/node/d42/objects-5/30/179/</dt><dd><p>485dc017205a81df3af616d917c90179/1401811134.873649.data</p>
</dd>
</dl>
<p>would have device-relative path:</p>
<p>objects-5/30/179/485dc017205a81df3af616d917c90179/1401811134.873649.data</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>obj_path</strong> – device-relative path of an object, or the full path</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a <a class="reference internal" href="misc.html#swift.common.storage_policy.BaseStoragePolicy" title="swift.common.storage_policy.BaseStoragePolicy"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseStoragePolicy</span></code></a> or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">get_async_dir</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">policy_or_index</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Get the async dir for the given policy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>policy_or_index</strong> – <code class="docutils literal notranslate"><span class="pre">StoragePolicy</span></code> instance, or an index (string or
int); if None, the legacy Policy-0 is assumed.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">async_pending</span></code> or <code class="docutils literal notranslate"><span class="pre">async_pending-&lt;N&gt;</span></code> as appropriate</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">get_data_dir</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">policy_or_index</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Get the data dir for the given policy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>policy_or_index</strong> – <code class="docutils literal notranslate"><span class="pre">StoragePolicy</span></code> instance, or an index (string or
int); if None, the legacy Policy-0 is assumed.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">objects</span></code> or <code class="docutils literal notranslate"><span class="pre">objects-&lt;N&gt;</span></code> as appropriate</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">get_part_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dev_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">policy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Given the device path, policy, and partition, returns the full
path to the partition</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">get_tmp_dir</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">policy_or_index</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Get the temp dir for the given policy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>policy_or_index</strong> – <code class="docutils literal notranslate"><span class="pre">StoragePolicy</span></code> instance, or an index (string or
int); if None, the legacy Policy-0 is assumed.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">tmp</span></code> or <code class="docutils literal notranslate"><span class="pre">tmp-&lt;N&gt;</span></code> as appropriate</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">invalidate_hash</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">suffix_dir</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Invalidates the hash for a suffix_dir in the partition’s hashes file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>suffix_dir</strong> – absolute path to suffix dir whose hash needs
invalidating</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">object_audit_location_generator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">devices</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datadir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mount_check</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device_dirs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">auditor_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ALL'</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Given a devices path (e.g. “/srv/node”), yield an AuditLocation for all
objects stored under that directory for the given datadir (policy),
if device_dirs isn’t set.  If device_dirs is set, only yield AuditLocation
for the objects under the entries in device_dirs. The AuditLocation only
knows the path to the hash directory, not to the .data file therein
(if any). This is to avoid a double listdir(hash_dir); the DiskFile object
will always do one, so we don’t.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>devices</strong> – parent directory of the devices to be audited</p></li>
<li><p><strong>datadir</strong> – objects directory</p></li>
<li><p><strong>mount_check</strong> – flag to check if a mount check should be performed
on devices</p></li>
<li><p><strong>logger</strong> – a logger object</p></li>
<li><p><strong>device_dirs</strong> – a list of directories under devices to traverse</p></li>
<li><p><strong>auditor_type</strong> – either ALL or ZBF</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">quarantine_renamer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corrupted_file_path</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>In the case that a file is corrupted, move it to a quarantined
area to allow replication to fix it.</p>
<dl class="field-list simple">
<dt class="field-odd">Params device_path<span class="colon">:</span></dt>
<dd class="field-odd"><p>The path to the device the corrupted file is on.</p>
</dd>
<dt class="field-even">Params corrupted_file_path<span class="colon">:</span></dt>
<dd class="field-even"><p>The path to the file you want quarantined.</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>path (str) of directory the file was moved to</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>OSError</strong> – re-raises non errno.EEXIST / errno.ENOTEMPTY
exceptions from rename</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">read_hashes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition_dir</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Read the existing hashes.pkl</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a dict, the suffix hashes (if any), the key ‘valid’ will be False
if hashes.pkl is corrupt, cannot be read or does not exist</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">read_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_missing_checksum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Helper function to read the pickled metadata from an object file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fd</strong> – file descriptor or filename to load the metadata from</p></li>
<li><p><strong>add_missing_checksum</strong> – if set and checksum is missing, add it</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>dictionary of metadata</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">relink_paths</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_target_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_missing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Hard-links a file located in <code class="docutils literal notranslate"><span class="pre">target_path</span></code> using the second path
<code class="docutils literal notranslate"><span class="pre">new_target_path</span></code>. Creates intermediate directories if required.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>target_path</strong> – current absolute filename</p></li>
<li><p><strong>new_target_path</strong> – new absolute filename for the hardlink</p></li>
<li><p><strong>ignore_missing</strong> – if True then no exception is raised if the link
could not be made because <code class="docutils literal notranslate"><span class="pre">target_path</span></code> did not exist, otherwise an
OSError will be raised.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p>OSError if the hard link could not be created, unless the intended
hard link already exists or the <code class="docutils literal notranslate"><span class="pre">target_path</span></code> does not exist and
<code class="docutils literal notranslate"><span class="pre">must_exist</span></code> if False.</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>True if the link was created by the call to this method, False
otherwise.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">write_hashes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hashes</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Write hashes to hashes.pkl</p>
<p>The updated key is added to hashes before it is written.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">swift.obj.diskfile.</span></span><span class="sig-name descname"><span class="pre">write_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xattr_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">65536</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Helper function to write pickled metadata for an object file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fd</strong> – file descriptor or filename to write the metadata</p></li>
<li><p><strong>metadata</strong> – metadata to write</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="development_middleware.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Middleware and Metadata"></i></a>
          
          
            <a href="development_watchers.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Auditor Watchers"></i></a>
          
          <a id="pdfLink2" href="" target="_blank" title="Download the manuals as PDF"><i class="fa fa-file-pdf-o" data-toggle="tooltip" data-placement="top" title="Download PDF"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">this page last updated: 2022-08-02 11:51:24</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="https://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the
                 document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="OpenStack Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/id/">Bahasa Indonesia (Indonesian)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/it/">Italiano (Italian)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/tr_TR/">Türkçe (Türkiye)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="index.html" class="docs-sidebar-section-title"><h4>Swift 0.1.0.dev10162</h4></a>
      <ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/object_api_v1_overview.html">Object Storage API overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_architecture.html">Swift Architectural Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_ring.html">The Rings</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_policies.html">Storage Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_reaper.html">The Account Reaper</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_auth.html">The Auth System</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_acl.html">Access Control Lists (ACLs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_replication.html">Replication</a></li>
<li class="toctree-l1"><a class="reference internal" href="ratelimit.html">Rate Limiting</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_large_objects.html">Large Object Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_global_cluster.html">Global Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_container_sync.html">Container to Container Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_expiring_objects.html">Expiring Object Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="cors.html">CORS</a></li>
<li class="toctree-l1"><a class="reference internal" href="crossdomain.html">Cross-domain Policy File</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_erasure_code.html">Erasure Code Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_encryption.html">Object Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_backing_store.html">Using Swift as Backing Store for Service Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_container_sharding.html">Container Sharding</a></li>
<li class="toctree-l1"><a class="reference internal" href="ring_background.html">Building a Consistent Hashing Ring</a></li>
<li class="toctree-l1"><a class="reference internal" href="ring_partpower.html">Modifying Ring Partition Power</a></li>
<li class="toctree-l1"><a class="reference internal" href="associated_projects.html">Associated Projects</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html">Contributing to OpenStack Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#swift-design-principles">Swift Design Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#recommended-workflow">Recommended workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#notes-on-testing">Notes on Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#ideas">Ideas</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#community">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/review_guidelines.html">Review Guidelines</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="development_guidelines.html">Development Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_saio.html">SAIO (Swift All In One)</a></li>
<li class="toctree-l1"><a class="reference internal" href="first_contribution_swift.html">First Contribution to Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="policies_saio.html">Adding Storage Policies to an Existing SAIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_auth.html">Auth Server and Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_middleware.html">Middleware and Metadata</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Pluggable On-Disk Back-end APIs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#back-end-api-for-account-server-rest-apis">Back-end API for Account Server REST APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#back-end-api-for-container-server-rest-apis">Back-end API for Container Server REST APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#back-end-api-for-object-server-rest-apis">Back-end API for Object Server REST APIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="development_watchers.html">Auditor Watchers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="deployment_guide.html">Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_deployment_guide.html">Apache Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin_guide.html">Administrator’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="replication_network.html">Dedicated replication network</a></li>
<li class="toctree-l1"><a class="reference internal" href="logs.html">Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ops_runbook/index.html">Swift Ops Runbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin/index.html">OpenStack Swift Administrator Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="install/index.html">Object Storage Install Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="config/index.html">Configuration Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/object_api_v1_overview.html">Object Storage API overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/discoverability.html">Discoverability</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/container_quotas.html">Container quotas</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/object_versioning.html">Object versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/large_objects.html">Large objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/temporary_url_middleware.html">Temporary URL middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/form_post_middleware.html">Form POST middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/use_content-encoding_metadata.html">Use Content-Encoding metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/use_the_content-disposition_metadata.html">Use the Content-Disposition metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/pseudo-hierarchical-folders-directories.html">Pseudo-hierarchical folders and directories</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/pagination.html">Page through large lists of containers or objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/serialized-response-formats.html">Serialized response formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/static-website.html">Create static website</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/object-expiration.html">Object expiration</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/bulk-delete.html">Bulk delete</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="s3_compat.html">S3/Swift REST API Comparison Matrix</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ring.html">Partitioned Consistent Hash Ring</a></li>
<li class="toctree-l1"><a class="reference internal" href="proxy.html">Proxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="account.html">Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="container.html">Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="db.html">Account DB and Container DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="object.html">Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">Misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="middleware.html">Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="audit_watchers.html">Object Audit Watchers</a></li>
</ul>

    </div>

  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="local-table-of-contents">
      <h4 class="docs-sidebar-section-title">Page Contents</h4>
      <ul>
<li><a class="reference internal" href="#">Pluggable On-Disk Back-end APIs</a><ul>
<li><a class="reference internal" href="#back-end-api-for-account-server-rest-apis">Back-end API for Account Server REST APIs</a></li>
<li><a class="reference internal" href="#back-end-api-for-container-server-rest-apis">Back-end API for Container Server REST APIs</a></li>
<li><a class="reference internal" href="#back-end-api-for-object-server-rest-apis">Back-end API for Object Server REST APIs</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="https://openstack.org/projects/">Projects</a></li>
          <li><a href="https://www.openstack.org/software/security/">OpenStack Security</a></li>
          <li><a href="https://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="https://openstack.org/blog/">Blog</a></li>g
          <li><a href="https://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="https://openstack.org/community/">User Groups</a></li>
          <li><a href="https://openstack.org/community/events/">Events</a></li>
          <li><a href="https://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="https://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="https://docs.openstack.org/contributors">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="https://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="https://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="https://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="https://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="https://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="https://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="https://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="_static/js/jquery-3.2.1.min.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="_static/js/bootstrap.min.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="_static/js/docs.js"></script>

<!-- standard sphinx include libraries, which allow search highlighting -->
<script type="text/javascript" src="_static/underscore.js"></script>
<script type="text/javascript" src="_static/doctools.js"></script>
<script type="text/javascript" src="_static/searchtools.js"></script>
<script type="text/javascript" src="_static/language_data.js"></script>

<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:    './',
      VERSION:     '0.1.0.dev10162',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      LINK_SUFFIX: '.html',
      SOURCELINK_SUFFIX: '.txt',
      HAS_SOURCE:  true
    };
</script>

<!-- Javascript for page -->
<script language="JavaScript">
  /* Build a description of this page including SHA, source location on git
   * repo, build time and the project's launchpad bug tag. Set the HREF of the
   * bug buttons
   */
    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
    /* "giturl" is the URL of the source file on Git and is auto-generated by
     * openstackdocstheme.
     *
     * "pagename" is a standard sphinx parameter containing the name of
     * the source file, without extension.
     */

    var sourceFile = "development_ondisk_backends" + ".rst";
    gitURL = "Source: https://opendev.org/openstack/swift/src/doc/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: c25d961319e59efe02c05374924ba82b873992e1";
    var repositoryName = "openstack/swift";
    var bugProject = "swift";
    var bugTitle = "Pluggable On-Disk Back-end APIs in Swift";
    var fieldTags = "";
    var useStoryboard = "";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 0.1.0.dev10162 on 2022-08-02 11:51:24";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags, repositoryName, useStoryboard);
    var currentSourceFile = "development_ondisk_backends";
    var pdfFileName = "doc-swift.pdf";
    pdfLink(currentSourceFile, pdfFileName);
</script>


  </body>
</html>