
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Erasure Code Support &#8212; Swift 0.1.0.dev10162 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/basic.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="canonical" href="/openstack-swift/overview_erasure_code.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Object Encryption" href="overview_encryption.html" />
    <link rel="prev" title="Cross-domain Policy File" href="crossdomain.html" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Bootstrap CSS -->
<link href="_static/css/bootstrap.min.css" rel="stylesheet">

<!-- Fonts -->
<link href="_static/css/font-awesome.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="_static/css/combined.css" rel="stylesheet">

<!-- Search CSS -->
<link href="_static/css/search.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="_static/pygments.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->


  </head><body>

<!-- SOURCE_FILE: https://opendev.org/openstack/swift/src/doc/source/overview_erasure_code.rst -->

<script>
    (function (window, document) {
        var loader = function () {
            var script = document.createElement("script"), tag = document.getElementsByTagName("script")[0];
            script.src = "https://search.openstack.org/widget/embed.min.js?t="+Date.now();
            tag.parentNode.insertBefore(script, tag);
        };
        window.addEventListener ? window.addEventListener("load", loader, false) : window.attachEvent("onload", loader);
    })(window, document);
</script>

<nav class="navbar navbar-default" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="https://www.openstack.org/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
    <div class="openstack-search-bar" data-baseUrl="search.openstack.org" data-context="docs-openstack"></div>
</div>
      <ul class="nav navbar-nav navbar-main show">
        <li class="search-container-mobile">
    <div class="openstack-search-bar" data-baseUrl="search.openstack.org" data-context="docs-openstack"></div>
</li>
        <li> <!--Software -->
          <a href="https://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/openstack-components">OpenStack Components</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/sdks">SDKs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/deployment-tools">Deployment Tools</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/assets/software/projectmap/openstack-map.pdf" target="_blank">OpenStack Map</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
          </ul>
        </li>
        <li> <!-- Use Cases -->
          <a href="https://www.openstack.org/use-cases/" class="drop" id="dropdownMenuUsers">Use Cases <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/">Users in Production</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/bare-metal/">Ironic Bare Metal</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/edge-computing/">Edge Computing</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/telecoms-and-nfv/">Telecom & NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/science/">Science and HPC</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/containers/">Containers</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/enterprise/">Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li> <!-- Events -->
          <a href="https://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">Open Infrastructure Summits</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/ptg/">Project Teams Gathering</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/opendev-2020/">OpenDev</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/community-events/">Community Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/openstackdays">OpenStack & OpenInfra Days</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
          </ul>
        </li>
        <li><!-- Community -->
          <a href="https://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/tech-committee">OpenStack Technical Committee</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/coa/">Get Certified (COA)</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketing/">Marketing Resources</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/news/">Community News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/supporting-organizations/">OpenInfra Foundation Supporting Organizations</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev">Open Infrastructure Foundation (OpenInfra Foundation)</a></li>
          </ul>
        </li>
        <li><!-- Marketplace -->
          <a href="https://www.openstack.orgmarketplace/" class="drop" id="dropdownMenuLearn">Marketplace <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/distros/">Distros & Appliances</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/public-clouds/">Public Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/hosted-private-clouds/">Hosted Private Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/remotely-managed-private-clouds/">Remotely Managed Private Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/consulting/">Consulting & Integrators</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/drivers/">Drivers</a></li>
          </ul>
        </li>
        <li><!-- Blog -->
          <a href="https://www.openstack.org/blog/">Blog</a>
        </li>
        <li><!-- Docs -->
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
        <li> <!-- Join -->
            <li class="join-nav-section">
              <a href="https://openinfra.dev/join/" id="dropdownMenuJoin">Join <i class="fa fa-caret-down"></i></a>
              <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuJoin" style="display: none;">
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev/join/">Sign up for Foundation Membership</a></li>
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev/join/">Sponsor the Foundation</a></li>
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev">More about the Foundation</a></li>
              </ul>
            </li>
            <li>
              <a href="https://www.openstack.org/Security/login/?BackURL=/home/" class="sign-in-btn">Log In</a>
            </li>
        </li>
      </ul>
    </div>
  </div>
  <!-- /.container -->
</nav>

    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row docs-title">
  <div class="col-lg-8">
      <h1>Erasure Code Support</h1>
    
  </div>
  <div class="docs-actions">
    
    <a href="crossdomain.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Cross-domain Policy File"></i></a>
    
    
    <a href="overview_encryption.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Object Encryption"></i></a>
    
    <a id="pdfLink1" href="" target="_blank" title="Download the manuals as PDF"><i class="fa fa-file-pdf-o" data-toggle="tooltip" data-placement="top" title="Download PDF"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
    
  </div>
</div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-body" role="main">

  <section id="erasure-code-support">
<h1>Erasure Code Support<a class="headerlink" href="#erasure-code-support" title="Permalink to this heading">¶</a></h1>
<section id="history-and-theory-of-operation">
<h2>History and Theory of Operation<a class="headerlink" href="#history-and-theory-of-operation" title="Permalink to this heading">¶</a></h2>
<p>There’s a lot of good material out there on Erasure Code (EC) theory, this short
introduction is just meant to provide some basic context to help the reader
better understand the implementation in Swift.</p>
<p>Erasure Coding for storage applications grew out of Coding Theory as far back as
the 1960s with the Reed-Solomon codes.  These codes have been used for years in
applications ranging from CDs to DVDs to general communications and, yes, even
in the space program starting with Voyager! The basic idea is that some amount
of data is broken up into smaller pieces called fragments and coded in such a
way that it can be transmitted with the ability to tolerate the loss of some
number of the coded fragments.  That’s where the word “erasure” comes in, if you
transmit 14 fragments and only 13 are received then one of them is said to be
“erased”.  The word “erasure” provides an important distinction with EC; it
isn’t about detecting errors, it’s about dealing with failures.  Another
important element of EC is that the number of erasures that can be tolerated can
be adjusted to meet the needs of the application.</p>
<p>At a high level EC works by using a specific scheme to break up a single data
buffer into several smaller data buffers then, depending on the scheme,
performing some encoding operation on that data in order to generate additional
information.  So you end up with more data than you started with and that extra
data is often called “parity”.  Note that there are many, many different
encoding techniques that vary both in how they organize and manipulate the data
as well by what means they use to calculate parity.  For example, one scheme
might rely on <a class="reference external" href="http://www.ssrc.ucsc.edu/Papers/plank-fast13.pdf">Galois Field Arithmetic</a> while others may work with only XOR. The number of variations and
details about their differences are well beyond the scope of this introduction,
but we will talk more about a few of them when we get into the implementation of
EC in Swift.</p>
<section id="overview-of-ec-support-in-swift">
<h3>Overview of EC Support in Swift<a class="headerlink" href="#overview-of-ec-support-in-swift" title="Permalink to this heading">¶</a></h3>
<p>First and foremost, from an application perspective EC support is totally
transparent. There are no EC related external API; a container is simply created
using a Storage Policy defined to use EC and then interaction with the cluster
is the same as any other durability policy.</p>
<p>EC is implemented in Swift as a Storage Policy, see <a class="reference internal" href="overview_policies.html"><span class="doc">Storage Policies</span></a> for
complete details on Storage Policies.  Because support is implemented as a
Storage Policy, all of the storage devices associated with your cluster’s EC
capability can be isolated.  It is entirely possible to share devices between
storage policies, but for EC it may make more sense to not only use separate
devices but possibly even entire nodes dedicated for EC.</p>
<p>Which direction one chooses depends on why the EC policy is being deployed.  If,
for example, there is a production replication policy in place already and the
goal is to add a cold storage tier such that the existing nodes performing
replication are impacted as little as possible, adding a new set of nodes
dedicated to EC might make the most sense but also incurs the most cost.  On the
other hand, if EC is being added as a capability to provide additional
durability for a specific set of applications and the existing infrastructure is
well suited for EC (sufficient number of nodes, zones for the EC scheme that is
chosen) then leveraging the existing infrastructure such that the EC ring shares
nodes with the replication ring makes the most sense.  These are some of the
main considerations:</p>
<ul class="simple">
<li><p>Layout of existing infrastructure.</p></li>
<li><p>Cost of adding dedicated EC nodes (or just dedicated EC devices).</p></li>
<li><p>Intended usage model(s).</p></li>
</ul>
<p>The Swift code base does not include any of the algorithms necessary to perform
the actual encoding and decoding of data; that is left to external libraries.
The Storage Policies architecture is leveraged to enable EC on a per container
basis – the object rings are still used to determine the placement of EC data
fragments. Although there are several code paths that are unique to an operation
associated with an EC policy, an external dependency to an Erasure Code library
is what Swift counts on to perform the low level EC functions.  The use of an
external library allows for maximum flexibility as there are a significant
number of options out there, each with its owns pros and cons that can vary
greatly from one use case to another.</p>
</section>
<section id="pyeclib-external-erasure-code-library">
<h3>PyECLib:  External Erasure Code Library<a class="headerlink" href="#pyeclib-external-erasure-code-library" title="Permalink to this heading">¶</a></h3>
<p>PyECLib is a Python Erasure Coding Library originally designed and written as
part of the effort to add EC support to the Swift project, however it is an
independent project.  The library provides a well-defined and simple Python
interface and internally implements a plug-in architecture allowing it to take
advantage of many well-known C libraries such as:</p>
<ul class="simple">
<li><p>Jerasure and GFComplete at <a class="reference external" href="http://jerasure.org">http://jerasure.org</a>.</p></li>
<li><p>Intel(R) ISA-L at <a class="reference external" href="http://01.org/intel%C2%AE-storage-acceleration-library-open-source-version">http://01.org/intel%C2%AE-storage-acceleration-library-open-source-version</a>.</p></li>
<li><p>Or write your own!</p></li>
</ul>
<p>PyECLib uses a C based library called liberasurecode to implement the plug in
infrastructure; liberasurecode is available at:</p>
<ul class="simple">
<li><p>liberasurecode: <a class="reference external" href="https://github.com/openstack/liberasurecode">https://github.com/openstack/liberasurecode</a></p></li>
</ul>
<p>PyECLib itself therefore allows for not only choice but further extensibility as
well. PyECLib also comes with a handy utility to help determine the best
algorithm to use based on the equipment that will be used (processors and server
configurations may vary in performance per algorithm).  More on this will be
covered in the configuration section.  PyECLib is included as a Swift
requirement.</p>
<p>For complete details see <a class="reference external" href="https://github.com/openstack/pyeclib">PyECLib</a></p>
</section>
<section id="storing-and-retrieving-objects">
<h3>Storing and Retrieving Objects<a class="headerlink" href="#storing-and-retrieving-objects" title="Permalink to this heading">¶</a></h3>
<p>We will discuss the details of how PUT and GET work in the “Under the Hood”
section later on. The key point here is that all of the erasure code work goes
on behind the scenes; this summary is a high level information overview only.</p>
<p>The PUT flow looks like this:</p>
<ol class="arabic simple">
<li><p>The proxy server streams in an object and buffers up “a segment” of data
(size is configurable).</p></li>
<li><p>The proxy server calls on PyECLib to encode the data into smaller fragments.</p></li>
<li><p>The proxy streams the encoded fragments out to the storage nodes based on
ring locations.</p></li>
<li><p>Repeat until the client is done sending data.</p></li>
<li><p>The client is notified of completion when a quorum is met.</p></li>
</ol>
<p>The GET flow looks like this:</p>
<ol class="arabic simple">
<li><p>The proxy server makes simultaneous requests to participating nodes.</p></li>
<li><p>As soon as the proxy has the fragments it needs, it calls on PyECLib to
decode the data.</p></li>
<li><p>The proxy streams the decoded data it has back to the client.</p></li>
<li><p>Repeat until the proxy is done sending data back to the client.</p></li>
</ol>
<p>It may sound like, from this high level overview, that using EC is going to
cause an explosion in the number of actual files stored in each node’s local
file system.  Although it is true that more files will be stored (because an
object is broken into pieces), the implementation works to minimize this where
possible, more details are available in the Under the Hood section.</p>
</section>
<section id="handoff-nodes">
<h3>Handoff Nodes<a class="headerlink" href="#handoff-nodes" title="Permalink to this heading">¶</a></h3>
<p>In EC policies, similarly to replication, handoff nodes are a set of storage
nodes used to augment the list of primary nodes responsible for storing an
erasure coded object. These handoff nodes are used in the event that one or more
of the primaries are unavailable.  Handoff nodes are still selected with an
attempt to achieve maximum separation of the data being placed.</p>
</section>
<section id="reconstruction">
<h3>Reconstruction<a class="headerlink" href="#reconstruction" title="Permalink to this heading">¶</a></h3>
<p>For an EC policy, reconstruction is analogous to the process of replication for
a replication type policy – essentially “the reconstructor” replaces “the
replicator” for EC policy types. The basic framework of reconstruction is very
similar to that of replication with a few notable exceptions:</p>
<ul class="simple">
<li><p>Because EC does not actually replicate partitions, it needs to operate at a
finer granularity than what is provided with rsync, therefore EC leverages
much of ssync behind the scenes (you do not need to manually configure ssync).</p></li>
<li><p>Once a pair of nodes has determined the need to replace a missing object
fragment, instead of pushing over a copy like replication would do, the
reconstructor has to read in enough surviving fragments from other nodes and
perform a local reconstruction before it has the correct data to push to the
other node.</p></li>
<li><p>A reconstructor does not talk to all other reconstructors in the set of nodes
responsible for an EC partition, this would be far too chatty, instead each
reconstructor is responsible for sync’ing with the partition’s closest two
neighbors (closest meaning left and right on the ring).</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>EC work (encode and decode) takes place both on the proxy nodes, for PUT/GET
operations, as well as on the storage nodes for reconstruction.  As with
replication, reconstruction can be the result of rebalancing, bit-rot, drive
failure or reverting data from a hand-off node back to its primary.</p>
</div>
</section>
</section>
<section id="performance-considerations">
<h2>Performance Considerations<a class="headerlink" href="#performance-considerations" title="Permalink to this heading">¶</a></h2>
<p>In general, EC has different performance characteristics than replicated data.
EC requires substantially more CPU to read and write data, and is more suited
for larger objects that are not frequently accessed (e.g. backups).</p>
<p>Operators are encouraged to characterize the performance of various EC schemes
and share their observations with the developer community.</p>
</section>
<section id="using-an-erasure-code-policy">
<span id="using-ec-policy"></span><h2>Using an Erasure Code Policy<a class="headerlink" href="#using-an-erasure-code-policy" title="Permalink to this heading">¶</a></h2>
<p>To use an EC policy, the administrator simply needs to define an EC policy in
<cite>swift.conf</cite> and create/configure the associated object ring.  An example of how
an EC policy can be setup is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">storage</span><span class="o">-</span><span class="n">policy</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">ec104</span>
<span class="n">policy_type</span> <span class="o">=</span> <span class="n">erasure_coding</span>
<span class="n">ec_type</span> <span class="o">=</span> <span class="n">liberasurecode_rs_vand</span>
<span class="n">ec_num_data_fragments</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">ec_num_parity_fragments</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">ec_object_segment_size</span> <span class="o">=</span> <span class="mi">1048576</span>
</pre></div>
</div>
<p>Let’s take a closer look at each configuration parameter:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: This is a standard storage policy parameter.
See <a class="reference internal" href="overview_policies.html"><span class="doc">Storage Policies</span></a> for details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">policy_type</span></code>: Set this to <code class="docutils literal notranslate"><span class="pre">erasure_coding</span></code> to indicate that this is an EC
policy.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ec_type</span></code>: Set this value according to the available options in the selected
PyECLib back-end. This specifies the EC scheme that is to be used.  For
example the option shown here selects Vandermonde Reed-Solomon encoding while
an option of <code class="docutils literal notranslate"><span class="pre">flat_xor_hd_3</span></code> would select Flat-XOR based HD combination
codes. See the <a class="reference external" href="https://github.com/openstack/pyeclib">PyECLib</a> page for
full details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ec_num_data_fragments</span></code>: The total number of fragments that will be
comprised of data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ec_num_parity_fragments</span></code>: The total number of fragments that will be
comprised of parity.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ec_object_segment_size</span></code>: The amount of data that will be buffered up before
feeding a segment into the encoder/decoder. The default value is 1048576.</p></li>
</ul>
<p>When PyECLib encodes an object, it will break it into N fragments. However, what
is important during configuration, is how many of those are data and how many
are parity.  So in the example above, PyECLib will actually break an object in
14 different fragments, 10 of them will be made up of actual object data and 4
of them will be made of parity data (calculations depending on ec_type).</p>
<p>When deciding which devices to use in the EC policy’s object ring, be sure to
carefully consider the performance impacts.  Running some performance
benchmarking in a test environment for your configuration is highly recommended
before deployment.</p>
<p>To create the EC policy’s object ring, the only difference in the usage of the
<code class="docutils literal notranslate"><span class="pre">swift-ring-builder</span> <span class="pre">create</span></code> command is the <code class="docutils literal notranslate"><span class="pre">replicas</span></code> parameter.  The
<code class="docutils literal notranslate"><span class="pre">replicas</span></code> value is the number of fragments spread across the object servers
associated with the ring; <code class="docutils literal notranslate"><span class="pre">replicas</span></code> must be equal to the sum of
<code class="docutils literal notranslate"><span class="pre">ec_num_data_fragments</span></code> and <code class="docutils literal notranslate"><span class="pre">ec_num_parity_fragments</span></code>. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">swift</span><span class="o">-</span><span class="n">ring</span><span class="o">-</span><span class="n">builder</span> <span class="nb">object</span><span class="o">-</span><span class="mf">1.</span><span class="n">builder</span> <span class="n">create</span> <span class="mi">10</span> <span class="mi">14</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Note that in this example the <code class="docutils literal notranslate"><span class="pre">replicas</span></code> value of <code class="docutils literal notranslate"><span class="pre">14</span></code> is based on the sum of
<code class="docutils literal notranslate"><span class="pre">10</span></code> EC data fragments and <code class="docutils literal notranslate"><span class="pre">4</span></code> EC parity fragments.</p>
<p>Once you have configured your EC policy in <cite>swift.conf</cite> and created your object
ring, your application is ready to start using EC simply by creating a container
with the specified policy name and interacting as usual.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It’s important to note that once you have deployed a policy and have created
objects with that policy, these configurations options cannot be changed. In
case a change in the configuration is desired, you must create a new policy
and migrate the data to a new container.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">isa_l_rs_vand</span></code> with more than 4 parity fragments creates fragments
which may in some circumstances fail to reconstruct properly or (with
liberasurecode &lt; 1.3.1) reconstruct corrupted data. New policies that need
large numbers of parity fragments should consider using <code class="docutils literal notranslate"><span class="pre">isa_l_rs_cauchy</span></code>.
Any existing affected policies must be marked deprecated, and data in
containers with that policy should be migrated to a new policy.</p>
</div>
<section id="migrating-between-policies">
<h3>Migrating Between Policies<a class="headerlink" href="#migrating-between-policies" title="Permalink to this heading">¶</a></h3>
<p>A common usage of EC is to migrate less commonly accessed data from a more
expensive but lower latency policy such as replication.  When an application
determines that it wants to move data from a replication policy to an EC policy,
it simply needs to move the data from the replicated container to an EC
container that was created with the target durability policy.</p>
</section>
</section>
<section id="global-ec">
<h2>Global EC<a class="headerlink" href="#global-ec" title="Permalink to this heading">¶</a></h2>
<p>The following recommendations are made when deploying an EC policy that spans
multiple regions in a <a class="reference internal" href="overview_global_cluster.html"><span class="doc">Global Cluster</span></a>:</p>
<ul class="simple">
<li><p>The global EC policy should use <a class="reference internal" href="#ec-duplication"><span class="std std-ref">EC Duplication</span></a> in conjunction with a
<a class="reference internal" href="overview_ring.html#composite-rings"><span class="std std-ref">Composite Ring</span></a>, as described below.</p></li>
<li><p>Proxy servers should be <a class="reference internal" href="overview_global_cluster.html#configuring-global-clusters"><span class="std std-ref">configured to use read affinity</span></a> to prefer reading from their local region for
the global EC policy. <a class="reference internal" href="deployment_guide.html#proxy-server-per-policy-config"><span class="std std-ref">Per policy configuration</span></a> allows this to be
configured for individual policies.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before deploying a Global EC policy, consideration should be given to the
<a class="reference internal" href="#global-ec-known-issues"><span class="std std-ref">Known Issues</span></a>, in particular the relatively poor
performance anticipated from the object-reconstructor.</p>
</div>
<section id="ec-duplication">
<span id="id2"></span><h3>EC Duplication<a class="headerlink" href="#ec-duplication" title="Permalink to this heading">¶</a></h3>
<p>EC Duplication enables Swift to make duplicated copies of fragments of erasure
coded objects.  If an EC storage policy is configured with a non-default
<code class="docutils literal notranslate"><span class="pre">ec_duplication_factor</span></code> of <code class="docutils literal notranslate"><span class="pre">N</span> <span class="pre">&gt;</span> <span class="pre">1</span></code>, then the policy will create <code class="docutils literal notranslate"><span class="pre">N</span></code>
duplicates of each unique fragment that is returned from the configured EC
engine.</p>
<p>Duplication of EC fragments is optimal for Global EC storage policies, which
require dispersion of fragment data across failure domains. Without fragment
duplication, common EC parameters will not distribute enough unique fragments
between large failure domains to allow for a rebuild using fragments from any
one domain.  For example a uniformly distributed <code class="docutils literal notranslate"><span class="pre">10+4</span></code> EC policy schema
would place 7 fragments in each of two failure domains, which is less in each
failure domain than the 10 fragments needed to rebuild a missing fragment.</p>
<p>Without fragment duplication, an EC policy schema must be adjusted to include
additional parity fragments in order to guarantee the number of fragments in
each failure domain is greater than the number required to rebuild. For
example, a uniformly distributed <code class="docutils literal notranslate"><span class="pre">10+18</span></code> EC policy schema would place 14
fragments in each of two failure domains, which is more than sufficient in each
failure domain to rebuild a missing fragment. However, empirical testing has
shown encoding a schema with <code class="docutils literal notranslate"><span class="pre">num_parity</span> <span class="pre">&gt;</span> <span class="pre">num_data</span></code> (such as <code class="docutils literal notranslate"><span class="pre">10+18</span></code>) is
less efficient than using duplication of fragments.  EC fragment duplication
enables Swift’s Global EC to maintain more independence between failure domains
without sacrificing efficiency on read/write or rebuild!</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ec_duplication_factor</span></code> option may be configured in <cite>swift.conf</cite> in each
<code class="docutils literal notranslate"><span class="pre">storage-policy</span></code> section. The option may be omitted - the default value is
<code class="docutils literal notranslate"><span class="pre">1</span></code> (i.e. no duplication):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">storage</span><span class="o">-</span><span class="n">policy</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">ec104</span>
<span class="n">policy_type</span> <span class="o">=</span> <span class="n">erasure_coding</span>
<span class="n">ec_type</span> <span class="o">=</span> <span class="n">liberasurecode_rs_vand</span>
<span class="n">ec_num_data_fragments</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">ec_num_parity_fragments</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">ec_object_segment_size</span> <span class="o">=</span> <span class="mi">1048576</span>
<span class="n">ec_duplication_factor</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>EC duplication is intended for use with Global EC policies. To ensure
independent availability of data in all regions, the
<code class="docutils literal notranslate"><span class="pre">ec_duplication_factor</span></code> option should only be used in conjunction with
<a class="reference internal" href="overview_ring.html#composite-rings"><span class="std std-ref">Composite Rings</span></a>, as described in this document.</p>
</div>
<p>In this example, a <code class="docutils literal notranslate"><span class="pre">10+4</span></code> schema and a duplication factor of <code class="docutils literal notranslate"><span class="pre">2</span></code> will
result in <code class="docutils literal notranslate"><span class="pre">(10+4)x2</span> <span class="pre">=</span> <span class="pre">28</span></code> fragments being stored (we will use the shorthand
<code class="docutils literal notranslate"><span class="pre">10+4x2</span></code> to denote that policy configuration) .  The ring for this policy
should be configured with 28 replicas (i.e.  <code class="docutils literal notranslate"><span class="pre">(ec_num_data_fragments</span> <span class="pre">+</span>
<span class="pre">ec_num_parity_fragments)</span> <span class="pre">*</span> <span class="pre">ec_duplication_factor</span></code>).  A <code class="docutils literal notranslate"><span class="pre">10+4x2</span></code> schema
<strong>can</strong> allow a multi-region deployment to rebuild an object to full durability
even when <em>more</em> than 14 fragments are unavailable.  This is advantageous with
respect to a <code class="docutils literal notranslate"><span class="pre">10+18</span></code> configuration not only because reads from data fragments
will be more common and more efficient, but also because a <code class="docutils literal notranslate"><span class="pre">10+4x2</span></code> can grow
into a <code class="docutils literal notranslate"><span class="pre">10+4x3</span></code> to expand into another region.</p>
<section id="ec-duplication-with-composite-rings">
<h4>EC duplication with composite rings<a class="headerlink" href="#ec-duplication-with-composite-rings" title="Permalink to this heading">¶</a></h4>
<p>It is recommended that EC Duplication is used with <a class="reference internal" href="overview_ring.html#composite-rings"><span class="std std-ref">Composite Rings</span></a> in
order to disperse duplicate fragments across regions.</p>
<p>When EC duplication is used, it is highly desirable to have one duplicate of
each fragment placed in each region. This ensures that a set of
<code class="docutils literal notranslate"><span class="pre">ec_num_data_fragments</span></code> unique fragments (the minimum needed to reconstruct
an object) can always be assembled from a single region. This in turn means
that objects are robust in the event of an entire region becoming unavailable.</p>
<p>This can be achieved by using a <a class="reference internal" href="overview_ring.html#composite-rings"><span class="std std-ref">composite ring</span></a> with
the following properties:</p>
<ul class="simple">
<li><p>The number of component rings in the composite ring is equal to the
<code class="docutils literal notranslate"><span class="pre">ec_duplication_factor</span></code> for the policy.</p></li>
<li><p>Each <em>component</em> ring has a number of <code class="docutils literal notranslate"><span class="pre">replicas</span></code> that is equal to the sum
of <code class="docutils literal notranslate"><span class="pre">ec_num_data_fragments</span></code> and <code class="docutils literal notranslate"><span class="pre">ec_num_parity_fragments</span></code>.</p></li>
<li><p>Each component ring is populated with devices in a unique region.</p></li>
</ul>
<p>This arrangement results in each component ring in the composite ring, and
therefore each region, having one copy of each fragment.</p>
<p>For example, consider a Swift cluster with two regions, <code class="docutils literal notranslate"><span class="pre">region1</span></code> and
<code class="docutils literal notranslate"><span class="pre">region2</span></code> and a <code class="docutils literal notranslate"><span class="pre">4+2x2</span></code> EC policy schema. This policy should use a
composite ring with two component rings, <code class="docutils literal notranslate"><span class="pre">ring1</span></code> and <code class="docutils literal notranslate"><span class="pre">ring2</span></code>, having
devices exclusively in regions <code class="docutils literal notranslate"><span class="pre">region1</span></code> and <code class="docutils literal notranslate"><span class="pre">region2</span></code> respectively. Each
component ring should have <code class="docutils literal notranslate"><span class="pre">replicas</span> <span class="pre">=</span> <span class="pre">6</span></code>. As a result, the first 6
fragments for an object will always be placed in <code class="docutils literal notranslate"><span class="pre">ring1</span></code> (i.e. in
<code class="docutils literal notranslate"><span class="pre">region1</span></code>) and the second 6 duplicate fragments will always be placed in
<code class="docutils literal notranslate"><span class="pre">ring2</span></code> (i.e. in <code class="docutils literal notranslate"><span class="pre">region2</span></code>).</p>
<p>Conversely, a conventional ring spanning the two regions may give a suboptimal
distribution of duplicates across the regions; it is possible for duplicates of
the same fragment to be placed in the same region, and consequently for another
region to have no copies of that fragment. This may make it impossible to
assemble a set of <code class="docutils literal notranslate"><span class="pre">ec_num_data_fragments</span></code> unique fragments from a single
region. For example, the conventional ring could have a pathologically
sub-optimal placement such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r1</span>
  <span class="o">&lt;</span><span class="n">timestamp</span><span class="o">&gt;</span><span class="c1">#0#d.data</span>
  <span class="o">&lt;</span><span class="n">timestamp</span><span class="o">&gt;</span><span class="c1">#0#d.data</span>
  <span class="o">&lt;</span><span class="n">timestamp</span><span class="o">&gt;</span><span class="c1">#2#d.data</span>
  <span class="o">&lt;</span><span class="n">timestamp</span><span class="o">&gt;</span><span class="c1">#2#d.data</span>
  <span class="o">&lt;</span><span class="n">timestamp</span><span class="o">&gt;</span><span class="c1">#4#d.data</span>
  <span class="o">&lt;</span><span class="n">timestamp</span><span class="o">&gt;</span><span class="c1">#4#d.data</span>
<span class="n">r2</span>
  <span class="o">&lt;</span><span class="n">timestamp</span><span class="o">&gt;</span><span class="c1">#1#d.data</span>
  <span class="o">&lt;</span><span class="n">timestamp</span><span class="o">&gt;</span><span class="c1">#1#d.data</span>
  <span class="o">&lt;</span><span class="n">timestamp</span><span class="o">&gt;</span><span class="c1">#3#d.data</span>
  <span class="o">&lt;</span><span class="n">timestamp</span><span class="o">&gt;</span><span class="c1">#3#d.data</span>
  <span class="o">&lt;</span><span class="n">timestamp</span><span class="o">&gt;</span><span class="c1">#5#d.data</span>
  <span class="o">&lt;</span><span class="n">timestamp</span><span class="o">&gt;</span><span class="c1">#5#d.data</span>
</pre></div>
</div>
<p>In this case, the object cannot be reconstructed  from a single region;
<code class="docutils literal notranslate"><span class="pre">region1</span></code> has only the fragments with index <code class="docutils literal notranslate"><span class="pre">0,</span> <span class="pre">2,</span> <span class="pre">4</span></code> and <code class="docutils literal notranslate"><span class="pre">region2</span></code> has
the other 3 indexes, but we need 4 unique indexes to be able to rebuild an
object.</p>
</section>
<section id="node-selection-strategy-for-reads">
<h4>Node Selection Strategy for Reads<a class="headerlink" href="#node-selection-strategy-for-reads" title="Permalink to this heading">¶</a></h4>
<p>Proxy servers require a set of <em>unique</em> fragment indexes to decode the original
object when handling a GET request to an EC policy. With a conventional EC
policy, this is very likely to be the outcome of reading fragments from a
random selection of backend nodes. With an EC Duplication policy it is
significantly more likely that responses from a <em>random</em> selection of backend
nodes might include some duplicated fragments.</p>
<p>For this reason it is strongly recommended that EC Duplication always be
deployed in combination with <a class="reference internal" href="overview_ring.html#composite-rings"><span class="std std-ref">Composite Rings</span></a> and <a class="reference internal" href="overview_global_cluster.html#configuring-global-clusters"><span class="std std-ref">proxy server read
affinity</span></a>.</p>
<p>Under normal conditions with the recommended deployment, read affinity will
cause a proxy server to first attempt to read fragments from nodes in its local
region. These fragments are guaranteed to be unique with respect to each other.
Even if there are a small number of local failures, unique local parity
fragments will make up the difference.  However, should enough local primary
storage nodes fail, such that sufficient unique fragments are not available in
the local region, a global EC cluster will proceed to read fragments from the
other region(s). Random reads from the remote region are not guaranteed to
return unique fragments; with EC Duplication there is a significantly high
probability that the proxy server will encounter a fragment that is a duplicate
of one it has already found in the local region. The proxy server will ignore
these and make additional requests until it accumulates the required set of
unique fragments, potentially searching all the primary and handoff locations
in the local and remote regions before ultimately failing the read.</p>
<p>A global EC deployment configured as recommended is therefore extremely
resilient. However, under extreme failure conditions read handling can be
inefficient because nodes in other regions are guaranteed to have some
fragments which are duplicates of those the proxy server has already received.
Work is in progress to improve the proxy server node selection strategy such
that when it is necessary to read from other regions, nodes that are likely to
have useful fragments are preferred over those that are likely to return a
duplicate.</p>
</section>
</section>
<section id="known-issues">
<span id="global-ec-known-issues"></span><h3>Known Issues<a class="headerlink" href="#known-issues" title="Permalink to this heading">¶</a></h3>
<section id="efficient-cross-region-rebuild">
<h4>Efficient Cross Region Rebuild<a class="headerlink" href="#efficient-cross-region-rebuild" title="Permalink to this heading">¶</a></h4>
<p>Work is also in progress to improve the object-reconstructor efficiency for
Global EC policies. Unlike the proxy server, the reconstructor does not apply
any read affinity settings when gathering fragments. It is therefore likely to
receive duplicated fragments (i.e. make wasted backend GET requests) while
performing <em>every</em> fragment reconstruction.</p>
<p>Additionally, other reconstructor optimisations for Global EC are under
investigation:</p>
<ul class="simple">
<li><p>Since fragments are duplicated between regions it may in some cases be more
attractive to restore failed fragments from their duplicates in another
region instead of rebuilding them from other fragments in the local region.</p></li>
<li><p>Conversely, to avoid WAN transfer it may be more attractive to rebuild
fragments from local parity.</p></li>
<li><p>During rebalance it will always be more attractive to revert a fragment from
it’s old-primary to it’s new primary rather than rebuilding or transferring a
duplicate from the remote region.</p></li>
</ul>
</section>
</section>
</section>
<section id="under-the-hood">
<h2>Under the Hood<a class="headerlink" href="#under-the-hood" title="Permalink to this heading">¶</a></h2>
<p>Now that we’ve explained a little about EC support in Swift and how to
configure and use it, let’s explore how EC fits in at the nuts-n-bolts level.</p>
<section id="terminology">
<h3>Terminology<a class="headerlink" href="#terminology" title="Permalink to this heading">¶</a></h3>
<p>The term ‘fragment’ has been used already to describe the output of the EC
process (a series of fragments) however we need to define some other key terms
here before going any deeper.  Without paying special attention to using the
correct terms consistently, it is very easy to get confused in a hurry!</p>
<ul class="simple">
<li><p><strong>chunk</strong>: HTTP chunks received over wire (term not used to describe any EC
specific operation).</p></li>
<li><p><strong>segment</strong>: Not to be confused with SLO/DLO use of the word, in EC we call a
segment a series of consecutive HTTP chunks buffered up before performing an
EC operation.</p></li>
<li><p><strong>fragment</strong>: Data and parity ‘fragments’ are generated when erasure coding
transformation is applied to a segment.</p></li>
<li><p><strong>EC archive</strong>: A concatenation of EC fragments; to a storage node this looks
like an object.</p></li>
<li><p><strong>ec_ndata</strong>: Number of EC data fragments.</p></li>
<li><p><strong>ec_nparity</strong>: Number of EC parity fragments.</p></li>
</ul>
</section>
<section id="middleware">
<h3>Middleware<a class="headerlink" href="#middleware" title="Permalink to this heading">¶</a></h3>
<p>Middleware remains unchanged.  For most middleware (e.g., SLO/DLO) the fact that
the proxy is fragmenting incoming objects is transparent.  For list endpoints,
however, it is a bit different. A caller of list endpoints will get back the
locations of all of the fragments.  The caller will be unable to re-assemble the
original object with this information, however the node locations may still
prove to be useful information for some applications.</p>
</section>
<section id="on-disk-storage">
<h3>On Disk Storage<a class="headerlink" href="#on-disk-storage" title="Permalink to this heading">¶</a></h3>
<p>EC archives are stored on disk in their respective objects-N directory based on
their policy index.  See <a class="reference internal" href="overview_policies.html"><span class="doc">Storage Policies</span></a> for details on per policy
directory information.</p>
<p>In addition to the object timestamp, the filenames of EC archives encode other
information related to the archive:</p>
<ul>
<li><p>The fragment archive index. This is required for a few reasons. For one, it
allows us to store fragment archives of different indexes on the same storage
node which is not typical however it is possible in many circumstances.
Without unique filenames for the different EC archive files in a set, we
would be at risk of overwriting one archive of index <cite>n</cite> with another of
index <cite>m</cite> in some scenarios.</p>
<p>The index is appended to the filename just before the <code class="docutils literal notranslate"><span class="pre">.data</span></code> extension.
For example, the filename for a fragment archive storing the 5th fragment
would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1418673556.92690</span><span class="c1">#5.data</span>
</pre></div>
</div>
</li>
<li><p>The durable state of the archive. The meaning of this will be described in
more detail later, but a fragment archive that is considered durable has an
additional <code class="docutils literal notranslate"><span class="pre">#d</span></code> string included in its filename immediately before the
<code class="docutils literal notranslate"><span class="pre">.data</span></code> extension. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1418673556.92690</span><span class="c1">#5#d.data</span>
</pre></div>
</div>
</li>
</ul>
<p>A policy-specific transformation function is therefore used to build the
archive filename. These functions are implemented in the diskfile module as
methods of policy specific sub classes of <code class="docutils literal notranslate"><span class="pre">BaseDiskFileManager</span></code>.</p>
<p>The transformation function for the replication policy is simply a NOP.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In older versions the durable state of an archive was represented by an
additional file called the <code class="docutils literal notranslate"><span class="pre">.durable</span></code> file instead of the <code class="docutils literal notranslate"><span class="pre">#d</span></code>
substring in the <code class="docutils literal notranslate"><span class="pre">.data</span></code> filename. The <code class="docutils literal notranslate"><span class="pre">.durable</span></code> for the example above
would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1418673556.92690</span><span class="o">.</span><span class="n">durable</span>
</pre></div>
</div>
</div>
</section>
<section id="proxy-server">
<h3>Proxy Server<a class="headerlink" href="#proxy-server" title="Permalink to this heading">¶</a></h3>
<section id="high-level">
<h4>High Level<a class="headerlink" href="#high-level" title="Permalink to this heading">¶</a></h4>
<p>The Proxy Server handles Erasure Coding in a different manner than replication,
therefore there are several code paths unique to EC policies either though sub
classing or simple conditionals.  Taking a closer look at the PUT and the GET
paths will help make this clearer.  But first, a high level overview of how an
object flows through the system:</p>
<img alt="_images/ec_overview.png" src="_images/ec_overview.png" />
<p>Note how:</p>
<ul class="simple">
<li><p>Incoming objects are buffered into segments at the proxy.</p></li>
<li><p>Segments are erasure coded into fragments at the proxy.</p></li>
<li><p>The proxy stripes fragments across participating nodes such that the on-disk
stored files that we call a fragment archive is appended with each new
fragment.</p></li>
</ul>
<p>This scheme makes it possible to minimize the number of on-disk files given our
segmenting and fragmenting.</p>
</section>
<section id="multi-phase-conversation">
<h4>Multi_Phase Conversation<a class="headerlink" href="#multi-phase-conversation" title="Permalink to this heading">¶</a></h4>
<p>Multi-part MIME document support is used to allow the proxy to engage in a
handshake conversation with the storage node for processing PUT requests.  This
is required for a few different reasons.</p>
<ol class="arabic simple">
<li><p>From the perspective of the storage node, a fragment archive is really just
another object, we need a mechanism to send down the original object etag
after all fragment archives have landed.</p></li>
<li><p>Without introducing strong consistency semantics, the proxy needs a mechanism
to know when a quorum of fragment archives have actually made it to disk
before it can inform the client of a successful PUT.</p></li>
</ol>
<p>MIME supports a conversation between the proxy and the storage nodes for every
PUT. This provides us with the ability to handle a PUT in one connection and
assure that we have the essence of a 2 phase commit, basically having the proxy
communicate back to the storage nodes once it has confirmation that a quorum of
fragment archives in the set have been written.</p>
<p>For the first phase of the conversation the proxy requires a quorum of
<cite>ec_ndata + 1</cite> fragment archives to be successfully put to storage nodes. This
ensures that the object could still be reconstructed even if one of the
fragment archives becomes unavailable. As described above, each fragment
archive file is named:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">ts</span><span class="o">&gt;</span><span class="c1">#&lt;frag_index&gt;.data</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">ts</span></code> is the timestamp and <code class="docutils literal notranslate"><span class="pre">frag_index</span></code> is the fragment archive index.</p>
<p>During the second phase of the conversation the proxy communicates a
confirmation to storage nodes that the fragment archive quorum has been
achieved. This causes each storage node to rename the fragment archive written
in the first phase of the conversation to include the substring <code class="docutils literal notranslate"><span class="pre">#d</span></code> in its
name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">ts</span><span class="o">&gt;</span><span class="c1">#&lt;frag_index&gt;#d.data</span>
</pre></div>
</div>
<p>This indicates to the object server that this fragment archive is <cite>durable</cite> and
that there is a set of data files that are durable at timestamp <code class="docutils literal notranslate"><span class="pre">ts</span></code>.</p>
<p>For the second phase of the conversation the proxy requires a quorum of
<cite>ec_ndata + 1</cite> successful commits on storage nodes. This ensures that there are
sufficient committed fragment archives for the object to be reconstructed even
if one becomes unavailable. The reconstructor ensures that the durable state is
replicated on storage nodes where it may be missing.</p>
<p>Note that the completion of the commit phase of the conversation
is also a signal for the object server to go ahead and immediately delete older
timestamp files for this object. This is critical as we do not want to delete
the older object until the storage node has confirmation from the proxy, via the
multi-phase conversation, that the other nodes have landed enough for a quorum.</p>
<p>The basic flow looks like this:</p>
<ol class="arabic simple">
<li><p>The Proxy Server erasure codes and streams the object fragments
(ec_ndata + ec_nparity) to the storage nodes.</p></li>
<li><p>The storage nodes store objects as EC archives and upon finishing object
data/metadata write, send a 1st-phase response to proxy.</p></li>
<li><p>Upon quorum of storage nodes responses, the proxy initiates 2nd-phase by
sending commit confirmations to object servers.</p></li>
<li><p>Upon receipt of commit message, object servers rename <code class="docutils literal notranslate"><span class="pre">.data</span></code> files to
include the <code class="docutils literal notranslate"><span class="pre">#d</span></code> substring, indicating successful PUT, and send a final
response to the proxy server.</p></li>
<li><p>The proxy waits for <cite>ec_ndata + 1</cite> object servers to respond with a
success (2xx) status before responding to the client with a successful
status.</p></li>
</ol>
<p>Here is a high level example of what the conversation looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">proxy</span><span class="p">:</span> <span class="n">PUT</span> <span class="o">/</span><span class="n">p</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">o</span>
     <span class="n">Transfer</span><span class="o">-</span><span class="n">Encoding</span><span class="s1">&#39;: &#39;</span><span class="n">chunked</span><span class="s1">&#39;</span>
     <span class="n">Expect</span><span class="s1">&#39;: &#39;</span><span class="mi">100</span><span class="o">-</span><span class="k">continue</span><span class="s1">&#39;</span>
     <span class="n">X</span><span class="o">-</span><span class="n">Backend</span><span class="o">-</span><span class="n">Obj</span><span class="o">-</span><span class="n">Multiphase</span><span class="o">-</span><span class="n">Commit</span><span class="p">:</span> <span class="n">yes</span>
<span class="n">obj</span><span class="p">:</span>   <span class="mi">100</span> <span class="n">Continue</span>
     <span class="n">X</span><span class="o">-</span><span class="n">Obj</span><span class="o">-</span><span class="n">Multiphase</span><span class="o">-</span><span class="n">Commit</span><span class="p">:</span> <span class="n">yes</span>
<span class="n">proxy</span><span class="p">:</span> <span class="o">--</span><span class="n">MIMEboundary</span>
     <span class="n">X</span><span class="o">-</span><span class="n">Document</span><span class="p">:</span> <span class="nb">object</span> <span class="n">body</span>
     <span class="o">&lt;</span><span class="n">obj_data</span><span class="o">&gt;</span>
     <span class="o">--</span><span class="n">MIMEboundary</span>
     <span class="n">X</span><span class="o">-</span><span class="n">Document</span><span class="p">:</span> <span class="nb">object</span> <span class="n">metadata</span>
     <span class="n">Content</span><span class="o">-</span><span class="n">MD5</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">footer_meta_cksum</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">footer_meta</span><span class="o">&gt;</span>
     <span class="o">--</span><span class="n">MIMEboundary</span>
<span class="o">&lt;</span><span class="nb">object</span> <span class="n">server</span> <span class="n">writes</span> <span class="n">data</span><span class="p">,</span> <span class="n">metadata</span> <span class="n">to</span> <span class="o">&lt;</span><span class="n">ts</span><span class="o">&gt;</span><span class="c1">#&lt;frag_index&gt;.data file&gt;</span>
<span class="n">obj</span><span class="p">:</span>   <span class="mi">100</span> <span class="n">Continue</span>
<span class="o">&lt;</span><span class="n">quorum</span><span class="o">&gt;</span>
<span class="n">proxy</span><span class="p">:</span> <span class="n">X</span><span class="o">-</span><span class="n">Document</span><span class="p">:</span> <span class="n">put</span> <span class="n">commit</span>
     <span class="n">commit_confirmation</span>
     <span class="o">--</span><span class="n">MIMEboundary</span><span class="o">--</span>
<span class="o">&lt;</span><span class="nb">object</span> <span class="n">server</span> <span class="n">renames</span> <span class="o">&lt;</span><span class="n">ts</span><span class="o">&gt;</span><span class="c1">#&lt;frag_index&gt;.data to &lt;ts&gt;#&lt;frag_index&gt;#d.data&gt;</span>
<span class="n">obj</span><span class="p">:</span>   <span class="mi">20</span><span class="n">x</span>
<span class="o">&lt;</span><span class="n">proxy</span> <span class="n">waits</span> <span class="n">to</span> <span class="n">receive</span> <span class="o">&gt;=</span><span class="mi">2</span> <span class="mi">2</span><span class="n">xx</span> <span class="n">responses</span><span class="o">&gt;</span>
<span class="n">proxy</span><span class="p">:</span> <span class="mi">2</span><span class="n">xx</span> <span class="o">-&gt;</span> <span class="n">client</span>
</pre></div>
</div>
<p>A few key points on the durable state of a fragment archive:</p>
<ul class="simple">
<li><p>A durable fragment archive means that there exist sufficient other fragment
archives elsewhere in the cluster (durable and/or non-durable) to reconstruct
the object.</p></li>
<li><p>When a proxy does a GET, it will require at least one object server to
respond with a fragment archive is durable before reconstructing and
returning the object to the client.</p></li>
</ul>
</section>
<section id="partial-put-failures">
<h4>Partial PUT Failures<a class="headerlink" href="#partial-put-failures" title="Permalink to this heading">¶</a></h4>
<p>A partial PUT failure has a few different modes.  In one scenario the Proxy
Server is alive through the entire PUT conversation.  This is a very
straightforward case. The client will receive a good response if and only if a
quorum of fragment archives were successfully landed on their storage nodes.
In this case the Reconstructor will discover the missing fragment archives,
perform a reconstruction and deliver those fragment archives to their nodes.</p>
<p>The more interesting case is what happens if the proxy dies in the middle of a
conversation.  If it turns out that a quorum had been met and the commit phase
of the conversation finished, its as simple as the previous case in that the
reconstructor will repair things.  However, if the commit didn’t get a chance to
happen then some number of the storage nodes have .data files on them (fragment
archives) but none of them knows whether there are enough elsewhere for the
entire object to be reconstructed.  In this case the client will not have
received a 2xx response so there is no issue there, however, it is left to the
storage nodes to clean up the stale fragment archives.  Work is ongoing in this
area to enable the proxy to play a role in reviving these fragment archives,
however, for the current release, a proxy failure after the start of a
conversation but before the commit message will simply result in a PUT failure.</p>
</section>
<section id="get">
<h4>GET<a class="headerlink" href="#get" title="Permalink to this heading">¶</a></h4>
<p>The GET for EC is different enough from replication that subclassing the
<cite>BaseObjectController</cite> to the <cite>ECObjectController</cite> enables an efficient way to
implement the high level steps described earlier:</p>
<ol class="arabic simple">
<li><p>The proxy server makes simultaneous requests to <cite>ec_ndata</cite> primary object
server nodes with goal of finding a set of <cite>ec_ndata</cite> distinct EC archives
at the same timestamp, and an indication from at least one object server
that a durable fragment archive exists for that timestamp. If this goal is
not achieved with the first <cite>ec_ndata</cite> requests then the proxy server
continues to issue requests to the remaining primary nodes and then handoff
nodes.</p></li>
<li><p>As soon as the proxy server has found a usable set of <cite>ec_ndata</cite> EC
archives, it starts to call PyECLib to decode fragments as they are returned
by the object server nodes.</p></li>
<li><p>The proxy server creates Etag and content length headers for the client
response since each EC archive’s metadata is valid only for that archive.</p></li>
<li><p>The proxy streams the decoded data it has back to the client.</p></li>
</ol>
<p>Note that the proxy does not require all objects servers to have a durable
fragment archive to return in response to a GET. The proxy will be satisfied if
just one object server has a durable fragment archive at the same timestamp as
EC archives returned from other object servers. This means that the proxy can
successfully GET an object that had missing durable state on some nodes when it
was PUT (i.e. a partial PUT failure occurred).</p>
<p>Note also that an object server may inform the proxy server that it has more
than one EC archive for different timestamps and/or fragment indexes, which may
cause the proxy server to issue multiple requests for distinct EC archives to
that object server. (This situation can temporarily occur after a ring
rebalance when a handoff node storing an archive has become a primary node and
received its primary archive but not yet moved the handoff archive to its
primary node.)</p>
<p>The proxy may receive EC archives having different timestamps, and may
receive several EC archives having the same index. The proxy therefore
ensures that it has sufficient EC archives with the same timestamp
and distinct fragment indexes before considering a GET to be successful.</p>
</section>
</section>
<section id="object-server">
<h3>Object Server<a class="headerlink" href="#object-server" title="Permalink to this heading">¶</a></h3>
<p>The Object Server, like the Proxy Server, supports MIME conversations as
described in the proxy section earlier. This includes processing of the commit
message and decoding various sections of the MIME document to extract the footer
which includes things like the entire object etag.</p>
<section id="diskfile">
<h4>DiskFile<a class="headerlink" href="#diskfile" title="Permalink to this heading">¶</a></h4>
<p>Erasure code policies use subclassed <code class="docutils literal notranslate"><span class="pre">ECDiskFile</span></code>, <code class="docutils literal notranslate"><span class="pre">ECDiskFileWriter</span></code>,
<code class="docutils literal notranslate"><span class="pre">ECDiskFileReader</span></code> and <code class="docutils literal notranslate"><span class="pre">ECDiskFileManager</span></code> to implement EC specific
handling of on disk files.  This includes things like file name manipulation to
include the fragment index and durable state in the filename, construction of
EC specific <code class="docutils literal notranslate"><span class="pre">hashes.pkl</span></code> file to include fragment index information, etc.</p>
<section id="metadata">
<h5>Metadata<a class="headerlink" href="#metadata" title="Permalink to this heading">¶</a></h5>
<p>There are few different categories of metadata that are associated with EC:</p>
<p>System Metadata: EC has a set of object level system metadata that it
attaches to each of the EC archives.  The metadata is for internal use only:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">X-Object-Sysmeta-EC-Etag</span></code>:  The Etag of the original object.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-Object-Sysmeta-EC-Content-Length</span></code>: The content length of the original
object.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-Object-Sysmeta-EC-Frag-Index</span></code>: The fragment index for the object.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-Object-Sysmeta-EC-Scheme</span></code>: Description of the EC policy used to encode
the object.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-Object-Sysmeta-EC-Segment-Size</span></code>: The segment size used for the object.</p></li>
</ul>
<p>User Metadata:  User metadata is unaffected by EC, however, a full copy of the
user metadata is stored with every EC archive.  This is required as the
reconstructor needs this information and each reconstructor only communicates
with its closest neighbors on the ring.</p>
<p>PyECLib Metadata:  PyECLib stores a small amount of metadata on a per fragment
basis.  This metadata is not documented here as it is opaque to Swift.</p>
</section>
</section>
</section>
<section id="database-updates">
<h3>Database Updates<a class="headerlink" href="#database-updates" title="Permalink to this heading">¶</a></h3>
<p>As account and container rings are not associated with a Storage Policy, there
is no change to how these database updates occur when using an EC policy.</p>
</section>
<section id="the-reconstructor">
<h3>The Reconstructor<a class="headerlink" href="#the-reconstructor" title="Permalink to this heading">¶</a></h3>
<p>The Reconstructor performs analogous functions to the replicator:</p>
<ol class="arabic simple">
<li><p>Recovering from disk drive failure.</p></li>
<li><p>Moving data around because of a rebalance.</p></li>
<li><p>Reverting data back to a primary from a handoff.</p></li>
<li><p>Recovering fragment archives from bit rot discovered by the auditor.</p></li>
</ol>
<p>However, under the hood it operates quite differently.  The following are some
of the key elements in understanding how the reconstructor operates.</p>
<p>Unlike the replicator, the work that the reconstructor does is not always as
easy to break down into the 2 basic tasks of synchronize or revert (move data
from handoff back to primary) because of the fact that one storage node can
house fragment archives of various indexes and each index really &quot;belongs&quot; to
a different node.  So, whereas when the replicator is reverting data from a
handoff it has just one node to send its data to, the reconstructor can have
several.  Additionally, it is not always the case that the processing of a
particular suffix directory means one or the other job type for the entire
directory (as it does for replication). The scenarios that create these mixed
situations can be pretty complex so we will just focus on what the
reconstructor does here and not a detailed explanation of why.</p>
<section id="job-construction-and-processing">
<h4>Job Construction and Processing<a class="headerlink" href="#job-construction-and-processing" title="Permalink to this heading">¶</a></h4>
<p>Because of the nature of the work it has to do as described above, the
reconstructor builds jobs for a single job processor.  The job itself contains
all of the information needed for the processor to execute the job which may be
a synchronization or a data reversion.  There may be a mix of jobs that
perform both of these operations on the same suffix directory.</p>
<p>Jobs are constructed on a per-partition basis and then per-fragment-index basis.
That is, there will be one job for every fragment index in a partition.
Performing this construction &quot;up front&quot; like this helps minimize the
interaction between nodes collecting hashes.pkl information.</p>
<p>Once a set of jobs for a partition has been constructed, those jobs are sent off
to threads for execution. The single job processor then performs the necessary
actions, working closely with ssync to carry out its instructions.  For data
reversion, the actual objects themselves are cleaned up via the ssync module and
once that partition’s set of jobs is complete, the reconstructor will attempt to
remove the relevant directory structures.</p>
<p>Job construction must account for a variety of scenarios, including:</p>
<ol class="arabic simple">
<li><p>A partition directory with all fragment indexes matching the local node
index.  This is the case where everything is where it belongs and we just
need to compare hashes and sync if needed. Here we simply sync with our
partners.</p></li>
<li><p>A partition directory with at least one local fragment index and mix of
others.  Here we need to sync with our partners where fragment indexes
matches the local_id, all others are sync’d with their home nodes and then
deleted.</p></li>
<li><p>A partition directory with no local fragment index and just one or more of
others. Here we sync with just the home nodes for the fragment indexes that
we have and then all the local archives are deleted.  This is the basic
handoff reversion case.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A &quot;home node&quot; is the node where the fragment index encoded in the
fragment archive’s filename matches the node index of a node in the primary
partition list.</p>
</div>
</section>
<section id="node-communication">
<h4>Node Communication<a class="headerlink" href="#node-communication" title="Permalink to this heading">¶</a></h4>
<p>The replicators talk to all nodes who have a copy of their object, typically
just 2 other nodes.  For EC, having each reconstructor node talk to all nodes
would incur a large amount of overhead as there will typically be a much larger
number of nodes participating in the EC scheme.  Therefore, the reconstructor is
built to talk to its adjacent nodes on the ring only.  These nodes are typically
referred to as partners.</p>
</section>
<section id="id3">
<h4>Reconstruction<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h4>
<p>Reconstruction can be thought of sort of like replication but with an extra step
in the middle. The reconstructor is hard-wired to use ssync to determine what is
missing and desired by the other side. However, before an object is sent over
the wire it needs to be reconstructed from the remaining fragments as the local
fragment is just that - a different fragment index than what the other end is
asking for.</p>
<p>Thus, there are hooks in ssync for EC based policies. One case would be for
basic reconstruction which, at a high level, looks like this:</p>
<ul class="simple">
<li><p>Determine which nodes need to be contacted to collect other EC archives needed
to perform reconstruction.</p></li>
<li><p>Update the etag and fragment index metadata elements of the newly constructed
fragment archive.</p></li>
<li><p>Establish a connection to the target nodes and give ssync a DiskFileLike class
from which it can stream data.</p></li>
</ul>
<p>The reader in this class gathers fragments from the nodes and uses PyECLib to
reconstruct each segment before yielding data back to ssync. Essentially what
this means is that data is buffered, in memory, on a per segment basis at the
node performing reconstruction and each segment is dynamically reconstructed and
delivered to <code class="docutils literal notranslate"><span class="pre">ssync_sender</span></code> where the <code class="docutils literal notranslate"><span class="pre">send_put()</span></code> method will ship them on
over.  The sender is then responsible for deleting the objects as they are sent
in the case of data reversion.</p>
</section>
</section>
<section id="the-auditor">
<h3>The Auditor<a class="headerlink" href="#the-auditor" title="Permalink to this heading">¶</a></h3>
<p>Because the auditor already operates on a per storage policy basis, there are no
specific auditor changes associated with EC.  Each EC archive looks like, and is
treated like, a regular object from the perspective of the auditor.  Therefore,
if the auditor finds bit-rot in an EC archive, it simply quarantines it and the
reconstructor will take care of the rest just as the replicator does for
replication policies.</p>
</section>
</section>
</section>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="crossdomain.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Cross-domain Policy File"></i></a>
          
          
            <a href="overview_encryption.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Object Encryption"></i></a>
          
          <a id="pdfLink2" href="" target="_blank" title="Download the manuals as PDF"><i class="fa fa-file-pdf-o" data-toggle="tooltip" data-placement="top" title="Download PDF"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">this page last updated: 2019-08-14 18:00:50</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="https://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the
                 document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="OpenStack Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/id/">Bahasa Indonesia (Indonesian)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/it/">Italiano (Italian)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/tr_TR/">Türkçe (Türkiye)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="index.html" class="docs-sidebar-section-title"><h4>Swift 0.1.0.dev10162</h4></a>
      <ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api/object_api_v1_overview.html">Object Storage API overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_architecture.html">Swift Architectural Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_ring.html">The Rings</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_policies.html">Storage Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_reaper.html">The Account Reaper</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_auth.html">The Auth System</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_acl.html">Access Control Lists (ACLs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_replication.html">Replication</a></li>
<li class="toctree-l1"><a class="reference internal" href="ratelimit.html">Rate Limiting</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_large_objects.html">Large Object Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_global_cluster.html">Global Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_container_sync.html">Container to Container Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_expiring_objects.html">Expiring Object Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="cors.html">CORS</a></li>
<li class="toctree-l1"><a class="reference internal" href="crossdomain.html">Cross-domain Policy File</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Erasure Code Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#history-and-theory-of-operation">History and Theory of Operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#performance-considerations">Performance Considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-an-erasure-code-policy">Using an Erasure Code Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#global-ec">Global EC</a></li>
<li class="toctree-l2"><a class="reference internal" href="#under-the-hood">Under the Hood</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="overview_encryption.html">Object Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_backing_store.html">Using Swift as Backing Store for Service Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_container_sharding.html">Container Sharding</a></li>
<li class="toctree-l1"><a class="reference internal" href="ring_background.html">Building a Consistent Hashing Ring</a></li>
<li class="toctree-l1"><a class="reference internal" href="ring_partpower.html">Modifying Ring Partition Power</a></li>
<li class="toctree-l1"><a class="reference internal" href="associated_projects.html">Associated Projects</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html">Contributing to OpenStack Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#swift-design-principles">Swift Design Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#recommended-workflow">Recommended workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#notes-on-testing">Notes on Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#ideas">Ideas</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#community">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/review_guidelines.html">Review Guidelines</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="development_guidelines.html">Development Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_saio.html">SAIO (Swift All In One)</a></li>
<li class="toctree-l1"><a class="reference internal" href="first_contribution_swift.html">First Contribution to Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="policies_saio.html">Adding Storage Policies to an Existing SAIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_auth.html">Auth Server and Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_middleware.html">Middleware and Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_ondisk_backends.html">Pluggable On-Disk Back-end APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_watchers.html">Auditor Watchers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="deployment_guide.html">Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_deployment_guide.html">Apache Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin_guide.html">Administrator’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="replication_network.html">Dedicated replication network</a></li>
<li class="toctree-l1"><a class="reference internal" href="logs.html">Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ops_runbook/index.html">Swift Ops Runbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin/index.html">OpenStack Swift Administrator Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="install/index.html">Object Storage Install Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="config/index.html">Configuration Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/object_api_v1_overview.html">Object Storage API overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/discoverability.html">Discoverability</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/container_quotas.html">Container quotas</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/object_versioning.html">Object versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/large_objects.html">Large objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/temporary_url_middleware.html">Temporary URL middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/form_post_middleware.html">Form POST middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/use_content-encoding_metadata.html">Use Content-Encoding metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/use_the_content-disposition_metadata.html">Use the Content-Disposition metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/pseudo-hierarchical-folders-directories.html">Pseudo-hierarchical folders and directories</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/pagination.html">Page through large lists of containers or objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/serialized-response-formats.html">Serialized response formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/static-website.html">Create static website</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/object-expiration.html">Object expiration</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/bulk-delete.html">Bulk delete</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="s3_compat.html">S3/Swift REST API Comparison Matrix</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ring.html">Partitioned Consistent Hash Ring</a></li>
<li class="toctree-l1"><a class="reference internal" href="proxy.html">Proxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="account.html">Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="container.html">Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="db.html">Account DB and Container DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="object.html">Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">Misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="middleware.html">Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="audit_watchers.html">Object Audit Watchers</a></li>
</ul>

    </div>

  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="local-table-of-contents">
      <h4 class="docs-sidebar-section-title">Page Contents</h4>
      <ul>
<li><a class="reference internal" href="#">Erasure Code Support</a><ul>
<li><a class="reference internal" href="#history-and-theory-of-operation">History and Theory of Operation</a><ul>
<li><a class="reference internal" href="#overview-of-ec-support-in-swift">Overview of EC Support in Swift</a></li>
<li><a class="reference internal" href="#pyeclib-external-erasure-code-library">PyECLib:  External Erasure Code Library</a></li>
<li><a class="reference internal" href="#storing-and-retrieving-objects">Storing and Retrieving Objects</a></li>
<li><a class="reference internal" href="#handoff-nodes">Handoff Nodes</a></li>
<li><a class="reference internal" href="#reconstruction">Reconstruction</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-considerations">Performance Considerations</a></li>
<li><a class="reference internal" href="#using-an-erasure-code-policy">Using an Erasure Code Policy</a><ul>
<li><a class="reference internal" href="#migrating-between-policies">Migrating Between Policies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#global-ec">Global EC</a><ul>
<li><a class="reference internal" href="#ec-duplication">EC Duplication</a><ul>
<li><a class="reference internal" href="#ec-duplication-with-composite-rings">EC duplication with composite rings</a></li>
<li><a class="reference internal" href="#node-selection-strategy-for-reads">Node Selection Strategy for Reads</a></li>
</ul>
</li>
<li><a class="reference internal" href="#known-issues">Known Issues</a><ul>
<li><a class="reference internal" href="#efficient-cross-region-rebuild">Efficient Cross Region Rebuild</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#under-the-hood">Under the Hood</a><ul>
<li><a class="reference internal" href="#terminology">Terminology</a></li>
<li><a class="reference internal" href="#middleware">Middleware</a></li>
<li><a class="reference internal" href="#on-disk-storage">On Disk Storage</a></li>
<li><a class="reference internal" href="#proxy-server">Proxy Server</a><ul>
<li><a class="reference internal" href="#high-level">High Level</a></li>
<li><a class="reference internal" href="#multi-phase-conversation">Multi_Phase Conversation</a></li>
<li><a class="reference internal" href="#partial-put-failures">Partial PUT Failures</a></li>
<li><a class="reference internal" href="#get">GET</a></li>
</ul>
</li>
<li><a class="reference internal" href="#object-server">Object Server</a><ul>
<li><a class="reference internal" href="#diskfile">DiskFile</a><ul>
<li><a class="reference internal" href="#metadata">Metadata</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#database-updates">Database Updates</a></li>
<li><a class="reference internal" href="#the-reconstructor">The Reconstructor</a><ul>
<li><a class="reference internal" href="#job-construction-and-processing">Job Construction and Processing</a></li>
<li><a class="reference internal" href="#node-communication">Node Communication</a></li>
<li><a class="reference internal" href="#id3">Reconstruction</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-auditor">The Auditor</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
  </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="https://openstack.org/projects/">Projects</a></li>
          <li><a href="https://www.openstack.org/software/security/">OpenStack Security</a></li>
          <li><a href="https://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="https://openstack.org/blog/">Blog</a></li>g
          <li><a href="https://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="https://openstack.org/community/">User Groups</a></li>
          <li><a href="https://openstack.org/community/events/">Events</a></li>
          <li><a href="https://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="https://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="https://docs.openstack.org/contributors">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="https://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="https://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="https://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="https://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="https://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="https://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="https://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="_static/js/jquery-3.2.1.min.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="_static/js/bootstrap.min.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="_static/js/docs.js"></script>

<!-- standard sphinx include libraries, which allow search highlighting -->
<script type="text/javascript" src="_static/underscore.js"></script>
<script type="text/javascript" src="_static/doctools.js"></script>
<script type="text/javascript" src="_static/searchtools.js"></script>
<script type="text/javascript" src="_static/language_data.js"></script>

<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:    './',
      VERSION:     '0.1.0.dev10162',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      LINK_SUFFIX: '.html',
      SOURCELINK_SUFFIX: '.txt',
      HAS_SOURCE:  true
    };
</script>

<!-- Javascript for page -->
<script language="JavaScript">
  /* Build a description of this page including SHA, source location on git
   * repo, build time and the project's launchpad bug tag. Set the HREF of the
   * bug buttons
   */
    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
    /* "giturl" is the URL of the source file on Git and is auto-generated by
     * openstackdocstheme.
     *
     * "pagename" is a standard sphinx parameter containing the name of
     * the source file, without extension.
     */

    var sourceFile = "overview_erasure_code" + ".rst";
    gitURL = "Source: https://opendev.org/openstack/swift/src/doc/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: c25d961319e59efe02c05374924ba82b873992e1";
    var repositoryName = "openstack/swift";
    var bugProject = "swift";
    var bugTitle = "Erasure Code Support in Swift";
    var fieldTags = "";
    var useStoryboard = "";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 0.1.0.dev10162 on 2019-08-14 18:00:50";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags, repositoryName, useStoryboard);
    var currentSourceFile = "overview_erasure_code";
    var pdfFileName = "doc-swift.pdf";
    pdfLink(currentSourceFile, pdfFileName);
</script>


  </body>
</html>