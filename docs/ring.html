
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Partitioned Consistent Hash Ring &#8212; Swift 0.1.0.dev9981 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/basic.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="canonical" href="/swift/ring.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Proxy" href="proxy.html" />
    <link rel="prev" title="S3/Swift REST API Comparison Matrix" href="s3_compat.html" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Bootstrap CSS -->
<link href="_static/css/bootstrap.min.css" rel="stylesheet">

<!-- Fonts -->
<link href="_static/css/font-awesome.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="_static/css/combined.css" rel="stylesheet">

<!-- Search CSS -->
<link href="_static/css/search.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="_static/pygments.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->


  </head><body>

<!-- SOURCE_FILE: https://opendev.org/openstack/swift/src/doc/source/ring.rst -->

<script>
    (function (window, document) {
        var loader = function () {
            var script = document.createElement("script"), tag = document.getElementsByTagName("script")[0];
            script.src = "https://search.openstack.org/widget/embed.min.js?t="+Date.now();
            tag.parentNode.insertBefore(script, tag);
        };
        window.addEventListener ? window.addEventListener("load", loader, false) : window.attachEvent("onload", loader);
    })(window, document);
</script>

<nav class="navbar navbar-default" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="https://www.openstack.org/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
    <div class="openstack-search-bar" data-baseUrl="search.openstack.org" data-context="docs-openstack"></div>
</div>
      <ul class="nav navbar-nav navbar-main show">
        <li class="search-container-mobile">
    <div class="openstack-search-bar" data-baseUrl="search.openstack.org" data-context="docs-openstack"></div>
</li>
        <li> <!--Software -->
          <a href="https://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/openstack-components">OpenStack Components</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/sdks">SDKs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/deployment-tools">Deployment Tools</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/assets/software/projectmap/openstack-map.pdf" target="_blank">OpenStack Map</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
          </ul>
        </li>
        <li> <!-- Use Cases -->
          <a href="https://www.openstack.org/use-cases/" class="drop" id="dropdownMenuUsers">Use Cases <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/">Users in Production</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/bare-metal/">Ironic Bare Metal</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/edge-computing/">Edge Computing</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/telecoms-and-nfv/">Telecom & NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/science/">Science and HPC</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/containers/">Containers</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/enterprise/">Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li> <!-- Events -->
          <a href="https://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">Open Infrastructure Summits</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/ptg/">Project Teams Gathering</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/opendev-2020/">OpenDev</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/community-events/">Community Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/openstackdays">OpenStack & OpenInfra Days</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
          </ul>
        </li>
        <li><!-- Community -->
          <a href="https://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/tech-committee">OpenStack Technical Committee</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/coa/">Get Certified (COA)</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketing/">Marketing Resources</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/news/">Community News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/supporting-organizations/">OpenInfra Foundation Supporting Organizations</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev">Open Infrastructure Foundation (OpenInfra Foundation)</a></li>
          </ul>
        </li>
        <li><!-- Marketplace -->
          <a href="https://www.openstack.orgmarketplace/" class="drop" id="dropdownMenuLearn">Marketplace <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/distros/">Distros & Appliances</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/public-clouds/">Public Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/hosted-private-clouds/">Hosted Private Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/remotely-managed-private-clouds/">Remotely Managed Private Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/consulting/">Consulting & Integrators</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/drivers/">Drivers</a></li>
          </ul>
        </li>
        <li><!-- Blog -->
          <a href="https://www.openstack.org/blog/">Blog</a>
        </li>
        <li><!-- Docs -->
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
        <li> <!-- Join -->
            <li class="join-nav-section">
              <a href="https://openinfra.dev/join/" id="dropdownMenuJoin">Join <i class="fa fa-caret-down"></i></a>
              <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuJoin" style="display: none;">
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev/join/">Sign up for Foundation Membership</a></li>
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev/join/">Sponsor the Foundation</a></li>
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev">More about the Foundation</a></li>
              </ul>
            </li>
            <li>
              <a href="https://www.openstack.org/Security/login/?BackURL=/home/" class="sign-in-btn">Log In</a>
            </li>
        </li>
      </ul>
    </div>
  </div>
  <!-- /.container -->
</nav>

    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row docs-title">
  <div class="col-lg-8">
      <h1>Partitioned Consistent Hash Ring</h1>
    
  </div>
  <div class="docs-actions">
    
    <a href="s3_compat.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: S3/Swift REST API Comparison Matrix"></i></a>
    
    
    <a href="proxy.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Proxy"></i></a>
    
    <a id="pdfLink1" href="" target="_blank" title="Download the manuals as PDF"><i class="fa fa-file-pdf-o" data-toggle="tooltip" data-placement="top" title="Download PDF"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
    
  </div>
</div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-body" role="main">

  <section id="partitioned-consistent-hash-ring">
<span id="consistent-hashing-ring"></span><h1>Partitioned Consistent Hash Ring<a class="headerlink" href="#partitioned-consistent-hash-ring" title="Permalink to this heading">¶</a></h1>
<section id="ring">
<span id="id1"></span><h2>Ring<a class="headerlink" href="#ring" title="Permalink to this heading">¶</a></h2>
<span class="target" id="module-swift.common.ring.ring"></span><dl class="py class">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.common.ring.ring.</span></span><span class="sig-name descname"><span class="pre">Ring</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">serialized_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reload_time=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ring_name=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_hook=&lt;function</span> <span class="pre">Ring.&lt;lambda&gt;&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.Ring" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Partitioned consistent hashing ring.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>serialized_path</strong> – path to serialized RingData instance</p></li>
<li><p><strong>reload_time</strong> – time interval in seconds to check for a ring change</p></li>
<li><p><strong>ring_name</strong> – ring name string (basically specified from policy)</p></li>
<li><p><strong>validation_hook</strong> – hook point to validate ring configuration ontime</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="misc.html#swift.common.exceptions.RingLoadError" title="swift.common.exceptions.RingLoadError"><strong>RingLoadError</strong></a> – if the loaded ring data violates its constraint</p>
</dd>
</dl>
<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring.assigned_device_count">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">assigned_device_count</span></span><a class="headerlink" href="#swift.common.ring.ring.Ring.assigned_device_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of devices with assignments in the ring.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring.device_count">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">device_count</span></span><a class="headerlink" href="#swift.common.ring.ring.Ring.device_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of devices in the ring.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring.devs">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">devs</span></span><a class="headerlink" href="#swift.common.ring.ring.Ring.devs" title="Permalink to this definition">¶</a></dt>
<dd><p>devices in the ring</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring.get_more_nodes">
<span class="sig-name descname"><span class="pre">get_more_nodes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">part</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.Ring.get_more_nodes" title="Permalink to this definition">¶</a></dt>
<dd><p>Generator to get extra nodes for a partition for hinted handoff.</p>
<p>The handoff nodes will try to be in zones other than the
primary zones, will take into account the device weights, and
will usually keep the same sequences of handoffs even with
ring changes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>part</strong> – partition to get handoff nodes for</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>generator of node dicts</p>
</dd>
</dl>
<p>See <a class="reference internal" href="#swift.common.ring.ring.Ring.get_nodes" title="swift.common.ring.ring.Ring.get_nodes"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_nodes()</span></code></a> for a description of the node dicts.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring.get_nodes">
<span class="sig-name descname"><span class="pre">get_nodes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">account</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">container</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.Ring.get_nodes" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the partition and nodes for an account/container/object.
If a node is responsible for more than one replica, it will
only appear in the output once.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>account</strong> – account name</p></li>
<li><p><strong>container</strong> – container name</p></li>
<li><p><strong>obj</strong> – object name</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a tuple of (partition, list of node dicts)</p>
</dd>
</dl>
<p>Each node dict will have at least the following keys:</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>id</p></td>
<td><p>unique integer identifier amongst devices</p></td>
</tr>
<tr class="row-even"><td><p>index</p></td>
<td><p>offset into the primary node list for the partition</p></td>
</tr>
<tr class="row-odd"><td><p>weight</p></td>
<td><p>a float of the relative weight of this device as compared to
others; this indicates how many partitions the builder will try
to assign to this device</p></td>
</tr>
<tr class="row-even"><td><p>zone</p></td>
<td><p>integer indicating which zone the device is in; a given
partition will not be assigned to multiple devices within the
same zone</p></td>
</tr>
<tr class="row-odd"><td><p>ip</p></td>
<td><p>the ip address of the device</p></td>
</tr>
<tr class="row-even"><td><p>port</p></td>
<td><p>the tcp port of the device</p></td>
</tr>
<tr class="row-odd"><td><p>device</p></td>
<td><p>the device’s name on disk (sdb1, for example)</p></td>
</tr>
<tr class="row-even"><td><p>meta</p></td>
<td><p>general use ‘extra’ field; for example: the online date, the
hardware description</p></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring.get_part">
<span class="sig-name descname"><span class="pre">get_part</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">account</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">container</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.Ring.get_part" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the partition for an account/container/object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>account</strong> – account name</p></li>
<li><p><strong>container</strong> – container name</p></li>
<li><p><strong>obj</strong> – object name</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the partition number</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring.get_part_nodes">
<span class="sig-name descname"><span class="pre">get_part_nodes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">part</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.Ring.get_part_nodes" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the nodes that are responsible for the partition. If one
node is responsible for more than one replica of the same
partition, it will only appear in the output once.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>part</strong> – partition to get nodes for</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>list of node dicts</p>
</dd>
</dl>
<p>See <a class="reference internal" href="#swift.common.ring.ring.Ring.get_nodes" title="swift.common.ring.ring.Ring.get_nodes"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_nodes()</span></code></a> for a description of the node dicts.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring.has_changed">
<span class="sig-name descname"><span class="pre">has_changed</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.Ring.has_changed" title="Permalink to this definition">¶</a></dt>
<dd><p>Check to see if the ring on disk is different than the current one in
memory.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>True if the ring on disk has changed, False otherwise</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring.md5">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">md5</span></span><a class="headerlink" href="#swift.common.ring.ring.Ring.md5" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring.next_part_power">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">next_part_power</span></span><a class="headerlink" href="#swift.common.ring.ring.Ring.next_part_power" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring.part_power">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">part_power</span></span><a class="headerlink" href="#swift.common.ring.ring.Ring.part_power" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring.partition_count">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">partition_count</span></span><a class="headerlink" href="#swift.common.ring.ring.Ring.partition_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of partitions in the ring.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring.raw_size">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">raw_size</span></span><a class="headerlink" href="#swift.common.ring.ring.Ring.raw_size" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring.replica_count">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">replica_count</span></span><a class="headerlink" href="#swift.common.ring.ring.Ring.replica_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of replicas (full or partial) used in the ring.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring.size">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">size</span></span><a class="headerlink" href="#swift.common.ring.ring.Ring.size" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring.version">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">version</span></span><a class="headerlink" href="#swift.common.ring.ring.Ring.version" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.ring.Ring.weighted_device_count">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weighted_device_count</span></span><a class="headerlink" href="#swift.common.ring.ring.Ring.weighted_device_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of devices with weight in the ring.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="swift.common.ring.ring.RingData">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.common.ring.ring.</span></span><span class="sig-name descname"><span class="pre">RingData</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">replica2part2dev_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">devs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">part_shift</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">next_part_power</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">version</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.RingData" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Partitioned consistent hashing ring data (used for serialization).</p>
<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.ring.RingData.deserialize_v1">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">deserialize_v1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gz_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.RingData.deserialize_v1" title="Permalink to this definition">¶</a></dt>
<dd><p>Deserialize a v1 ring file into a dictionary with <cite>devs</cite>, <cite>part_shift</cite>,
and <cite>replica2part2dev_id</cite> keys.</p>
<p>If the optional kwarg <cite>metadata_only</cite> is True, then the
<cite>replica2part2dev_id</cite> is not loaded and that key in the returned
dictionary just has the value <cite>[]</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gz_file</strong> (<em>file</em>) – An opened file-like object which has already
consumed the 6 bytes of magic and version.</p></li>
<li><p><strong>metadata_only</strong> (<em>bool</em>) – If True, only load <cite>devs</cite> and <cite>part_shift</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dict containing <cite>devs</cite>, <cite>part_shift</cite>, and
<cite>replica2part2dev_id</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.ring.RingData.load">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.RingData.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Load ring data from a file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – Path to a file serialized by the save() method.</p></li>
<li><p><strong>metadata_only</strong> (<em>bool</em>) – If True, only load <cite>devs</cite> and <cite>part_shift</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A RingData instance containing the loaded data.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.ring.RingData.replica_count">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">replica_count</span></span><a class="headerlink" href="#swift.common.ring.ring.RingData.replica_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of replicas (full or partial) used in the ring.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.ring.RingData.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mtime</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1300507380.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.RingData.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Serialize this RingData instance to disk.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – File into which this instance should be serialized.</p></li>
<li><p><strong>mtime</strong> – time used to override mtime for gzip, default or None
if the caller wants to include time</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.ring.RingData.serialize_v1">
<span class="sig-name descname"><span class="pre">serialize_v1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_obj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.RingData.serialize_v1" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.ring.RingData.to_dict">
<span class="sig-name descname"><span class="pre">to_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.RingData.to_dict" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="swift.common.ring.ring.RingReader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.common.ring.ring.</span></span><span class="sig-name descname"><span class="pre">RingReader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.RingReader" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="swift.common.ring.ring.RingReader.chunk_size">
<span class="sig-name descname"><span class="pre">chunk_size</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">65536</span></em><a class="headerlink" href="#swift.common.ring.ring.RingReader.chunk_size" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.ring.RingReader.close">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">close</span></span><a class="headerlink" href="#swift.common.ring.ring.RingReader.close" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.ring.RingReader.md5">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">md5</span></span><a class="headerlink" href="#swift.common.ring.ring.RingReader.md5" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.ring.RingReader.read">
<span class="sig-name descname"><span class="pre">read</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">amount</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.RingReader.read" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.ring.RingReader.readinto">
<span class="sig-name descname"><span class="pre">readinto</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buffer</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.RingReader.readinto" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.ring.RingReader.readline">
<span class="sig-name descname"><span class="pre">readline</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.RingReader.readline" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.ring.RingReader.seek">
<span class="sig-name descname"><span class="pre">seek</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.RingReader.seek" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="swift.common.ring.ring.calc_replica_count">
<span class="sig-prename descclassname"><span class="pre">swift.common.ring.ring.</span></span><span class="sig-name descname"><span class="pre">calc_replica_count</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">replica2part2dev_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.ring.calc_replica_count" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-swift.common.ring.builder">
<span id="id2"></span><span id="ring-builder"></span><h2>Ring Builder<a class="headerlink" href="#module-swift.common.ring.builder" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.common.ring.builder.</span></span><span class="sig-name descname"><span class="pre">RingBuilder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">part_power</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replicas</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_part_hours</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Used to build swift.common.ring.RingData instances to be written to disk
and used with swift.common.ring.Ring instances. See bin/swift-ring-builder
for example usage.</p>
<p>The instance variable devs_changed indicates if the device information has
changed since the last balancing. This can be used by tools to know whether
a rebalance request is an isolated request or due to added, changed, or
removed devices.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>part_power</strong> – number of partitions = 2**part_power.</p></li>
<li><p><strong>replicas</strong> – number of replicas for each partition</p></li>
<li><p><strong>min_part_hours</strong> – minimum number of hours between partition changes</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.add_dev">
<span class="sig-name descname"><span class="pre">add_dev</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dev</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.add_dev" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a device to the ring. This device dict should have a minimum of the
following keys:</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>id</p></td>
<td><p>unique integer identifier amongst devices. Defaults to the next
id if the ‘id’ key is not provided in the dict</p></td>
</tr>
<tr class="row-even"><td><p>weight</p></td>
<td><p>a float of the relative weight of this device as compared to
others; this indicates how many partitions the builder will try
to assign to this device</p></td>
</tr>
<tr class="row-odd"><td><p>region</p></td>
<td><p>integer indicating which region the device is in</p></td>
</tr>
<tr class="row-even"><td><p>zone</p></td>
<td><p>integer indicating which zone the device is in; a given
partition will not be assigned to multiple devices within the
same (region, zone) pair if there is any alternative</p></td>
</tr>
<tr class="row-odd"><td><p>ip</p></td>
<td><p>the ip address of the device</p></td>
</tr>
<tr class="row-even"><td><p>port</p></td>
<td><p>the tcp port of the device</p></td>
</tr>
<tr class="row-odd"><td><p>device</p></td>
<td><p>the device’s name on disk (sdb1, for example)</p></td>
</tr>
<tr class="row-even"><td><p>meta</p></td>
<td><p>general use ‘extra’ field; for example: the online date, the
hardware description</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This will not rebalance the ring immediately as you may want to
make multiple changes for a single rebalance.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dev</strong> – device dict</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>id of device (not used in the tree anymore, but unknown
users may depend on it)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.cancel_increase_partition_power">
<span class="sig-name descname"><span class="pre">cancel_increase_partition_power</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.cancel_increase_partition_power" title="Permalink to this definition">¶</a></dt>
<dd><p>Cancels a ring partition power increasement.</p>
<p>This sets the next_part_power to the current part_power. Object
replicators will still skip replication, and a cleanup is still
required. Finally, a finish_increase_partition_power needs to be run.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>False if next_part_power was not set or is equal to current
part_power, otherwise True.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.change_min_part_hours">
<span class="sig-name descname"><span class="pre">change_min_part_hours</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">min_part_hours</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.change_min_part_hours" title="Permalink to this definition">¶</a></dt>
<dd><p>Changes the value used to decide if a given partition can be moved
again. This restriction is to give the overall system enough time to
settle a partition to its new location before moving it to yet another
location. While no data would be lost if a partition is moved several
times quickly, it could make that data unreachable for a short period
of time.</p>
<p>This should be set to at least the average full partition replication
time. Starting it at 24 hours and then lowering it to what the
replicator reports as the longest partition cycle is best.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>min_part_hours</strong> – new value for min_part_hours</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.copy_from">
<span class="sig-name descname"><span class="pre">copy_from</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">builder</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.copy_from" title="Permalink to this definition">¶</a></dt>
<dd><p>Reinitializes this RingBuilder instance from data obtained from the
builder dict given. Code example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">RingBuilder</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Dummy values</span>
<span class="n">b</span><span class="o">.</span><span class="n">copy_from</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>
</pre></div>
</div>
<p>This is to restore a RingBuilder that has had its b.to_dict()
previously saved.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.debug">
<span class="sig-name descname"><span class="pre">debug</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.debug" title="Permalink to this definition">¶</a></dt>
<dd><p>Temporarily enables debug logging, useful in tests, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">rb</span><span class="o">.</span><span class="n">debug</span><span class="p">():</span>
    <span class="n">rb</span><span class="o">.</span><span class="n">rebalance</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.ever_rebalanced">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">ever_rebalanced</span></span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.ever_rebalanced" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.finish_increase_partition_power">
<span class="sig-name descname"><span class="pre">finish_increase_partition_power</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.finish_increase_partition_power" title="Permalink to this definition">¶</a></dt>
<dd><p>Finish the partition power increase.</p>
<p>The hard links from the old object locations should be removed by now.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.from_dict">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">builder_data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.from_dict" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.get_balance">
<span class="sig-name descname"><span class="pre">get_balance</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.get_balance" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the balance of the ring. The balance value is the highest
percentage of the desired amount of partitions a given device
wants. For instance, if the “worst” device wants (based on its
weight relative to the sum of all the devices’ weights) 123
partitions and it has 124 partitions, the balance value would
be 0.83 (1 extra / 123 wanted * 100 for percentage).</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>balance of the ring</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.get_part_devices">
<span class="sig-name descname"><span class="pre">get_part_devices</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">part</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.get_part_devices" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the devices that are responsible for the partition,
filtering out duplicates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>part</strong> – partition to get devices for</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>list of device dicts</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.get_required_overload">
<span class="sig-name descname"><span class="pre">get_required_overload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">weighted</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wanted</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.get_required_overload" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the minimum overload value required to make the ring maximally
dispersed.</p>
<p>The required overload is the largest percentage change of any single
device from its weighted replicanth to its wanted replicanth (note:
under weighted devices have a negative percentage change) to archive
dispersion - that is to say a single device that must be overloaded by
5% is worse than 5 devices in a single tier overloaded by 1%.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.get_ring">
<span class="sig-name descname"><span class="pre">get_ring</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.get_ring" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the ring, or more specifically, the swift.common.ring.RingData.
This ring data is the minimum required for use of the ring. The ring
builder itself keeps additional data such as when partitions were last
moved.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.id">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">id</span></span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.id" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.increase_partition_power">
<span class="sig-name descname"><span class="pre">increase_partition_power</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.increase_partition_power" title="Permalink to this definition">¶</a></dt>
<dd><p>Increases ring partition power by one.</p>
<p>Devices will be assigned to partitions like this:</p>
<p>OLD: 0, 3, 7, 5, 2, 1, …
NEW: 0, 0, 3, 3, 7, 7, 5, 5, 2, 2, 1, 1, …</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>False if next_part_power was not set or is equal to current
part_power, None if something went wrong, otherwise True.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.load">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">builder_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">open=&lt;built-in</span> <span class="pre">function</span> <span class="pre">open&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Obtain RingBuilder instance of the provided builder file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>builder_file</strong> – path to builder file to load</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>RingBuilder instance</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.min_part_seconds_left">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">min_part_seconds_left</span></span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.min_part_seconds_left" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the total seconds until a rebalance can be performed</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.part_shift">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">part_shift</span></span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.part_shift" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.prepare_increase_partition_power">
<span class="sig-name descname"><span class="pre">prepare_increase_partition_power</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.prepare_increase_partition_power" title="Permalink to this definition">¶</a></dt>
<dd><p>Prepares a ring for partition power increase.</p>
<p>This makes it possible to compute the future location of any object
based on the next partition power.</p>
<p>In this phase object servers should create hard links when finalizing a
write to the new location as well. A relinker will be run after
restarting object-servers, creating hard links to all existing objects
in their future location.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>False if next_part_power was not set, otherwise True.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.pretend_min_part_hours_passed">
<span class="sig-name descname"><span class="pre">pretend_min_part_hours_passed</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.pretend_min_part_hours_passed" title="Permalink to this definition">¶</a></dt>
<dd><p>Override min_part_hours by marking all partitions as having been moved
255 hours ago and last move epoch to ‘the beginning of time’. This can
be used to force a full rebalance on the next call to rebalance.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.rebalance">
<span class="sig-name descname"><span class="pre">rebalance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.rebalance" title="Permalink to this definition">¶</a></dt>
<dd><p>Rebalance the ring.</p>
<p>This is the main work function of the builder, as it will assign and
reassign partitions to devices in the ring based on weights, distinct
zones, recent reassignments, etc.</p>
<p>The process doesn’t always perfectly assign partitions (that’d take a
lot more analysis and therefore a lot more time – I had code that did
that before). Because of this, it keeps rebalancing until the device
skew (number of partitions a device wants compared to what it has) gets
below 1% or doesn’t change by more than 1% (only happens with a ring
that can’t be balanced no matter what).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>seed</strong> – a value for the random seed (optional)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>(number_of_partitions_altered, resulting_balance,
number_of_removed_devices)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.remove_dev">
<span class="sig-name descname"><span class="pre">remove_dev</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dev_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.remove_dev" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a device from the ring.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This will not rebalance the ring immediately as you may want to
make multiple changes for a single rebalance.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dev_id</strong> – device id</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">builder_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Serialize this RingBuilder instance to disk.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>builder_file</strong> – path to builder file to save</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.search_devs">
<span class="sig-name descname"><span class="pre">search_devs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">search_values</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.search_devs" title="Permalink to this definition">¶</a></dt>
<dd><p>Search devices by parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>search_values</strong> – a dictionary with search values to filter
devices, supported parameters are id,
region, zone, ip, port, replication_ip,
replication_port, device, weight, meta</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>list of device dicts</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.set_dev_region">
<span class="sig-name descname"><span class="pre">set_dev_region</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dev_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">region</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.set_dev_region" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the region of a device. This should be called rather than just
altering the region key in the device dict directly, as the builder
will need to rebuild some internal state to reflect the change.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This will not rebalance the ring immediately as you may want to
make multiple changes for a single rebalance.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dev_id</strong> – device id</p></li>
<li><p><strong>region</strong> – new region for device</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.set_dev_weight">
<span class="sig-name descname"><span class="pre">set_dev_weight</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dev_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.set_dev_weight" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the weight of a device. This should be called rather than just
altering the weight key in the device dict directly, as the builder
will need to rebuild some internal state to reflect the change.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This will not rebalance the ring immediately as you may want to
make multiple changes for a single rebalance.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dev_id</strong> – device id</p></li>
<li><p><strong>weight</strong> – new weight for device</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.set_dev_zone">
<span class="sig-name descname"><span class="pre">set_dev_zone</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dev_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zone</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.set_dev_zone" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the zone of a device. This should be called rather than just
altering the zone key in the device dict directly, as the builder
will need to rebuild some internal state to reflect the change.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This will not rebalance the ring immediately as you may want to
make multiple changes for a single rebalance.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dev_id</strong> – device id</p></li>
<li><p><strong>zone</strong> – new zone for device</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.set_overload">
<span class="sig-name descname"><span class="pre">set_overload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">overload</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.set_overload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.set_replicas">
<span class="sig-name descname"><span class="pre">set_replicas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_replica_count</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.set_replicas" title="Permalink to this definition">¶</a></dt>
<dd><p>Changes the number of replicas in this ring.</p>
<p>If the new replica count is sufficiently different that
self._replica2part2dev will change size, sets
self.devs_changed. This is so tools like
bin/swift-ring-builder can know to write out the new ring
rather than bailing out due to lack of balance change.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.to_dict">
<span class="sig-name descname"><span class="pre">to_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.to_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dict that can be used later with copy_from to
restore a RingBuilder. swift-ring-builder uses this to
pickle.dump the dict to a file and later load that dict into
copy_from.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.validate">
<span class="sig-name descname"><span class="pre">validate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stats</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.validate" title="Permalink to this definition">¶</a></dt>
<dd><p>Validate the ring.</p>
<p>This is a safety function to try to catch any bugs in the building
process. It ensures partitions have been assigned to real devices,
aren’t doubly assigned, etc. It can also optionally check the even
distribution of partitions across devices.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>stats</strong> – if True, check distribution of partitions across devices</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>if stats is True, a tuple of (device_usage, worst_stat), else
(None, None). device_usage[dev_id] will equal the number of
partitions assigned to that device. worst_stat will equal the
number of partitions the worst device is skewed from the
number it should have.</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="misc.html#swift.common.exceptions.RingValidationError" title="swift.common.exceptions.RingValidationError"><strong>RingValidationError</strong></a> – problem was found with the ring.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingBuilder.weight_of_one_part">
<span class="sig-name descname"><span class="pre">weight_of_one_part</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.builder.RingBuilder.weight_of_one_part" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the weight of each partition as calculated from the
total weight of all the devices.</p>
</dd></dl>

</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="swift.common.ring.builder.RingValidationWarning">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.common.ring.builder.</span></span><span class="sig-name descname"><span class="pre">RingValidationWarning</span></span><a class="headerlink" href="#swift.common.ring.builder.RingValidationWarning" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Warning</span></code></p>
</dd></dl>

</section>
<section id="module-swift.common.ring.composite_builder">
<span id="composite-ring-builder"></span><span id="composite-builder"></span><h2>Composite Ring Builder<a class="headerlink" href="#module-swift.common.ring.composite_builder" title="Permalink to this heading">¶</a></h2>
<p>A standard ring built using the <a class="reference internal" href="overview_ring.html#ring-builder"><span class="std std-ref">ring-builder</span></a> will attempt
to randomly disperse replicas or erasure-coded fragments across failure
domains, but does not provide any guarantees such as placing at least one
replica of every partition into each region. Composite rings are intended to
provide operators with greater control over the dispersion of object replicas
or fragments across a cluster, in particular when there is a desire to
have strict guarantees that some replicas or fragments are placed in certain
failure domains. This is particularly important for policies with duplicated
erasure-coded fragments.</p>
<p>A composite ring comprises two or more component rings that are combined to
form a single ring with a replica count equal to the sum of replica counts
from the component rings. The component rings are built independently, using
distinct devices in distinct regions, which means that the dispersion of
replicas between the components can be guaranteed. The <code class="docutils literal notranslate"><span class="pre">composite_builder</span></code>
utilities may then be used to combine components into a composite ring.</p>
<p>For example, consider a normal ring <code class="docutils literal notranslate"><span class="pre">ring0</span></code> with replica count of 4 and
devices in two regions <code class="docutils literal notranslate"><span class="pre">r1</span></code> and <code class="docutils literal notranslate"><span class="pre">r2</span></code>. Despite the best efforts of the
ring-builder, it is possible for there to be three replicas of a particular
partition placed in one region and only one replica placed in the other region.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">part_n</span> <span class="o">-&gt;</span> <span class="n">r1z1h110</span><span class="o">/</span><span class="n">sdb</span> <span class="n">r1z2h12</span><span class="o">/</span><span class="n">sdb</span> <span class="n">r1z3h13</span><span class="o">/</span><span class="n">sdb</span> <span class="n">r2z1h21</span><span class="o">/</span><span class="n">sdb</span>
</pre></div>
</div>
<p>Now consider two normal rings each with replica count of 2: <code class="docutils literal notranslate"><span class="pre">ring1</span></code> has
devices in only <code class="docutils literal notranslate"><span class="pre">r1</span></code>; <code class="docutils literal notranslate"><span class="pre">ring2</span></code> has devices in only <code class="docutils literal notranslate"><span class="pre">r2</span></code>.
When these rings are combined into a composite ring then every partition is
guaranteed to be mapped to two devices in each of <code class="docutils literal notranslate"><span class="pre">r1</span></code> and <code class="docutils literal notranslate"><span class="pre">r2</span></code>, for
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">part_n</span> <span class="o">-&gt;</span> <span class="n">r1z1h10</span><span class="o">/</span><span class="n">sdb</span> <span class="n">r1z2h20</span><span class="o">/</span><span class="n">sdb</span>  <span class="n">r2z1h21</span><span class="o">/</span><span class="n">sdb</span> <span class="n">r2z2h22</span><span class="o">/</span><span class="n">sdb</span>
          <span class="o">|</span><span class="n">_____________________</span><span class="o">|</span>  <span class="o">|</span><span class="n">_____________________</span><span class="o">|</span>
                     <span class="o">|</span>                        <span class="o">|</span>
                   <span class="n">ring1</span>                    <span class="n">ring2</span>
</pre></div>
</div>
<p>The dispersion of partition replicas across failure domains within each of the
two component rings may change as they are modified and rebalanced, but the
dispersion of replicas between the two regions is guaranteed by the use of a
composite ring.</p>
<p>For rings to be formed into a composite they must satisfy the following
requirements:</p>
<ul class="simple">
<li><p>All component rings must have the same part power (and therefore number of
partitions)</p></li>
<li><p>All component rings must have an integer replica count</p></li>
<li><p>Each region may only be used in one component ring</p></li>
<li><p>Each device may only be used in one component ring</p></li>
</ul>
<p>Under the hood, the composite ring has a <code class="docutils literal notranslate"><span class="pre">_replica2part2dev_id</span></code> table that is
the union of the tables from the component rings. Whenever the component rings
are rebalanced, the composite ring must be rebuilt. There is no dynamic
rebuilding of the composite ring.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The order in which component rings are combined into a composite ring is
very significant because it determines the order in which the
Ring.get_part_nodes() method will provide primary nodes for the composite
ring and consequently the node indexes assigned to the primary nodes. For
an erasure-coded policy, inadvertent changes to the primary node indexes
could result in large amounts of data movement due to fragments being moved
to their new correct primary.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">id</span></code> of each component RingBuilder is therefore stored in metadata of
the composite and used to check for the component ordering when the same
composite ring is re-composed. RingBuilder <code class="docutils literal notranslate"><span class="pre">id</span></code>s are normally assigned
when a RingBuilder instance is first saved. Older RingBuilder instances
loaded from file may not have an <code class="docutils literal notranslate"><span class="pre">id</span></code> assigned and will need to be saved
before they can be used as components of a composite ring. This can be
achieved by, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">swift</span><span class="o">-</span><span class="n">ring</span><span class="o">-</span><span class="n">builder</span> <span class="o">&lt;</span><span class="n">builder</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="n">rebalance</span> <span class="o">--</span><span class="n">force</span>
</pre></div>
</div>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.CompositeRingBuilder">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.common.ring.composite_builder.</span></span><span class="sig-name descname"><span class="pre">CompositeRingBuilder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">builder_files</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.CompositeRingBuilder" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Provides facility to create, persist, load, rebalance  and update composite
rings, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a CompositeRingBuilder instance with a list of</span>
<span class="c1"># component builder files</span>
<span class="n">crb</span> <span class="o">=</span> <span class="n">CompositeRingBuilder</span><span class="p">([</span><span class="s2">&quot;region1.builder&quot;</span><span class="p">,</span> <span class="s2">&quot;region2.builder&quot;</span><span class="p">])</span>

<span class="c1"># perform a cooperative rebalance of the component builders</span>
<span class="n">crb</span><span class="o">.</span><span class="n">rebalance</span><span class="p">()</span>

<span class="c1"># call compose which will make a new RingData instance</span>
<span class="n">ring_data</span> <span class="o">=</span> <span class="n">crb</span><span class="o">.</span><span class="n">compose</span><span class="p">()</span>

<span class="c1"># save the composite ring file</span>
<span class="n">ring_data</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;composite_ring.gz&quot;</span><span class="p">)</span>

<span class="c1"># save the composite metadata file</span>
<span class="n">crb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;composite_builder.composite&quot;</span><span class="p">)</span>

<span class="c1"># load the persisted composite metadata file</span>
<span class="n">crb</span> <span class="o">=</span> <span class="n">CompositeRingBuilder</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;composite_builder.composite&quot;</span><span class="p">)</span>

<span class="c1"># compose (optionally update the paths to the component builder files)</span>
<span class="n">crb</span><span class="o">.</span><span class="n">compose</span><span class="p">([</span><span class="s2">&quot;/path/to/region1.builder&quot;</span><span class="p">,</span> <span class="s2">&quot;/path/to/region2.builder&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Composite ring metadata is persisted to file in JSON format. The metadata
has the structure shown below (using example values):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
  <span class="s2">&quot;components&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;8e56f3b692d43d9a666440a3d945a03a&quot;</span><span class="p">,</span>
      <span class="s2">&quot;replicas&quot;</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;96085923c2b644999dbfd74664f4301b&quot;</span><span class="p">,</span>
      <span class="s2">&quot;replicas&quot;</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">]</span>
  <span class="s2">&quot;component_builder_files&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;8e56f3b692d43d9a666440a3d945a03a&quot;</span><span class="p">:</span> <span class="s2">&quot;/etc/swift/region1.builder&quot;</span><span class="p">,</span>
      <span class="s2">&quot;96085923c2b644999dbfd74664f4301b&quot;</span><span class="p">:</span> <span class="s2">&quot;/etc/swift/region2.builder&quot;</span><span class="p">,</span>
  <span class="p">}</span>
  <span class="s2">&quot;serialization_version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">&quot;saved_path&quot;</span><span class="p">:</span> <span class="s2">&quot;/etc/swift/multi-ring-1.composite&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p><cite>version</cite> is an integer representing the current version of the composite
ring, which increments each time the ring is successfully (re)composed.</p>
<p><cite>components</cite> is a list of dicts, each of which describes relevant
properties of a component ring</p>
<p><cite>component_builder_files</cite> is a dict that maps component ring builder ids to
the file from which that component ring builder was loaded.</p>
<p><cite>serialization_version</cite> is an integer constant.</p>
<p><cite>saved_path</cite> is the path to which the metadata was written.</p>
<dl class="field-list simple">
<dt class="field-odd">Params builder_files<span class="colon">:</span></dt>
<dd class="field-odd"><p>a list of paths to builder files that will be used
as components of the composite ring.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.CompositeRingBuilder.can_part_move">
<span class="sig-name descname"><span class="pre">can_part_move</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">part</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.CompositeRingBuilder.can_part_move" title="Permalink to this definition">¶</a></dt>
<dd><p>Check with all component builders that it is ok to move a partition.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>part</strong> – The partition to check.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if all component builders agree that the partition can be
moved, False otherwise.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.CompositeRingBuilder.compose">
<span class="sig-name descname"><span class="pre">compose</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">builder_files</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">require_modified</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.CompositeRingBuilder.compose" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds a composite ring using component ring builders loaded from a
list of builder files and updates composite ring metadata.</p>
<p>If a list of component ring builder files is given then that will be
used to load component ring builders. Otherwise, component ring
builders will be loaded using the list of builder files that was set
when the instance was constructed.</p>
<p>In either case, if metadata for an existing composite ring has been
loaded then the component ring builders are verified for consistency
with the existing composition of builders, unless the optional
<code class="docutils literal notranslate"><span class="pre">force</span></code> flag if set True.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>builder_files</strong> – Optional list of paths to ring builder
files that will be used to load the component ring builders.
Typically the list of component builder files will have been set
when the instance was constructed, for example when using the
load() class method. However, this parameter may be used if the
component builder file paths have moved, or, in conjunction with
the <code class="docutils literal notranslate"><span class="pre">force</span></code> parameter, if a new list of component builders is to
be used.</p></li>
<li><p><strong>force</strong> – if True then do not verify given builders are
consistent with any existing composite ring (default is False).</p></li>
<li><p><strong>require_modified</strong> – if True and <code class="docutils literal notranslate"><span class="pre">force</span></code> is False, then
verify that at least one of the given builders has been modified
since the composite ring was last built (default is False).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>An instance of <a class="reference internal" href="#swift.common.ring.ring.RingData" title="swift.common.ring.ring.RingData"><code class="xref py py-class docutils literal notranslate"><span class="pre">swift.common.ring.ring.RingData</span></code></a></p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p>ValueError if the component ring builders are not suitable for
composing with each other, or are inconsistent with any existing
composite ring, or if require_modified is True and there has been
no change with respect to the existing ring.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.CompositeRingBuilder.load">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path_to_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.CompositeRingBuilder.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Load composite ring metadata.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>path_to_file</strong> – Absolute path to a composite ring JSON file.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>an instance of <a class="reference internal" href="#swift.common.ring.composite_builder.CompositeRingBuilder" title="swift.common.ring.composite_builder.CompositeRingBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompositeRingBuilder</span></code></a></p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>IOError</strong> – if there is a problem opening the file</p></li>
<li><p><strong>ValueError</strong> – if the file does not contain valid composite ring
metadata</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.CompositeRingBuilder.load_components">
<span class="sig-name descname"><span class="pre">load_components</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">builder_files</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">require_modified</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.CompositeRingBuilder.load_components" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads component ring builders from builder files. Previously loaded
component ring builders will discarded and reloaded.</p>
<p>If a list of component ring builder files is given then that will be
used to load component ring builders. Otherwise, component ring
builders will be loaded using the list of builder files that was set
when the instance was constructed.</p>
<p>In either case, if metadata for an existing composite ring has been
loaded then the component ring builders are verified for consistency
with the existing composition of builders, unless the optional
<code class="docutils literal notranslate"><span class="pre">force</span></code> flag if set True.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>builder_files</strong> – Optional list of paths to ring builder
files that will be used to load the component ring builders.
Typically the list of component builder files will have been set
when the instance was constructed, for example when using the
load() class method. However, this parameter may be used if the
component builder file paths have moved, or, in conjunction with
the <code class="docutils literal notranslate"><span class="pre">force</span></code> parameter, if a new list of component builders is to
be used.</p></li>
<li><p><strong>force</strong> – if True then do not verify given builders are
consistent with any existing composite ring (default is False).</p></li>
<li><p><strong>require_modified</strong> – if True and <code class="docutils literal notranslate"><span class="pre">force</span></code> is False, then
verify that at least one of the given builders has been modified
since the composite ring was last built (default is False).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple of (builder files, loaded builders)</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p>ValueError if the component ring builders are not suitable for
composing with each other, or are inconsistent with any existing
composite ring, or if require_modified is True and there has been
no change with respect to the existing ring.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.CompositeRingBuilder.rebalance">
<span class="sig-name descname"><span class="pre">rebalance</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.CompositeRingBuilder.rebalance" title="Permalink to this definition">¶</a></dt>
<dd><p>Cooperatively rebalances all component ring builders.</p>
<p>This method does not change the state of the composite ring; a
subsequent call to <a class="reference internal" href="#swift.common.ring.composite_builder.CompositeRingBuilder.compose" title="swift.common.ring.composite_builder.CompositeRingBuilder.compose"><code class="xref py py-meth docutils literal notranslate"><span class="pre">compose()</span></code></a> is required to generate updated
composite <code class="xref py py-class docutils literal notranslate"><span class="pre">RingData</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>A list of dicts, one per component builder, each having the
following keys:</p>
<ul class="simple">
<li><p>’builder_file’ maps to the component builder file;</p></li>
<li><p>’builder’ maps to the corresponding instance of
<a class="reference internal" href="#swift.common.ring.builder.RingBuilder" title="swift.common.ring.builder.RingBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">swift.common.ring.builder.RingBuilder</span></code></a>;</p></li>
<li><p>’result’ maps to the results of the rebalance of that component
i.e. a tuple of: <cite>(number_of_partitions_altered,
resulting_balance, number_of_removed_devices)</cite></p></li>
</ul>
<p>The list has the same order as components in the composite ring.</p>
</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="misc.html#swift.common.exceptions.RingBuilderError" title="swift.common.exceptions.RingBuilderError"><strong>RingBuilderError</strong></a> – if there is an error while rebalancing any
component builder.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.CompositeRingBuilder.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path_to_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.CompositeRingBuilder.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save composite ring metadata to given file. See
<a class="reference internal" href="#swift.common.ring.composite_builder.CompositeRingBuilder" title="swift.common.ring.composite_builder.CompositeRingBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompositeRingBuilder</span></code></a> for details of the persisted metadata
format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>path_to_file</strong> – Absolute path to a composite ring file</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – if no composite ring has been built yet with this
instance</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.CompositeRingBuilder.to_dict">
<span class="sig-name descname"><span class="pre">to_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.CompositeRingBuilder.to_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform the composite ring attributes to a dict. See
<a class="reference internal" href="#swift.common.ring.composite_builder.CompositeRingBuilder" title="swift.common.ring.composite_builder.CompositeRingBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompositeRingBuilder</span></code></a> for details of the persisted metadata
format.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a composite ring metadata dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.CompositeRingBuilder.update_last_part_moves">
<span class="sig-name descname"><span class="pre">update_last_part_moves</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.CompositeRingBuilder.update_last_part_moves" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the record of how many hours ago each partition was moved in
all component builders.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.CooperativeRingBuilder">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">swift.common.ring.composite_builder.</span></span><span class="sig-name descname"><span class="pre">CooperativeRingBuilder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">part_power</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replicas</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_part_hours</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parent_builder</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.CooperativeRingBuilder" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#swift.common.ring.builder.RingBuilder" title="swift.common.ring.builder.RingBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">RingBuilder</span></code></a></p>
<p>A subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">RingBuilder</span></code> that participates in cooperative
rebalance.</p>
<p>During rebalance this subclass will consult with its <cite>parent_builder</cite>
before moving a partition. The <cite>parent_builder</cite> may in turn check with
co-builders (including this instance) to verify that none have moved that
partition in the last <cite>min_part_hours</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>part_power</strong> – number of partitions = 2**part_power.</p></li>
<li><p><strong>replicas</strong> – number of replicas for each partition.</p></li>
<li><p><strong>min_part_hours</strong> – minimum number of hours between partition changes.</p></li>
<li><p><strong>parent_builder</strong> – an instance of <a class="reference internal" href="#swift.common.ring.composite_builder.CompositeRingBuilder" title="swift.common.ring.composite_builder.CompositeRingBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompositeRingBuilder</span></code></a>.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.CooperativeRingBuilder.can_part_move">
<span class="sig-name descname"><span class="pre">can_part_move</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">part</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.CooperativeRingBuilder.can_part_move" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that in the context of this builder alone it is ok to move a
partition.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>part</strong> – The partition to check.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the partition can be moved, False otherwise.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.CooperativeRingBuilder.update_last_part_moves">
<span class="sig-name descname"><span class="pre">update_last_part_moves</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.CooperativeRingBuilder.update_last_part_moves" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the record of how many hours ago each partition was moved in
in this builder.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.check_against_existing">
<span class="sig-prename descclassname"><span class="pre">swift.common.ring.composite_builder.</span></span><span class="sig-name descname"><span class="pre">check_against_existing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">old_composite_meta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_composite_meta</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.check_against_existing" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that the given builders and their order are the same as that
used to build an existing composite ring. Return True if any of the given
builders has been modified with respect to its state when the given
component_meta was created.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>old_composite_meta</strong> – a dict of the form returned by
<code class="xref py py-func docutils literal notranslate"><span class="pre">_make_composite_meta()</span></code></p></li>
<li><p><strong>new_composite_meta</strong> – a dict of the form returned by
<code class="xref py py-func docutils literal notranslate"><span class="pre">_make_composite_meta()</span></code></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if any of the components has been modified, False otherwise.</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>Value Error</strong> – if proposed new components do not match any existing
components.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.check_builder_ids">
<span class="sig-prename descclassname"><span class="pre">swift.common.ring.composite_builder.</span></span><span class="sig-name descname"><span class="pre">check_builder_ids</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">builders</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.check_builder_ids" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that all builders in the given list have id’s assigned and that no
id appears more than once in the list.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>builders</strong> – a list instances of
<a class="reference internal" href="#swift.common.ring.builder.RingBuilder" title="swift.common.ring.builder.RingBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">swift.common.ring.builder.RingBuilder</span></code></a></p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p>ValueError if any builder id is missing or repeated</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.check_for_dev_uniqueness">
<span class="sig-prename descclassname"><span class="pre">swift.common.ring.composite_builder.</span></span><span class="sig-name descname"><span class="pre">check_for_dev_uniqueness</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">builders</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.check_for_dev_uniqueness" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that no device appears in more than one of the given list of
builders.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>builders</strong> – a list of <a class="reference internal" href="#swift.common.ring.builder.RingBuilder" title="swift.common.ring.builder.RingBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">swift.common.ring.builder.RingBuilder</span></code></a>
instances</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – if the same device is found in more than one builder</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.check_same_builder">
<span class="sig-prename descclassname"><span class="pre">swift.common.ring.composite_builder.</span></span><span class="sig-name descname"><span class="pre">check_same_builder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">old_component</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_component</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.check_same_builder" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that the given new_component metadata describes the same builder as
the given old_component metadata. The new_component builder does not
necessarily need to be in the same state as when the old_component metadata
was created to satisfy this check e.g. it may have changed devs and been
rebalanced.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>old_component</strong> – a dict of metadata describing a component builder</p></li>
<li><p><strong>new_component</strong> – a dict of metadata describing a component builder</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – if the new_component is not the same as that described
by the old_component</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.compose_rings">
<span class="sig-prename descclassname"><span class="pre">swift.common.ring.composite_builder.</span></span><span class="sig-name descname"><span class="pre">compose_rings</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">builders</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.compose_rings" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a list of component ring builders, perform validation on the list of
builders and return a composite RingData instance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>builders</strong> – a list of
<a class="reference internal" href="#swift.common.ring.builder.RingBuilder" title="swift.common.ring.builder.RingBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">swift.common.ring.builder.RingBuilder</span></code></a> instances</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a new RingData instance built from the component builders</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – if the builders are invalid with respect to each other</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.is_builder_newer">
<span class="sig-prename descclassname"><span class="pre">swift.common.ring.composite_builder.</span></span><span class="sig-name descname"><span class="pre">is_builder_newer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">old_component</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_component</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.is_builder_newer" title="Permalink to this definition">¶</a></dt>
<dd><p>Return True if the given builder has been modified with respect to its
state when the given component_meta was created.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>old_component</strong> – a dict of metadata describing a component ring</p></li>
<li><p><strong>new_component</strong> – a dict of metadata describing a component ring</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the builder has been modified, False otherwise.</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – if the version of the new_component is older than the
version of the existing component.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="swift.common.ring.composite_builder.pre_validate_all_builders">
<span class="sig-prename descclassname"><span class="pre">swift.common.ring.composite_builder.</span></span><span class="sig-name descname"><span class="pre">pre_validate_all_builders</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">builders</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#swift.common.ring.composite_builder.pre_validate_all_builders" title="Permalink to this definition">¶</a></dt>
<dd><p>Pre-validation for all component ring builders that are to be included in
the composite ring. Checks that all component rings are valid with respect
to each other.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>builders</strong> – a list of <a class="reference internal" href="#swift.common.ring.builder.RingBuilder" title="swift.common.ring.builder.RingBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">swift.common.ring.builder.RingBuilder</span></code></a>
instances</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – if the builders are invalid with respect to each other</p>
</dd>
</dl>
</dd></dl>

</section>
</section>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="s3_compat.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: S3/Swift REST API Comparison Matrix"></i></a>
          
          
            <a href="proxy.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Proxy"></i></a>
          
          <a id="pdfLink2" href="" target="_blank" title="Download the manuals as PDF"><i class="fa fa-file-pdf-o" data-toggle="tooltip" data-placement="top" title="Download PDF"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">this page last updated: 2019-06-03 22:00:41</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="https://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the
                 document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="OpenStack Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/id/">Bahasa Indonesia (Indonesian)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/it/">Italiano (Italian)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/tr_TR/">Türkçe (Türkiye)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="index.html" class="docs-sidebar-section-title"><h4>Swift 0.1.0.dev9981</h4></a>
      <ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/object_api_v1_overview.html">Object Storage API overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_architecture.html">Swift Architectural Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_ring.html">The Rings</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_policies.html">Storage Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_reaper.html">The Account Reaper</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_auth.html">The Auth System</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_acl.html">Access Control Lists (ACLs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_replication.html">Replication</a></li>
<li class="toctree-l1"><a class="reference internal" href="ratelimit.html">Rate Limiting</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_large_objects.html">Large Object Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_global_cluster.html">Global Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_container_sync.html">Container to Container Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_expiring_objects.html">Expiring Object Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="cors.html">CORS</a></li>
<li class="toctree-l1"><a class="reference internal" href="crossdomain.html">Cross-domain Policy File</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_erasure_code.html">Erasure Code Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_encryption.html">Object Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_backing_store.html">Using Swift as Backing Store for Service Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_container_sharding.html">Container Sharding</a></li>
<li class="toctree-l1"><a class="reference internal" href="ring_background.html">Building a Consistent Hashing Ring</a></li>
<li class="toctree-l1"><a class="reference internal" href="ring_partpower.html">Modifying Ring Partition Power</a></li>
<li class="toctree-l1"><a class="reference internal" href="associated_projects.html">Associated Projects</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html">Contributing to OpenStack Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#swift-design-principles">Swift Design Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#recommended-workflow">Recommended workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#notes-on-testing">Notes on Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#ideas">Ideas</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#community">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/review_guidelines.html">Review Guidelines</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="development_guidelines.html">Development Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_saio.html">SAIO (Swift All In One)</a></li>
<li class="toctree-l1"><a class="reference internal" href="first_contribution_swift.html">First Contribution to Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="policies_saio.html">Adding Storage Policies to an Existing SAIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_auth.html">Auth Server and Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_middleware.html">Middleware and Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_ondisk_backends.html">Pluggable On-Disk Back-end APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_watchers.html">Auditor Watchers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="howto_installmultinode.html">Instructions for a Multiple Server Swift Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment_guide.html">Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_deployment_guide.html">Apache Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin_guide.html">Administrator’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="replication_network.html">Dedicated replication network</a></li>
<li class="toctree-l1"><a class="reference internal" href="logs.html">Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ops_runbook/index.html">Swift Ops Runbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin/index.html">OpenStack Swift Administrator Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="install/index.html">Object Storage Install Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="config/index.html">Configuration Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/object_api_v1_overview.html">Object Storage API overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/discoverability.html">Discoverability</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/container_quotas.html">Container quotas</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/object_versioning.html">Object versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/large_objects.html">Large objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/temporary_url_middleware.html">Temporary URL middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/form_post_middleware.html">Form POST middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/use_content-encoding_metadata.html">Use Content-Encoding metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/use_the_content-disposition_metadata.html">Use the Content-Disposition metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/pseudo-hierarchical-folders-directories.html">Pseudo-hierarchical folders and directories</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/pagination.html">Page through large lists of containers or objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/serialized-response-formats.html">Serialized response formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/static-website.html">Create static website</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/object-expiration.html">Object expiration</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/bulk-delete.html">Bulk delete</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="s3_compat.html">S3/Swift REST API Comparison Matrix</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Partitioned Consistent Hash Ring</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ring">Ring</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-swift.common.ring.builder">Ring Builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-swift.common.ring.composite_builder">Composite Ring Builder</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="proxy.html">Proxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="account.html">Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="container.html">Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="db.html">Account DB and Container DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="object.html">Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">Misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="middleware.html">Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="audit_watchers.html">Object Audit Watchers</a></li>
</ul>

    </div>

  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="local-table-of-contents">
      <h4 class="docs-sidebar-section-title">Page Contents</h4>
      <ul>
<li><a class="reference internal" href="#">Partitioned Consistent Hash Ring</a><ul>
<li><a class="reference internal" href="#ring">Ring</a><ul>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring"><code class="docutils literal notranslate"><span class="pre">Ring</span></code></a><ul>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring.assigned_device_count"><code class="docutils literal notranslate"><span class="pre">Ring.assigned_device_count</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring.device_count"><code class="docutils literal notranslate"><span class="pre">Ring.device_count</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring.devs"><code class="docutils literal notranslate"><span class="pre">Ring.devs</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring.get_more_nodes"><code class="docutils literal notranslate"><span class="pre">Ring.get_more_nodes()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring.get_nodes"><code class="docutils literal notranslate"><span class="pre">Ring.get_nodes()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring.get_part"><code class="docutils literal notranslate"><span class="pre">Ring.get_part()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring.get_part_nodes"><code class="docutils literal notranslate"><span class="pre">Ring.get_part_nodes()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring.has_changed"><code class="docutils literal notranslate"><span class="pre">Ring.has_changed()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring.md5"><code class="docutils literal notranslate"><span class="pre">Ring.md5</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring.next_part_power"><code class="docutils literal notranslate"><span class="pre">Ring.next_part_power</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring.part_power"><code class="docutils literal notranslate"><span class="pre">Ring.part_power</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring.partition_count"><code class="docutils literal notranslate"><span class="pre">Ring.partition_count</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring.raw_size"><code class="docutils literal notranslate"><span class="pre">Ring.raw_size</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring.replica_count"><code class="docutils literal notranslate"><span class="pre">Ring.replica_count</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring.size"><code class="docutils literal notranslate"><span class="pre">Ring.size</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring.version"><code class="docutils literal notranslate"><span class="pre">Ring.version</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.Ring.weighted_device_count"><code class="docutils literal notranslate"><span class="pre">Ring.weighted_device_count</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#swift.common.ring.ring.RingData"><code class="docutils literal notranslate"><span class="pre">RingData</span></code></a><ul>
<li><a class="reference internal" href="#swift.common.ring.ring.RingData.deserialize_v1"><code class="docutils literal notranslate"><span class="pre">RingData.deserialize_v1()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.RingData.load"><code class="docutils literal notranslate"><span class="pre">RingData.load()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.RingData.replica_count"><code class="docutils literal notranslate"><span class="pre">RingData.replica_count</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.RingData.save"><code class="docutils literal notranslate"><span class="pre">RingData.save()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.RingData.serialize_v1"><code class="docutils literal notranslate"><span class="pre">RingData.serialize_v1()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.RingData.to_dict"><code class="docutils literal notranslate"><span class="pre">RingData.to_dict()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#swift.common.ring.ring.RingReader"><code class="docutils literal notranslate"><span class="pre">RingReader</span></code></a><ul>
<li><a class="reference internal" href="#swift.common.ring.ring.RingReader.chunk_size"><code class="docutils literal notranslate"><span class="pre">RingReader.chunk_size</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.RingReader.close"><code class="docutils literal notranslate"><span class="pre">RingReader.close</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.RingReader.md5"><code class="docutils literal notranslate"><span class="pre">RingReader.md5</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.RingReader.read"><code class="docutils literal notranslate"><span class="pre">RingReader.read()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.RingReader.readinto"><code class="docutils literal notranslate"><span class="pre">RingReader.readinto()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.RingReader.readline"><code class="docutils literal notranslate"><span class="pre">RingReader.readline()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.ring.RingReader.seek"><code class="docutils literal notranslate"><span class="pre">RingReader.seek()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#swift.common.ring.ring.calc_replica_count"><code class="docutils literal notranslate"><span class="pre">calc_replica_count()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-swift.common.ring.builder">Ring Builder</a><ul>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder"><code class="docutils literal notranslate"><span class="pre">RingBuilder</span></code></a><ul>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.add_dev"><code class="docutils literal notranslate"><span class="pre">RingBuilder.add_dev()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.cancel_increase_partition_power"><code class="docutils literal notranslate"><span class="pre">RingBuilder.cancel_increase_partition_power()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.change_min_part_hours"><code class="docutils literal notranslate"><span class="pre">RingBuilder.change_min_part_hours()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.copy_from"><code class="docutils literal notranslate"><span class="pre">RingBuilder.copy_from()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.debug"><code class="docutils literal notranslate"><span class="pre">RingBuilder.debug()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.ever_rebalanced"><code class="docutils literal notranslate"><span class="pre">RingBuilder.ever_rebalanced</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.finish_increase_partition_power"><code class="docutils literal notranslate"><span class="pre">RingBuilder.finish_increase_partition_power()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.from_dict"><code class="docutils literal notranslate"><span class="pre">RingBuilder.from_dict()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.get_balance"><code class="docutils literal notranslate"><span class="pre">RingBuilder.get_balance()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.get_part_devices"><code class="docutils literal notranslate"><span class="pre">RingBuilder.get_part_devices()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.get_required_overload"><code class="docutils literal notranslate"><span class="pre">RingBuilder.get_required_overload()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.get_ring"><code class="docutils literal notranslate"><span class="pre">RingBuilder.get_ring()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.id"><code class="docutils literal notranslate"><span class="pre">RingBuilder.id</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.increase_partition_power"><code class="docutils literal notranslate"><span class="pre">RingBuilder.increase_partition_power()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.load"><code class="docutils literal notranslate"><span class="pre">RingBuilder.load()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.min_part_seconds_left"><code class="docutils literal notranslate"><span class="pre">RingBuilder.min_part_seconds_left</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.part_shift"><code class="docutils literal notranslate"><span class="pre">RingBuilder.part_shift</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.prepare_increase_partition_power"><code class="docutils literal notranslate"><span class="pre">RingBuilder.prepare_increase_partition_power()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.pretend_min_part_hours_passed"><code class="docutils literal notranslate"><span class="pre">RingBuilder.pretend_min_part_hours_passed()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.rebalance"><code class="docutils literal notranslate"><span class="pre">RingBuilder.rebalance()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.remove_dev"><code class="docutils literal notranslate"><span class="pre">RingBuilder.remove_dev()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.save"><code class="docutils literal notranslate"><span class="pre">RingBuilder.save()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.search_devs"><code class="docutils literal notranslate"><span class="pre">RingBuilder.search_devs()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.set_dev_region"><code class="docutils literal notranslate"><span class="pre">RingBuilder.set_dev_region()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.set_dev_weight"><code class="docutils literal notranslate"><span class="pre">RingBuilder.set_dev_weight()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.set_dev_zone"><code class="docutils literal notranslate"><span class="pre">RingBuilder.set_dev_zone()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.set_overload"><code class="docutils literal notranslate"><span class="pre">RingBuilder.set_overload()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.set_replicas"><code class="docutils literal notranslate"><span class="pre">RingBuilder.set_replicas()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.to_dict"><code class="docutils literal notranslate"><span class="pre">RingBuilder.to_dict()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.validate"><code class="docutils literal notranslate"><span class="pre">RingBuilder.validate()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingBuilder.weight_of_one_part"><code class="docutils literal notranslate"><span class="pre">RingBuilder.weight_of_one_part()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#swift.common.ring.builder.RingValidationWarning"><code class="docutils literal notranslate"><span class="pre">RingValidationWarning</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-swift.common.ring.composite_builder">Composite Ring Builder</a><ul>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.CompositeRingBuilder"><code class="docutils literal notranslate"><span class="pre">CompositeRingBuilder</span></code></a><ul>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.CompositeRingBuilder.can_part_move"><code class="docutils literal notranslate"><span class="pre">CompositeRingBuilder.can_part_move()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.CompositeRingBuilder.compose"><code class="docutils literal notranslate"><span class="pre">CompositeRingBuilder.compose()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.CompositeRingBuilder.load"><code class="docutils literal notranslate"><span class="pre">CompositeRingBuilder.load()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.CompositeRingBuilder.load_components"><code class="docutils literal notranslate"><span class="pre">CompositeRingBuilder.load_components()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.CompositeRingBuilder.rebalance"><code class="docutils literal notranslate"><span class="pre">CompositeRingBuilder.rebalance()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.CompositeRingBuilder.save"><code class="docutils literal notranslate"><span class="pre">CompositeRingBuilder.save()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.CompositeRingBuilder.to_dict"><code class="docutils literal notranslate"><span class="pre">CompositeRingBuilder.to_dict()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.CompositeRingBuilder.update_last_part_moves"><code class="docutils literal notranslate"><span class="pre">CompositeRingBuilder.update_last_part_moves()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.CooperativeRingBuilder"><code class="docutils literal notranslate"><span class="pre">CooperativeRingBuilder</span></code></a><ul>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.CooperativeRingBuilder.can_part_move"><code class="docutils literal notranslate"><span class="pre">CooperativeRingBuilder.can_part_move()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.CooperativeRingBuilder.update_last_part_moves"><code class="docutils literal notranslate"><span class="pre">CooperativeRingBuilder.update_last_part_moves()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.check_against_existing"><code class="docutils literal notranslate"><span class="pre">check_against_existing()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.check_builder_ids"><code class="docutils literal notranslate"><span class="pre">check_builder_ids()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.check_for_dev_uniqueness"><code class="docutils literal notranslate"><span class="pre">check_for_dev_uniqueness()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.check_same_builder"><code class="docutils literal notranslate"><span class="pre">check_same_builder()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.compose_rings"><code class="docutils literal notranslate"><span class="pre">compose_rings()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.is_builder_newer"><code class="docutils literal notranslate"><span class="pre">is_builder_newer()</span></code></a></li>
<li><a class="reference internal" href="#swift.common.ring.composite_builder.pre_validate_all_builders"><code class="docutils literal notranslate"><span class="pre">pre_validate_all_builders()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
  </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="https://openstack.org/projects/">Projects</a></li>
          <li><a href="https://www.openstack.org/software/security/">OpenStack Security</a></li>
          <li><a href="https://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="https://openstack.org/blog/">Blog</a></li>g
          <li><a href="https://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="https://openstack.org/community/">User Groups</a></li>
          <li><a href="https://openstack.org/community/events/">Events</a></li>
          <li><a href="https://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="https://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="https://docs.openstack.org/contributors">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="https://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="https://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="https://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="https://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="https://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="https://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="https://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="_static/js/jquery-3.2.1.min.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="_static/js/bootstrap.min.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="_static/js/docs.js"></script>

<!-- standard sphinx include libraries, which allow search highlighting -->
<script type="text/javascript" src="_static/underscore.js"></script>
<script type="text/javascript" src="_static/doctools.js"></script>
<script type="text/javascript" src="_static/searchtools.js"></script>
<script type="text/javascript" src="_static/language_data.js"></script>

<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:    './',
      VERSION:     '0.1.0.dev9981',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      LINK_SUFFIX: '.html',
      SOURCELINK_SUFFIX: '.txt',
      HAS_SOURCE:  true
    };
</script>

<!-- Javascript for page -->
<script language="JavaScript">
  /* Build a description of this page including SHA, source location on git
   * repo, build time and the project's launchpad bug tag. Set the HREF of the
   * bug buttons
   */
    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
    /* "giturl" is the URL of the source file on Git and is auto-generated by
     * openstackdocstheme.
     *
     * "pagename" is a standard sphinx parameter containing the name of
     * the source file, without extension.
     */

    var sourceFile = "ring" + ".rst";
    gitURL = "Source: https://opendev.org/openstack/swift/src/doc/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: ea4de2b777b1c6829ec514b1c989e1c2934e6483";
    var repositoryName = "openstack/swift";
    var bugProject = "swift";
    var bugTitle = "Partitioned Consistent Hash Ring in Swift";
    var fieldTags = "";
    var useStoryboard = "";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 0.1.0.dev9981 on 2019-06-03 22:00:41";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags, repositoryName, useStoryboard);
    var currentSourceFile = "ring";
    var pdfFileName = "doc-swift.pdf";
    pdfLink(currentSourceFile, pdfFileName);
</script>


  </body>
</html>