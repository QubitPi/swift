
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Middleware and Metadata &#8212; Swift 0.1.0.dev10164 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/basic.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="canonical" href="/openstack-swift/development_middleware.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Pluggable On-Disk Back-end APIs" href="development_ondisk_backends.html" />
    <link rel="prev" title="Auth Server and Middleware" href="development_auth.html" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Bootstrap CSS -->
<link href="_static/css/bootstrap.min.css" rel="stylesheet">

<!-- Fonts -->
<link href="_static/css/font-awesome.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="_static/css/combined.css" rel="stylesheet">

<!-- Search CSS -->
<link href="_static/css/search.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="_static/pygments.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17511903-1', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->


  </head><body>

<!-- SOURCE_FILE: https://opendev.org/openstack/swift/src/doc/source/development_middleware.rst -->

<script>
    (function (window, document) {
        var loader = function () {
            var script = document.createElement("script"), tag = document.getElementsByTagName("script")[0];
            script.src = "https://search.openstack.org/widget/embed.min.js?t="+Date.now();
            tag.parentNode.insertBefore(script, tag);
        };
        window.addEventListener ? window.addEventListener("load", loader, false) : window.attachEvent("onload", loader);
    })(window, document);
</script>

<nav class="navbar navbar-default" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="https://www.openstack.org/"></a>
      </div>
      <div class="search-icon show"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
    <div class="openstack-search-bar" data-baseUrl="search.openstack.org" data-context="docs-openstack"></div>
</div>
      <ul class="nav navbar-nav navbar-main show">
        <li class="search-container-mobile">
    <div class="openstack-search-bar" data-baseUrl="search.openstack.org" data-context="docs-openstack"></div>
</li>
        <li> <!--Software -->
          <a href="https://www.openstack.org/software/" class="drop" id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/">Overview</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/openstack-components">OpenStack Components</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/sdks">SDKs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/project-navigator/deployment-tools">Deployment Tools</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/assets/software/projectmap/openstack-map.pdf" target="_blank">OpenStack Map</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/software/sample-configs/">Sample Configs</a></li>
          </ul>
        </li>
        <li> <!-- Use Cases -->
          <a href="https://www.openstack.org/use-cases/" class="drop" id="dropdownMenuUsers">Use Cases <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuUsers">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/">Users in Production</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/bare-metal/">Ironic Bare Metal</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/edge-computing/">Edge Computing</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/telecoms-and-nfv/">Telecom & NFV</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/science/">Science and HPC</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/containers/">Containers</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/use-cases/enterprise/">Enterprise</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/surveys/landing">User Survey</a></li>
          </ul>
        </li>
        <li> <!-- Events -->
          <a href="https://www.openstack.org/events/" class="drop" id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/summit/">Open Infrastructure Summits</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/ptg/">Project Teams Gathering</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/opendev-2020/">OpenDev</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/community-events/">Community Events</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/events/openstackdays">OpenStack & OpenInfra Days</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/videos/">Summit Videos</a></li>
          </ul>
        </li>
        <li><!-- Community -->
          <a href="https://www.openstack.org/community/" class="drop" id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuCommunity">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/">Welcome! Start Here</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/tech-committee">OpenStack Technical Committee</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/speakers/">Speakers Bureau</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://wiki.openstack.org">OpenStack Wiki</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/coa/">Get Certified (COA)</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/jobs/">Jobs</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketing/">Marketing Resources</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/news/">Community News</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="http://superuser.openstack.org">Superuser Magazine</a></li>
            <li role="presentation" class="divider"></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/community/supporting-organizations/">OpenInfra Foundation Supporting Organizations</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev">Open Infrastructure Foundation (OpenInfra Foundation)</a></li>
          </ul>
        </li>
        <li><!-- Marketplace -->
          <a href="https://www.openstack.orgmarketplace/" class="drop" id="dropdownMenuLearn">Marketplace <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuEvents">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/training/">Training</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/distros/">Distros & Appliances</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/public-clouds/">Public Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/hosted-private-clouds/">Hosted Private Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/remotely-managed-private-clouds/">Remotely Managed Private Clouds</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/consulting/">Consulting & Integrators</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://www.openstack.org/marketplace/drivers/">Drivers</a></li>
          </ul>
        </li>
        <li><!-- Blog -->
          <a href="https://www.openstack.org/blog/">Blog</a>
        </li>
        <li><!-- Docs -->
          <a href="http://docs.openstack.org/">Docs</a>
        </li>
        <li> <!-- Join -->
            <li class="join-nav-section">
              <a href="https://openinfra.dev/join/" id="dropdownMenuJoin">Join <i class="fa fa-caret-down"></i></a>
              <ul class="dropdown-menu dropdown-hover" role="menu" aria-labelledby="dropdownMenuJoin" style="display: none;">
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev/join/">Sign up for Foundation Membership</a></li>
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev/join/">Sponsor the Foundation</a></li>
                <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openinfra.dev">More about the Foundation</a></li>
              </ul>
            </li>
            <li>
              <a href="https://www.openstack.org/Security/login/?BackURL=/home/" class="sign-in-btn">Log In</a>
            </li>
        </li>
      </ul>
    </div>
  </div>
  <!-- /.container -->
</nav>

    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row docs-title">
  <div class="col-lg-8">
      <h1>Middleware and Metadata</h1>
    
  </div>
  <div class="docs-actions">
    
    <a href="development_auth.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Auth Server and Middleware"></i></a>
    
    
    <a href="development_ondisk_backends.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Pluggable On-Disk Back-end APIs"></i></a>
    
    <a id="pdfLink1" href="" target="_blank" title="Download the manuals as PDF"><i class="fa fa-file-pdf-o" data-toggle="tooltip" data-placement="top" title="Download PDF"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
    
  </div>
</div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-body" role="main">

  <section id="middleware-and-metadata">
<h1>Middleware and Metadata<a class="headerlink" href="#middleware-and-metadata" title="Permalink to this heading">¶</a></h1>
<section id="using-middleware">
<h2>Using Middleware<a class="headerlink" href="#using-middleware" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="http://www.python.org/dev/peps/pep-0333/#middleware-components-that-play-both-sides">Python WSGI Middleware</a> (or just “middleware”) can be used to “wrap”
the request and response of a Python WSGI application (i.e. a webapp,
or REST/HTTP API), like Swift’s WSGI servers (proxy-server,
account-server, container-server, object-server).  Swift uses middleware
to add (sometimes optional) behaviors to the Swift WSGI servers.</p>
<p>Middleware can be added to the Swift WSGI servers by modifying their
<a class="reference external" href="https://pypi.org/project/Paste/">paste</a> configuration file.  The majority of Swift middleware is applied
to the <a class="reference internal" href="proxy.html#proxy-server"><span class="std std-ref">Proxy Server</span></a>.</p>
<p>Given the following basic configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">DEFAULT</span><span class="p">]</span>
<span class="n">log_level</span> <span class="o">=</span> <span class="n">DEBUG</span>
<span class="n">user</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">your</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>

<span class="p">[</span><span class="n">pipeline</span><span class="p">:</span><span class="n">main</span><span class="p">]</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">-</span><span class="n">server</span>

<span class="p">[</span><span class="n">app</span><span class="p">:</span><span class="n">proxy</span><span class="o">-</span><span class="n">server</span><span class="p">]</span>
<span class="n">use</span> <span class="o">=</span> <span class="n">egg</span><span class="p">:</span><span class="n">swift</span><span class="c1">#proxy</span>
</pre></div>
</div>
<p>You could add the <a class="reference internal" href="middleware.html#healthcheck"><span class="std std-ref">Healthcheck</span></a> middleware by adding a section for
that filter and adding it to the pipeline:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">DEFAULT</span><span class="p">]</span>
<span class="n">log_level</span> <span class="o">=</span> <span class="n">DEBUG</span>
<span class="n">user</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">your</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>

<span class="p">[</span><span class="n">pipeline</span><span class="p">:</span><span class="n">main</span><span class="p">]</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">healthcheck</span> <span class="n">proxy</span><span class="o">-</span><span class="n">server</span>

<span class="p">[</span><span class="nb">filter</span><span class="p">:</span><span class="n">healthcheck</span><span class="p">]</span>
<span class="n">use</span> <span class="o">=</span> <span class="n">egg</span><span class="p">:</span><span class="n">swift</span><span class="c1">#healthcheck</span>

<span class="p">[</span><span class="n">app</span><span class="p">:</span><span class="n">proxy</span><span class="o">-</span><span class="n">server</span><span class="p">]</span>
<span class="n">use</span> <span class="o">=</span> <span class="n">egg</span><span class="p">:</span><span class="n">swift</span><span class="c1">#proxy</span>
</pre></div>
</div>
<p>Some middleware is required and will be inserted into your pipeline
automatically by core swift code (e.g. the proxy-server will insert
<a class="reference internal" href="middleware.html#catch-errors"><span class="std std-ref">CatchErrors</span></a> and <a class="reference internal" href="middleware.html#gatekeeper"><span class="std std-ref">GateKeeper</span></a> at the start of the pipeline if they
are not already present).  You can see which features are available on a given
Swift endpoint (including middleware) using the <a class="reference internal" href="middleware.html#discoverability"><span class="std std-ref">Discoverability</span></a>
interface.</p>
</section>
<section id="creating-your-own-middleware">
<h2>Creating Your Own Middleware<a class="headerlink" href="#creating-your-own-middleware" title="Permalink to this heading">¶</a></h2>
<p>The best way to see how to write middleware is to look at examples.</p>
<p>Many optional features in Swift are implemented as
<a class="reference internal" href="middleware.html#common-middleware"><span class="std std-ref">Middleware</span></a> and provided in <code class="docutils literal notranslate"><span class="pre">swift.common.middleware</span></code>, but
Swift middleware may be packaged and distributed as a separate project.
Some examples are listed on the <a class="reference internal" href="associated_projects.html#associated-projects"><span class="std std-ref">Associated Projects</span></a> page.</p>
<p>A contrived middleware example that modifies request behavior by
inspecting custom HTTP headers (e.g. X-Webhook) and uses <a class="reference internal" href="#sysmeta"><span class="std std-ref">System Metadata</span></a>
to persist data to backend storage as well as common patterns like a
<a class="reference internal" href="proxy.html#swift.proxy.controllers.base.get_container_info" title="swift.proxy.controllers.base.get_container_info"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_container_info()</span></code></a> cache/query and <a class="reference internal" href="misc.html#swift.common.swob.wsgify" title="swift.common.swob.wsgify"><code class="xref py py-func docutils literal notranslate"><span class="pre">wsgify()</span></code></a> decorator is
presented below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">swift.common.http</span> <span class="kn">import</span> <span class="n">is_success</span>
<span class="kn">from</span> <span class="nn">swift.common.swob</span> <span class="kn">import</span> <span class="n">wsgify</span>
<span class="kn">from</span> <span class="nn">swift.common.utils</span> <span class="kn">import</span> <span class="n">split_path</span><span class="p">,</span> <span class="n">get_logger</span>
<span class="kn">from</span> <span class="nn">swift.common.request_helpers</span> <span class="kn">import</span> <span class="n">get_sys_meta_prefix</span>
<span class="kn">from</span> <span class="nn">swift.proxy.controllers.base</span> <span class="kn">import</span> <span class="n">get_container_info</span>
<span class="kn">from</span> <span class="nn">eventlet</span> <span class="kn">import</span> <span class="n">Timeout</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY3</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">eventlet.green.urllib</span> <span class="kn">import</span> <span class="n">request</span> <span class="k">as</span> <span class="n">urllib2</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">eventlet.green</span> <span class="kn">import</span> <span class="n">urllib2</span>

<span class="c1"># x-container-sysmeta-webhook</span>
<span class="n">SYSMETA_WEBHOOK</span> <span class="o">=</span> <span class="n">get_sys_meta_prefix</span><span class="p">(</span><span class="s1">&#39;container&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;webhook&#39;</span>


<span class="k">class</span> <span class="nc">WebhookMiddleware</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">conf</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">log_route</span><span class="o">=</span><span class="s1">&#39;webhook&#39;</span><span class="p">)</span>

    <span class="nd">@wsgify</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span> <span class="o">=</span> \
                <span class="n">split_path</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">path_info</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># not an object request</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="s1">&#39;x-webhook&#39;</span> <span class="ow">in</span> <span class="n">req</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
            <span class="c1"># translate user&#39;s request header to sysmeta</span>
            <span class="n">req</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">SYSMETA_WEBHOOK</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">req</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;x-webhook&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;x-remove-webhook&#39;</span> <span class="ow">in</span> <span class="n">req</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
            <span class="c1"># empty value will tombstone sysmeta</span>
            <span class="n">req</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">SYSMETA_WEBHOOK</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="c1"># account and object storage will ignore x-container-sysmeta-*</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">and</span> <span class="n">is_success</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status_int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">req</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;PUT&#39;</span><span class="p">:</span>
            <span class="n">container_info</span> <span class="o">=</span> <span class="n">get_container_info</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">)</span>
            <span class="c1"># container_info may have our new sysmeta key</span>
            <span class="n">webhook</span> <span class="o">=</span> <span class="n">container_info</span><span class="p">[</span><span class="s1">&#39;sysmeta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;webhook&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">webhook</span><span class="p">:</span>
                <span class="c1"># create a POST request with obj name as body</span>
                <span class="n">webhook_req</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">webhook</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">Timeout</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">webhook_req</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">Timeout</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                            <span class="s1">&#39;failed POST to webhook </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">webhook</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="s1">&#39;successfully called webhook </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">webhook</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;x-container-sysmeta-webhook&#39;</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
            <span class="c1"># translate sysmeta from the backend resp to</span>
            <span class="c1"># user-visible client resp header</span>
            <span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;x-webhook&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">SYSMETA_WEBHOOK</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">resp</span>


<span class="k">def</span> <span class="nf">webhook_factory</span><span class="p">(</span><span class="n">global_conf</span><span class="p">,</span> <span class="o">**</span><span class="n">local_conf</span><span class="p">):</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">global_conf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">conf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">local_conf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">webhook_filter</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">WebhookMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">webhook_filter</span>
</pre></div>
</div>
<p>In practice this middleware will call the URL stored on the container as
X-Webhook on all successful object uploads.</p>
<p>If this example was at <code class="docutils literal notranslate"><span class="pre">&lt;swift-repo&gt;/swift/common/middleware/webhook.py</span></code> -
you could add it to your proxy by creating a new filter section and
adding it to the pipeline:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">DEFAULT</span><span class="p">]</span>
<span class="n">log_level</span> <span class="o">=</span> <span class="n">DEBUG</span>
<span class="n">user</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">your</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>

<span class="p">[</span><span class="n">pipeline</span><span class="p">:</span><span class="n">main</span><span class="p">]</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">healthcheck</span> <span class="n">webhook</span> <span class="n">proxy</span><span class="o">-</span><span class="n">server</span>

<span class="p">[</span><span class="nb">filter</span><span class="p">:</span><span class="n">webhook</span><span class="p">]</span>
<span class="n">paste</span><span class="o">.</span><span class="n">filter_factory</span> <span class="o">=</span> <span class="n">swift</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">middleware</span><span class="o">.</span><span class="n">webhook</span><span class="p">:</span><span class="n">webhook_factory</span>

<span class="p">[</span><span class="nb">filter</span><span class="p">:</span><span class="n">healthcheck</span><span class="p">]</span>
<span class="n">use</span> <span class="o">=</span> <span class="n">egg</span><span class="p">:</span><span class="n">swift</span><span class="c1">#healthcheck</span>

<span class="p">[</span><span class="n">app</span><span class="p">:</span><span class="n">proxy</span><span class="o">-</span><span class="n">server</span><span class="p">]</span>
<span class="n">use</span> <span class="o">=</span> <span class="n">egg</span><span class="p">:</span><span class="n">swift</span><span class="c1">#proxy</span>
</pre></div>
</div>
<p>Most python packages expose middleware as entrypoints.  See <a class="reference external" href="https://pypi.org/project/PasteDeploy/">PasteDeploy</a>
documentation for more information about the syntax of the <code class="docutils literal notranslate"><span class="pre">use</span></code> option.
All middleware included with Swift is installed to support the <code class="docutils literal notranslate"><span class="pre">egg:swift</span></code>
syntax.</p>
<p>Middleware may advertize its availability and capabilities via Swift’s
<a class="reference internal" href="middleware.html#discoverability"><span class="std std-ref">Discoverability</span></a> support by using
<a class="reference internal" href="misc.html#swift.common.registry.register_swift_info" title="swift.common.registry.register_swift_info"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_swift_info()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">swift.common.registry</span> <span class="kn">import</span> <span class="n">register_swift_info</span>
<span class="k">def</span> <span class="nf">webhook_factory</span><span class="p">(</span><span class="n">global_conf</span><span class="p">,</span> <span class="o">**</span><span class="n">local_conf</span><span class="p">):</span>
    <span class="n">register_swift_info</span><span class="p">(</span><span class="s1">&#39;webhook&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">webhook_filter</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">WebhookMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">webhook_filter</span>
</pre></div>
</div>
<p>If a middleware handles sensitive information in headers or query parameters
that may need redaction when logging, use the <a class="reference internal" href="misc.html#swift.common.registry.register_sensitive_header" title="swift.common.registry.register_sensitive_header"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_sensitive_header()</span></code></a>
and <a class="reference internal" href="misc.html#swift.common.registry.register_sensitive_param" title="swift.common.registry.register_sensitive_param"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_sensitive_param()</span></code></a> functions. This should be done in the
filter factory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">swift.common.registry</span> <span class="kn">import</span> <span class="n">register_sensitive_header</span>
<span class="k">def</span> <span class="nf">webhook_factory</span><span class="p">(</span><span class="n">global_conf</span><span class="p">,</span> <span class="o">**</span><span class="n">local_conf</span><span class="p">):</span>
    <span class="n">register_sensitive_header</span><span class="p">(</span><span class="s1">&#39;webhook-api-key&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">webhook_filter</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">WebhookMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">webhook_filter</span>
</pre></div>
</div>
</section>
<section id="swift-metadata">
<h2>Swift Metadata<a class="headerlink" href="#swift-metadata" title="Permalink to this heading">¶</a></h2>
<p>Generally speaking metadata is information about a resource that is
associated with the resource but is not the data contained in the
resource itself - which is set and retrieved via HTTP headers. (e.g. the
“Content-Type” of a Swift object that is returned in HTTP response
headers)</p>
<p>All user resources in Swift (i.e. account, container, objects) can have
user metadata associated with them.  Middleware may also persist custom
metadata to accounts and containers safely using System Metadata.  Some
core Swift features which predate sysmeta have added exceptions for
custom non-user metadata headers (e.g.  <a class="reference internal" href="misc.html#acls"><span class="std std-ref">ACLs</span></a>,
<a class="reference internal" href="overview_large_objects.html#large-objects"><span class="std std-ref">Large Object Support</span></a>)</p>
<section id="user-metadata">
<span id="usermeta"></span><h3>User Metadata<a class="headerlink" href="#user-metadata" title="Permalink to this heading">¶</a></h3>
<p>User metadata takes the form of <code class="docutils literal notranslate"><span class="pre">X-&lt;type&gt;-Meta-&lt;key&gt;:</span> <span class="pre">&lt;value&gt;</span></code>, where
<code class="docutils literal notranslate"><span class="pre">&lt;type&gt;</span></code> depends on the resources type (i.e. Account, Container, Object)
and <code class="docutils literal notranslate"><span class="pre">&lt;key&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;value&gt;</span></code> are set by the client.</p>
<p>User metadata should generally be reserved for use by the client or
client applications.  A perfect example use-case for user metadata is
<a class="reference external" href="https://opendev.org/openstack/python-swiftclient">python-swiftclient</a>’s <code class="docutils literal notranslate"><span class="pre">X-Object-Meta-Mtime</span></code> which it stores on
object it uploads to implement its <code class="docutils literal notranslate"><span class="pre">--changed</span></code> option which will only
upload files that have changed since the last upload.</p>
<p>New middleware should avoid storing metadata within the User Metadata
namespace to avoid potential conflict with existing user metadata when
introducing new metadata keys.  An example of legacy middleware that
borrows the user metadata namespace is <a class="reference internal" href="middleware.html#tempurl"><span class="std std-ref">TempURL</span></a>.  An example of
middleware which uses custom non-user metadata to avoid the user
metadata namespace is <a class="reference internal" href="overview_large_objects.html#slo-doc"><span class="std std-ref">Static Large Objects</span></a>.</p>
<p>User metadata that is stored by a PUT or POST request to a container or account
resource persists until it is explicitly removed by a subsequent PUT or POST
request that includes a header <code class="docutils literal notranslate"><span class="pre">X-&lt;type&gt;-Meta-&lt;key&gt;</span></code> with no value or a
header <code class="docutils literal notranslate"><span class="pre">X-Remove-&lt;type&gt;-Meta-&lt;key&gt;:</span> <span class="pre">&lt;ignored-value&gt;</span></code>. In the latter case the
<code class="docutils literal notranslate"><span class="pre">&lt;ignored-value&gt;</span></code> is not stored. All user metadata stored with an account or
container resource is deleted when the account or container is deleted.</p>
<p>User metadata that is stored with an object resource has a different semantic;
object user metadata persists until any subsequent PUT or POST request is made
to the same object, at which point all user metadata stored with that object is
deleted en-masse and replaced with any user metadata included with the PUT or
POST request. As a result, it is not possible to update a subset of the user
metadata items stored with an object while leaving some items unchanged.</p>
</section>
<section id="system-metadata">
<span id="sysmeta"></span><h3>System Metadata<a class="headerlink" href="#system-metadata" title="Permalink to this heading">¶</a></h3>
<p>System metadata takes the form of <code class="docutils literal notranslate"><span class="pre">X-&lt;type&gt;-Sysmeta-&lt;key&gt;:</span> <span class="pre">&lt;value&gt;</span></code>,
where <code class="docutils literal notranslate"><span class="pre">&lt;type&gt;</span></code> depends on the resources type (i.e. Account, Container,
Object) and <code class="docutils literal notranslate"><span class="pre">&lt;key&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;value&gt;</span></code> are set by trusted code running in a
Swift WSGI Server.</p>
<p>All headers on client requests in the form of <code class="docutils literal notranslate"><span class="pre">X-&lt;type&gt;-Sysmeta-&lt;key&gt;</span></code>
will be dropped from the request before being processed by any
middleware.  All headers on responses from back-end systems in the form
of <code class="docutils literal notranslate"><span class="pre">X-&lt;type&gt;-Sysmeta-&lt;key&gt;</span></code> will be removed after all middlewares have
processed the response but before the response is sent to the client.
See <a class="reference internal" href="middleware.html#gatekeeper"><span class="std std-ref">GateKeeper</span></a> middleware for more information.</p>
<p>System metadata provides a means to store potentially private custom
metadata with associated Swift resources in a safe and secure fashion
without actually having to plumb custom metadata through the core swift
servers.  The incoming filtering ensures that the namespace can not be
modified directly by client requests, and the outgoing filter ensures
that removing middleware that uses a specific system metadata key
renders it benign.  New middleware should take advantage of system
metadata.</p>
<p>System metadata may be set on accounts and containers by including headers with
a PUT or POST request. Where a header name matches the name of an existing item
of system metadata, the value of the existing item will be updated. Otherwise
existing items are preserved. A system metadata header with an empty value will
cause any existing item with the same name to be deleted.</p>
<p>System metadata may be set on objects using only PUT requests. All items of
existing system metadata will be deleted and replaced en-masse by any system
metadata headers included with the PUT request. System metadata is neither
updated nor deleted by a POST request: updating individual items of system
metadata with a POST request is not yet supported in the same way that updating
individual items of user metadata is not supported. In cases where middleware
needs to store its own metadata with a POST request, it may use Object Transient
Sysmeta.</p>
</section>
<section id="object-transient-sysmeta">
<span id="transient-sysmeta"></span><h3>Object Transient-Sysmeta<a class="headerlink" href="#object-transient-sysmeta" title="Permalink to this heading">¶</a></h3>
<p>If middleware needs to store object metadata with a POST request it may do so
using headers of the form <code class="docutils literal notranslate"><span class="pre">X-Object-Transient-Sysmeta-&lt;key&gt;:</span> <span class="pre">&lt;value&gt;</span></code>.</p>
<p>All headers on client requests in the form of
<code class="docutils literal notranslate"><span class="pre">X-Object-Transient-Sysmeta-&lt;key&gt;</span></code> will be dropped from the request before
being processed by any middleware.  All headers on responses from back-end
systems in the form of <code class="docutils literal notranslate"><span class="pre">X-Object-Transient-Sysmeta-&lt;key&gt;</span></code> will be removed
after all middlewares have processed the response but before the response is
sent to the client. See <a class="reference internal" href="middleware.html#gatekeeper"><span class="std std-ref">GateKeeper</span></a> middleware for more information.</p>
<p>Transient-sysmeta updates on an object have the same semantic as user
metadata updates on an object (see <a class="reference internal" href="#usermeta"><span class="std std-ref">User Metadata</span></a>) i.e. whenever any PUT or
POST request is made to an object, all existing items of transient-sysmeta are
deleted en-masse and replaced with any transient-sysmeta included with the PUT
or POST request. Transient-sysmeta set by a middleware is therefore prone to
deletion by a subsequent client-generated POST request unless the middleware is
careful to include its transient-sysmeta with every POST. Likewise, user
metadata set by a client is prone to deletion by a subsequent
middleware-generated POST request, and for that reason middleware should avoid
generating POST requests that are independent of any client request.</p>
<p>Transient-sysmeta deliberately uses a different header prefix to user metadata
so that middlewares can avoid potential conflict with user metadata keys.</p>
<p>Transient-sysmeta deliberately uses a different header prefix to system
metadata to emphasize the fact that the data is only persisted until a
subsequent POST.</p>
</section>
</section>
</section>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="development_auth.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Auth Server and Middleware"></i></a>
          
          
            <a href="development_ondisk_backends.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Pluggable On-Disk Back-end APIs"></i></a>
          
          <a id="pdfLink2" href="" target="_blank" title="Download the manuals as PDF"><i class="fa fa-file-pdf-o" data-toggle="tooltip" data-placement="top" title="Download PDF"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">this page last updated: 2023-04-27 13:48:34</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<a href="https://creativecommons.org/licenses/by/3.0/">
 <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
</a>
<p>
 Except where otherwise noted, this document is licensed under
 <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons
 Attribution 3.0 License</a>. See all <a href="https://www.openstack.org/legal">
 OpenStack Legal Documents</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the
                 document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="btn-group docs-sidebar-releases">
    <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="OpenStack Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
<button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">OpenStack Documentation<i class="fa fa-caret-down"></i></button>
    <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
      <li role="presentation" class="dropdown-header">Guides</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#install-guides">Install Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#user-guides">User Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#configuration-guides">Configuration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#ops-and-admin-guides">Operations and Administration Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#api-guides">API Guides</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/index.html#contributor-guides">Contributor Guides</a></li>
      <li role="presentation" class="dropdown-header">Languages</li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/de/">Deutsch (German)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/fr/">Français (French)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/id/">Bahasa Indonesia (Indonesian)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/it/">Italiano (Italian)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/ja/">日本語 (Japanese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/ko_KR/">한국어 (Korean)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/pt_BR/">Português (Portuguese)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/tr_TR/">Türkçe (Türkiye)</a></li>
      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/zh_CN/">简体中文 (Simplified Chinese)</a></li>
    </ul>
  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <a href="index.html" class="docs-sidebar-section-title"><h4>Swift 0.1.0.dev10164</h4></a>
      <ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/object_api_v1_overview.html">Object Storage API overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_architecture.html">Swift Architectural Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_ring.html">The Rings</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_policies.html">Storage Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_reaper.html">The Account Reaper</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_auth.html">The Auth System</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_acl.html">Access Control Lists (ACLs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_replication.html">Replication</a></li>
<li class="toctree-l1"><a class="reference internal" href="ratelimit.html">Rate Limiting</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_large_objects.html">Large Object Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_global_cluster.html">Global Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_container_sync.html">Container to Container Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_expiring_objects.html">Expiring Object Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="cors.html">CORS</a></li>
<li class="toctree-l1"><a class="reference internal" href="crossdomain.html">Cross-domain Policy File</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_erasure_code.html">Erasure Code Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_encryption.html">Object Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_backing_store.html">Using Swift as Backing Store for Service Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview_container_sharding.html">Container Sharding</a></li>
<li class="toctree-l1"><a class="reference internal" href="ring_background.html">Building a Consistent Hashing Ring</a></li>
<li class="toctree-l1"><a class="reference internal" href="ring_partpower.html">Modifying Ring Partition Power</a></li>
<li class="toctree-l1"><a class="reference internal" href="associated_projects.html">Associated Projects</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html">Contributing to OpenStack Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#swift-design-principles">Swift Design Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#recommended-workflow">Recommended workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#notes-on-testing">Notes on Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#ideas">Ideas</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/contributing.html#community">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor/review_guidelines.html">Review Guidelines</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="development_guidelines.html">Development Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_saio.html">SAIO (Swift All In One)</a></li>
<li class="toctree-l1"><a class="reference internal" href="first_contribution_swift.html">First Contribution to Swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="policies_saio.html">Adding Storage Policies to an Existing SAIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_auth.html">Auth Server and Middleware</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Middleware and Metadata</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#using-middleware">Using Middleware</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-your-own-middleware">Creating Your Own Middleware</a></li>
<li class="toctree-l2"><a class="reference internal" href="#swift-metadata">Swift Metadata</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="development_ondisk_backends.html">Pluggable On-Disk Back-end APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_watchers.html">Auditor Watchers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="deployment_guide.html">Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_deployment_guide.html">Apache Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin_guide.html">Administrator’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="replication_network.html">Dedicated replication network</a></li>
<li class="toctree-l1"><a class="reference internal" href="logs.html">Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ops_runbook/index.html">Swift Ops Runbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin/index.html">OpenStack Swift Administrator Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="install/index.html">Object Storage Install Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="config/index.html">Configuration Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/object_api_v1_overview.html">Object Storage API overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/discoverability.html">Discoverability</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/container_quotas.html">Container quotas</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/object_versioning.html">Object versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/large_objects.html">Large objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/temporary_url_middleware.html">Temporary URL middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/form_post_middleware.html">Form POST middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/use_content-encoding_metadata.html">Use Content-Encoding metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/use_the_content-disposition_metadata.html">Use the Content-Disposition metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/pseudo-hierarchical-folders-directories.html">Pseudo-hierarchical folders and directories</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/pagination.html">Page through large lists of containers or objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/serialized-response-formats.html">Serialized response formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/static-website.html">Create static website</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/object-expiration.html">Object expiration</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/bulk-delete.html">Bulk delete</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="s3_compat.html">S3/Swift REST API Comparison Matrix</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ring.html">Partitioned Consistent Hash Ring</a></li>
<li class="toctree-l1"><a class="reference internal" href="proxy.html">Proxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="account.html">Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="container.html">Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="db.html">Account DB and Container DB</a></li>
<li class="toctree-l1"><a class="reference internal" href="object.html">Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">Misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="middleware.html">Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="audit_watchers.html">Object Audit Watchers</a></li>
</ul>

    </div>

  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="local-table-of-contents">
      <h4 class="docs-sidebar-section-title">Page Contents</h4>
      <ul>
<li><a class="reference internal" href="#">Middleware and Metadata</a><ul>
<li><a class="reference internal" href="#using-middleware">Using Middleware</a></li>
<li><a class="reference internal" href="#creating-your-own-middleware">Creating Your Own Middleware</a></li>
<li><a class="reference internal" href="#swift-metadata">Swift Metadata</a><ul>
<li><a class="reference internal" href="#user-metadata">User Metadata</a></li>
<li><a class="reference internal" href="#system-metadata">System Metadata</a></li>
<li><a class="reference internal" href="#object-transient-sysmeta">Object Transient-Sysmeta</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
  </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>OpenStack</h3>
        <ul>
          <li><a href="https://openstack.org/projects/">Projects</a></li>
          <li><a href="https://www.openstack.org/software/security/">OpenStack Security</a></li>
          <li><a href="https://openstack.org/projects/openstack-faq/">Common Questions</a></li>
          <li><a href="https://openstack.org/blog/">Blog</a></li>g
          <li><a href="https://openstack.org/news/">News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Community</h3>
        <ul>
          <li><a href="https://openstack.org/community/">User Groups</a></li>
          <li><a href="https://openstack.org/community/events/">Events</a></li>
          <li><a href="https://openstack.org/community/jobs/">Jobs</a></li>
          <li><a href="https://openstack.org/foundation/companies/">Companies</a></li>
          <li><a href="https://docs.openstack.org/contributors">Contribute</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Documentation</h3>
        <ul>
          <li><a href="https://docs.openstack.org">OpenStack Manuals</a></li>
          <li><a href="https://openstack.org/software/start/">Getting Started</a></li>
          <li><a href="https://developer.openstack.org">API Documentation</a></li>
          <li><a href="https://wiki.openstack.org">Wiki</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Branding & Legal</h3>
        <ul>
          <li><a href="https://openstack.org/brand/">Logos & Guidelines</a></li>
          <li><a href="https://openstack.org/brand/openstack-trademark-policy/">Trademark Policy</a></li>
          <li><a href="https://openstack.org/privacy/">Privacy Policy</a></li>
          <li><a href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement">OpenStack CLA</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Stay In Touch</h3>
        <a href="https://twitter.com/OpenStack" target="_blank" class="social-icons footer-twitter"></a>
        <a href="https://www.facebook.com/openstack" target="_blank" class="social-icons footer-facebook"></a>
        <a href="https://www.linkedin.com/company/openstack" target="_blank" class="social-icons footer-linkedin"></a>
        <a href="https://www.youtube.com/user/OpenStackFoundation" target="_blank" class="social-icons footer-youtube"></a>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>. Openstack.org is powered by
          <a href="https://rackspace.com" target="_blank">Rackspace Cloud Computing</a>.
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="_static/js/jquery-3.2.1.min.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="_static/js/bootstrap.min.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="_static/js/docs.js"></script>

<!-- standard sphinx include libraries, which allow search highlighting -->
<script type="text/javascript" src="_static/underscore.js"></script>
<script type="text/javascript" src="_static/doctools.js"></script>
<script type="text/javascript" src="_static/searchtools.js"></script>
<script type="text/javascript" src="_static/language_data.js"></script>

<script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
      URL_ROOT:    './',
      VERSION:     '0.1.0.dev10164',
      COLLAPSE_INDEX: false,
      FILE_SUFFIX: '.html',
      LINK_SUFFIX: '.html',
      SOURCELINK_SUFFIX: '.txt',
      HAS_SOURCE:  true
    };
</script>

<!-- Javascript for page -->
<script language="JavaScript">
  /* Build a description of this page including SHA, source location on git
   * repo, build time and the project's launchpad bug tag. Set the HREF of the
   * bug buttons
   */
    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
    /* "giturl" is the URL of the source file on Git and is auto-generated by
     * openstackdocstheme.
     *
     * "pagename" is a standard sphinx parameter containing the name of
     * the source file, without extension.
     */

    var sourceFile = "development_middleware" + ".rst";
    gitURL = "Source: https://opendev.org/openstack/swift/src/doc/source" + "/" + sourceFile;

    /* gitsha, project and bug_tag rely on variables in conf.py */
    var gitSha = "SHA: c7afe681fd119752e66a8e9032e8782641fec3ff";
    var repositoryName = "openstack/swift";
    var bugProject = "swift";
    var bugTitle = "Middleware and Metadata in Swift";
    var fieldTags = "";
    var useStoryboard = "";

    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 0.1.0.dev10164 on 2023-04-27 13:48:34";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags, repositoryName, useStoryboard);
    var currentSourceFile = "development_middleware";
    var pdfFileName = "doc-swift.pdf";
    pdfLink(currentSourceFile, pdfFileName);
</script>


  </body>
</html>